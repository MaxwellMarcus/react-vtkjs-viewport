!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("vtk.js/Sources/macro"),require("react"),require("vtk.js/Sources/Rendering/Core/Coordinate"),require("vtk.js/Sources/Rendering/Core/InteractorStyle/Constants"),require("cornerstone-core"),require("vtk.js/Sources/Common/Core/MatrixBuilder"),require("vtk.js/Sources/Rendering/Misc/GenericRenderWindow"),require("vtk.js/Sources/Widgets/Core/WidgetManager"),require("vtk.js/Sources/Common/Core/Math"),require("vtk.js/Sources/Interaction/Style/InteractorStyleImage"),require("cornerstone-tools"),require("vtk.js/Sources/Rendering/Core/Renderer"),require("vtk.js/Sources/Filters/General/PaintFilter"),require("vtk.js/Sources/Widgets/Widgets3D/PaintWidget"),require("vtk.js/Sources/Widgets/Core/WidgetManager/Constants"),require("vtk.js/Sources/Common/DataModel/ImageData"),require("vtk.js/Sources/Common/Core/DataArray"),require("vtk.js/Sources/Widgets/Manipulators/PlaneManipulator"),require("vtk.js/Sources/Interaction/Style/InteractorStyleTrackballCamera"),require("vtk.js/Sources/Rendering/Core/ImageMapper"),require("vtk.js/Sources/Interaction/Widgets/OrientationMarkerWidget"),require("vtk.js/Sources/Interaction/Style/InteractorStyleManipulator"),require("vtk.js/Sources/Interaction/Manipulators/MouseCameraTrackballRotateManipulator"),require("vtk.js/Sources/Interaction/Manipulators/MouseCameraTrackballPanManipulator"),require("vtk.js/Sources/Interaction/Manipulators/MouseCameraTrackballZoomManipulator"),require("vtk.js/Sources/Interaction/Manipulators/MouseRangeManipulator"),require("vtk.js/Sources/Rendering/Core/Volume"),require("vtk.js/Sources/Rendering/Core/VolumeMapper"),require("vtk.js/Sources/Rendering/Core/ColorTransferFunction"),require("vtk.js/Sources/Common/DataModel/PiecewiseFunction"),require("vtk.js/Sources/Rendering/Core/AnnotatedCubeActor"),require("vtk.js/Sources/Common/DataModel/BoundingBox")):"function"==typeof define&&define.amd?define(["vtk.js/Sources/macro","react","vtk.js/Sources/Rendering/Core/Coordinate","vtk.js/Sources/Rendering/Core/InteractorStyle/Constants","cornerstone-core","vtk.js/Sources/Common/Core/MatrixBuilder","vtk.js/Sources/Rendering/Misc/GenericRenderWindow","vtk.js/Sources/Widgets/Core/WidgetManager","vtk.js/Sources/Common/Core/Math","vtk.js/Sources/Interaction/Style/InteractorStyleImage","cornerstone-tools","vtk.js/Sources/Rendering/Core/Renderer","vtk.js/Sources/Filters/General/PaintFilter","vtk.js/Sources/Widgets/Widgets3D/PaintWidget","vtk.js/Sources/Widgets/Core/WidgetManager/Constants","vtk.js/Sources/Common/DataModel/ImageData","vtk.js/Sources/Common/Core/DataArray","vtk.js/Sources/Widgets/Manipulators/PlaneManipulator","vtk.js/Sources/Interaction/Style/InteractorStyleTrackballCamera","vtk.js/Sources/Rendering/Core/ImageMapper","vtk.js/Sources/Interaction/Widgets/OrientationMarkerWidget","vtk.js/Sources/Interaction/Style/InteractorStyleManipulator","vtk.js/Sources/Interaction/Manipulators/MouseCameraTrackballRotateManipulator","vtk.js/Sources/Interaction/Manipulators/MouseCameraTrackballPanManipulator","vtk.js/Sources/Interaction/Manipulators/MouseCameraTrackballZoomManipulator","vtk.js/Sources/Interaction/Manipulators/MouseRangeManipulator","vtk.js/Sources/Rendering/Core/Volume","vtk.js/Sources/Rendering/Core/VolumeMapper","vtk.js/Sources/Rendering/Core/ColorTransferFunction","vtk.js/Sources/Common/DataModel/PiecewiseFunction","vtk.js/Sources/Rendering/Core/AnnotatedCubeActor","vtk.js/Sources/Common/DataModel/BoundingBox"],t):"object"==typeof exports?exports.VTKViewport=t(require("vtk.js/Sources/macro"),require("react"),require("vtk.js/Sources/Rendering/Core/Coordinate"),require("vtk.js/Sources/Rendering/Core/InteractorStyle/Constants"),require("cornerstone-core"),require("vtk.js/Sources/Common/Core/MatrixBuilder"),require("vtk.js/Sources/Rendering/Misc/GenericRenderWindow"),require("vtk.js/Sources/Widgets/Core/WidgetManager"),require("vtk.js/Sources/Common/Core/Math"),require("vtk.js/Sources/Interaction/Style/InteractorStyleImage"),require("cornerstone-tools"),require("vtk.js/Sources/Rendering/Core/Renderer"),require("vtk.js/Sources/Filters/General/PaintFilter"),require("vtk.js/Sources/Widgets/Widgets3D/PaintWidget"),require("vtk.js/Sources/Widgets/Core/WidgetManager/Constants"),require("vtk.js/Sources/Common/DataModel/ImageData"),require("vtk.js/Sources/Common/Core/DataArray"),require("vtk.js/Sources/Widgets/Manipulators/PlaneManipulator"),require("vtk.js/Sources/Interaction/Style/InteractorStyleTrackballCamera"),require("vtk.js/Sources/Rendering/Core/ImageMapper"),require("vtk.js/Sources/Interaction/Widgets/OrientationMarkerWidget"),require("vtk.js/Sources/Interaction/Style/InteractorStyleManipulator"),require("vtk.js/Sources/Interaction/Manipulators/MouseCameraTrackballRotateManipulator"),require("vtk.js/Sources/Interaction/Manipulators/MouseCameraTrackballPanManipulator"),require("vtk.js/Sources/Interaction/Manipulators/MouseCameraTrackballZoomManipulator"),require("vtk.js/Sources/Interaction/Manipulators/MouseRangeManipulator"),require("vtk.js/Sources/Rendering/Core/Volume"),require("vtk.js/Sources/Rendering/Core/VolumeMapper"),require("vtk.js/Sources/Rendering/Core/ColorTransferFunction"),require("vtk.js/Sources/Common/DataModel/PiecewiseFunction"),require("vtk.js/Sources/Rendering/Core/AnnotatedCubeActor"),require("vtk.js/Sources/Common/DataModel/BoundingBox")):e.VTKViewport=t(e["vtk.js/Sources/macro"],e.react,e["vtk.js/Sources/Rendering/Core/Coordinate"],e["vtk.js/Sources/Rendering/Core/InteractorStyle/Constants"],e.cornerstone,e["vtk.js/Sources/Common/Core/MatrixBuilder"],e["vtk.js/Sources/Rendering/Misc/GenericRenderWindow"],e["vtk.js/Sources/Widgets/Core/WidgetManager"],e["vtk.js/Sources/Common/Core/Math"],e["vtk.js/Sources/Interaction/Style/InteractorStyleImage"],e.cornerstoneTools,e["vtk.js/Sources/Rendering/Core/Renderer"],e["vtk.js/Sources/Filters/General/PaintFilter"],e["vtk.js/Sources/Widgets/Widgets3D/PaintWidget"],e["vtk.js/Sources/Widgets/Core/WidgetManager/Constants"],e["vtk.js/Sources/Common/DataModel/ImageData"],e["vtk.js/Sources/Common/Core/DataArray"],e["vtk.js/Sources/Widgets/Manipulators/PlaneManipulator"],e["vtk.js/Sources/Interaction/Style/InteractorStyleTrackballCamera"],e["vtk.js/Sources/Rendering/Core/ImageMapper"],e["vtk.js/Sources/Interaction/Widgets/OrientationMarkerWidget"],e["vtk.js/Sources/Interaction/Style/InteractorStyleManipulator"],e["vtk.js/Sources/Interaction/Manipulators/MouseCameraTrackballRotateManipulator"],e["vtk.js/Sources/Interaction/Manipulators/MouseCameraTrackballPanManipulator"],e["vtk.js/Sources/Interaction/Manipulators/MouseCameraTrackballZoomManipulator"],e["vtk.js/Sources/Interaction/Manipulators/MouseRangeManipulator"],e["vtk.js/Sources/Rendering/Core/Volume"],e["vtk.js/Sources/Rendering/Core/VolumeMapper"],e["vtk.js/Sources/Rendering/Core/ColorTransferFunction"],e["vtk.js/Sources/Common/DataModel/PiecewiseFunction"],e["vtk.js/Sources/Rendering/Core/AnnotatedCubeActor"],e["vtk.js/Sources/Common/DataModel/BoundingBox"])}(this,(function(e,t,n,r,a,i,o,s,c,u,d,l,h,g,f,p,v,m,w,y,b,M,S,k,C,x,W,I,R,P,T,D){return function(e){var t={};function n(r){if(t[r])return t[r].exports;var a=t[r]={i:r,l:!1,exports:{}};return e[r].call(a.exports,a,a.exports,n),a.l=!0,a.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)n.d(r,a,function(t){return e[t]}.bind(null,a));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=62)}([function(e,t,n){e.exports=n(55)()},function(t,n){t.exports=e},function(e,n){e.exports=t},function(e,t,n){var r=n(50),a=n(51),i=n(52);e.exports=function(e){return r(e)||a(e)||i()}},function(e,t){e.exports=function(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}},function(e,t){e.exports=n},function(e,t,n){var r=n(47),a=n(48),i=n(49);e.exports=function(e,t){return r(e)||a(e,t)||i()}},function(e,t){e.exports=r},function(e,t){e.exports=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}},function(e,t){e.exports=a},function(e,t){function n(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}e.exports=function(e,t,r){return t&&n(e.prototype,t),r&&n(e,r),e}},function(e,t,n){var r=n(53),a=n(20);e.exports=function(e,t){return!t||"object"!==r(t)&&"function"!=typeof t?a(e):t}},function(e,t){function n(t){return e.exports=n=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},n(t)}e.exports=n},function(e,t,n){var r=n(54);e.exports=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&r(e,t)}},function(e,t){e.exports=i},function(e,t){e.exports=o},function(e,t){e.exports=s},function(e,t){e.exports=c},function(e,t){function n(){return e.exports=n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},n.apply(this,arguments)}e.exports=n},function(e,t){e.exports=u},function(e,t){e.exports=function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}},function(e,t){e.exports=d},function(e,t){e.exports=l},function(e,t){e.exports=h},function(e,t){e.exports=g},function(e,t){e.exports=f},function(e,t){e.exports=p},function(e,t){e.exports=v},function(e,t){e.exports=m},function(e,t){e.exports=w},function(e,t){e.exports=y},function(e,t){e.exports=b},function(e,t){e.exports=M},function(e,t){e.exports=S},function(e,t){e.exports=k},function(e,t){e.exports=C},function(e,t){e.exports=x},function(e,t){e.exports=W},function(e,t){e.exports=I},function(e,t){e.exports=R},function(e,t){e.exports=P},function(e,t){e.exports=T},function(e,t){e.exports=D},,,,,function(e,t){e.exports=function(e){if(Array.isArray(e))return e}},function(e,t){e.exports=function(e,t){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e)){var n=[],r=!0,a=!1,i=void 0;try{for(var o,s=e[Symbol.iterator]();!(r=(o=s.next()).done)&&(n.push(o.value),!t||n.length!==t);r=!0);}catch(e){a=!0,i=e}finally{try{r||null==s.return||s.return()}finally{if(a)throw i}}return n}}},function(e,t){e.exports=function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}},function(e,t){e.exports=function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}},function(e,t){e.exports=function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}},function(e,t){e.exports=function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}},function(e,t){function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function r(t){return"function"==typeof Symbol&&"symbol"===n(Symbol.iterator)?e.exports=r=function(e){return n(e)}:e.exports=r=function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":n(e)},r(t)}e.exports=r},function(e,t){function n(t,r){return e.exports=n=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},n(t,r)}e.exports=n},function(e,t,n){"use strict";var r=n(56);function a(){}function i(){}i.resetWarningCache=a,e.exports=function(){function e(e,t,n,a,i,o){if(o!==r){var s=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw s.name="Invariant Violation",s}}function t(){return e}e.isRequired=e;var n={array:e,bool:e,func:e,number:e,object:e,string:e,symbol:e,any:e,arrayOf:t,element:e,elementType:e,instanceOf:t,node:e,objectOf:t,oneOf:t,oneOfType:t,shape:t,exact:t,checkPropTypes:i,resetWarningCache:a};return n.PropTypes=n,n}},function(e,t,n){"use strict";e.exports="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED"},function(e,t,n){var r=n(58);"string"==typeof r&&(r=[[e.i,r,""]]);var a={hmr:!0,transform:void 0,insertInto:void 0};n(60)(r,a);r.locals&&(e.exports=r.locals)},function(e,t,n){(e.exports=n(59)(!1)).push([e.i,":root {\n  --viewport-tag-padding: 20px;\n}\n\n.ViewportOverlay {\n  color: #9ccef9;\n}\n\n.ViewportOverlay .overlay-element {\n  position: absolute;\n  font-weight: 400;\n  text-shadow: 1px 1px black;\n  pointer-events: none;\n}\n\n.ViewportOverlay .top-left {\n  top: var(--viewport-tag-padding);\n  left: var(--viewport-tag-padding);\n}\n\n.ViewportOverlay .top-center {\n  top: 1px;\n  width: 100%;\n  text-align: center;\n}\n\n.ViewportOverlay .top-right {\n  top: var(--viewport-tag-padding);\n  right: var(--viewport-tag-padding);\n  text-align: right;\n}\n\n.ViewportOverlay .bottom-left {\n  bottom: var(--viewport-tag-padding);\n  left: var(--viewport-tag-padding);\n}\n\n.ViewportOverlay .bottom-right {\n  bottom: var(--viewport-tag-padding);\n  right: var(--viewport-tag-padding);\n  text-align: right;\n}\n\n.ViewportOverlay .bottom-center {\n  bottom: 1px;\n  width: 100%;\n  text-align: center;\n}\n\n.ViewportOverlay .center-left {\n  left: 1px;\n  top: 50%;\n  text-align: left;\n}\n\n.ViewportOverlay .center-right {\n  right: 1px;\n  top: 50%;\n  text-align: right;\n}\n\n.ViewportOverlay svg {\n  color: #9ccef9;\n  fill: #9ccef9;\n  stroke: #9ccef9;\n  background-color: transparent;\n  margin: 2px;\n  width: 18px;\n  height: 18px;\n}\n",""])},function(e,t,n){"use strict";e.exports=function(e){var t=[];return t.toString=function(){return this.map((function(t){var n=function(e,t){var n=e[1]||"",r=e[3];if(!r)return n;if(t&&"function"==typeof btoa){var a=(o=r,s=btoa(unescape(encodeURIComponent(JSON.stringify(o)))),c="sourceMappingURL=data:application/json;charset=utf-8;base64,".concat(s),"/*# ".concat(c," */")),i=r.sources.map((function(e){return"/*# sourceURL=".concat(r.sourceRoot).concat(e," */")}));return[n].concat(i).concat([a]).join("\n")}var o,s,c;return[n].join("\n")}(t,e);return t[2]?"@media ".concat(t[2],"{").concat(n,"}"):n})).join("")},t.i=function(e,n){"string"==typeof e&&(e=[[null,e,""]]);for(var r={},a=0;a<this.length;a++){var i=this[a][0];null!=i&&(r[i]=!0)}for(var o=0;o<e.length;o++){var s=e[o];null!=s[0]&&r[s[0]]||(n&&!s[2]?s[2]=n:n&&(s[2]="(".concat(s[2],") and (").concat(n,")")),t.push(s))}},t}},function(e,t,n){var r,a,i={},o=(r=function(){return window&&document&&document.all&&!window.atob},function(){return void 0===a&&(a=r.apply(this,arguments)),a}),s=function(e,t){return t?t.querySelector(e):document.querySelector(e)},c=function(e){var t={};return function(e,n){if("function"==typeof e)return e();if(void 0===t[e]){var r=s.call(this,e,n);if(window.HTMLIFrameElement&&r instanceof window.HTMLIFrameElement)try{r=r.contentDocument.head}catch(e){r=null}t[e]=r}return t[e]}}(),u=null,d=0,l=[],h=n(61);function g(e,t){for(var n=0;n<e.length;n++){var r=e[n],a=i[r.id];if(a){a.refs++;for(var o=0;o<a.parts.length;o++)a.parts[o](r.parts[o]);for(;o<r.parts.length;o++)a.parts.push(y(r.parts[o],t))}else{var s=[];for(o=0;o<r.parts.length;o++)s.push(y(r.parts[o],t));i[r.id]={id:r.id,refs:1,parts:s}}}}function f(e,t){for(var n=[],r={},a=0;a<e.length;a++){var i=e[a],o=t.base?i[0]+t.base:i[0],s={css:i[1],media:i[2],sourceMap:i[3]};r[o]?r[o].parts.push(s):n.push(r[o]={id:o,parts:[s]})}return n}function p(e,t){var n=c(e.insertInto);if(!n)throw new Error("Couldn't find a style target. This probably means that the value for the 'insertInto' parameter is invalid.");var r=l[l.length-1];if("top"===e.insertAt)r?r.nextSibling?n.insertBefore(t,r.nextSibling):n.appendChild(t):n.insertBefore(t,n.firstChild),l.push(t);else if("bottom"===e.insertAt)n.appendChild(t);else{if("object"!=typeof e.insertAt||!e.insertAt.before)throw new Error("[Style Loader]\n\n Invalid value for parameter 'insertAt' ('options.insertAt') found.\n Must be 'top', 'bottom', or Object.\n (https://github.com/webpack-contrib/style-loader#insertat)\n");var a=c(e.insertAt.before,n);n.insertBefore(t,a)}}function v(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e);var t=l.indexOf(e);t>=0&&l.splice(t,1)}function m(e){var t=document.createElement("style");if(void 0===e.attrs.type&&(e.attrs.type="text/css"),void 0===e.attrs.nonce){var r=function(){0;return n.nc}();r&&(e.attrs.nonce=r)}return w(t,e.attrs),p(e,t),t}function w(e,t){Object.keys(t).forEach((function(n){e.setAttribute(n,t[n])}))}function y(e,t){var n,r,a,i;if(t.transform&&e.css){if(!(i="function"==typeof t.transform?t.transform(e.css):t.transform.default(e.css)))return function(){};e.css=i}if(t.singleton){var o=d++;n=u||(u=m(t)),r=S.bind(null,n,o,!1),a=S.bind(null,n,o,!0)}else e.sourceMap&&"function"==typeof URL&&"function"==typeof URL.createObjectURL&&"function"==typeof URL.revokeObjectURL&&"function"==typeof Blob&&"function"==typeof btoa?(n=function(e){var t=document.createElement("link");return void 0===e.attrs.type&&(e.attrs.type="text/css"),e.attrs.rel="stylesheet",w(t,e.attrs),p(e,t),t}(t),r=C.bind(null,n,t),a=function(){v(n),n.href&&URL.revokeObjectURL(n.href)}):(n=m(t),r=k.bind(null,n),a=function(){v(n)});return r(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap)return;r(e=t)}else a()}}e.exports=function(e,t){if("undefined"!=typeof DEBUG&&DEBUG&&"object"!=typeof document)throw new Error("The style-loader cannot be used in a non-browser environment");(t=t||{}).attrs="object"==typeof t.attrs?t.attrs:{},t.singleton||"boolean"==typeof t.singleton||(t.singleton=o()),t.insertInto||(t.insertInto="head"),t.insertAt||(t.insertAt="bottom");var n=f(e,t);return g(n,t),function(e){for(var r=[],a=0;a<n.length;a++){var o=n[a];(s=i[o.id]).refs--,r.push(s)}e&&g(f(e,t),t);for(a=0;a<r.length;a++){var s;if(0===(s=r[a]).refs){for(var c=0;c<s.parts.length;c++)s.parts[c]();delete i[s.id]}}}};var b,M=(b=[],function(e,t){return b[e]=t,b.filter(Boolean).join("\n")});function S(e,t,n,r){var a=n?"":r.css;if(e.styleSheet)e.styleSheet.cssText=M(t,a);else{var i=document.createTextNode(a),o=e.childNodes;o[t]&&e.removeChild(o[t]),o.length?e.insertBefore(i,o[t]):e.appendChild(i)}}function k(e,t){var n=t.css,r=t.media;if(r&&e.setAttribute("media",r),e.styleSheet)e.styleSheet.cssText=n;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(n))}}function C(e,t,n){var r=n.css,a=n.sourceMap,i=void 0===t.convertToAbsoluteUrls&&a;(t.convertToAbsoluteUrls||i)&&(r=h(r)),a&&(r+="\n/*# sourceMappingURL=data:application/json;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(a))))+" */");var o=new Blob([r],{type:"text/css"}),s=e.href;e.href=URL.createObjectURL(o),s&&URL.revokeObjectURL(s)}},function(e,t){e.exports=function(e){var t="undefined"!=typeof window&&window.location;if(!t)throw new Error("fixUrls requires window.location");if(!e||"string"!=typeof e)return e;var n=t.protocol+"//"+t.host,r=n+t.pathname.replace(/\/[^\/]*$/,"/");return e.replace(/url\s*\(((?:[^)(]|\((?:[^)(]+|\([^)(]*\))*\))*)\)/gi,(function(e,t){var a,i=t.trim().replace(/^"(.*)"$/,(function(e,t){return t})).replace(/^'(.*)'$/,(function(e,t){return t}));return/^(#|data:|http:\/\/|https:\/\/|file:\/\/\/|\s*$)/i.test(i)?e:(a=0===i.indexOf("//")?i:0===i.indexOf("/")?n+i:r+i.replace(/^\.\//,""),"url("+JSON.stringify(a)+")")}))}},function(e,t,n){"use strict";n.r(t);var r={};n.r(r),n.d(r,"create",(function(){return ce})),n.d(r,"clone",(function(){return ue})),n.d(r,"copy",(function(){return de})),n.d(r,"fromValues",(function(){return le})),n.d(r,"set",(function(){return he})),n.d(r,"identity",(function(){return ge})),n.d(r,"transpose",(function(){return fe})),n.d(r,"invert",(function(){return pe})),n.d(r,"adjoint",(function(){return ve})),n.d(r,"determinant",(function(){return me})),n.d(r,"multiply",(function(){return we})),n.d(r,"translate",(function(){return ye})),n.d(r,"scale",(function(){return be})),n.d(r,"rotate",(function(){return Me})),n.d(r,"rotateX",(function(){return Se})),n.d(r,"rotateY",(function(){return ke})),n.d(r,"rotateZ",(function(){return Ce})),n.d(r,"fromTranslation",(function(){return xe})),n.d(r,"fromScaling",(function(){return We})),n.d(r,"fromRotation",(function(){return Ie})),n.d(r,"fromXRotation",(function(){return Re})),n.d(r,"fromYRotation",(function(){return Pe})),n.d(r,"fromZRotation",(function(){return Te})),n.d(r,"fromRotationTranslation",(function(){return De})),n.d(r,"fromQuat2",(function(){return Ee})),n.d(r,"getTranslation",(function(){return Oe})),n.d(r,"getScaling",(function(){return je})),n.d(r,"getRotation",(function(){return Ae})),n.d(r,"fromRotationTranslationScale",(function(){return Le})),n.d(r,"fromRotationTranslationScaleOrigin",(function(){return Ve})),n.d(r,"fromQuat",(function(){return qe})),n.d(r,"frustum",(function(){return Ne})),n.d(r,"perspective",(function(){return Ue})),n.d(r,"perspectiveFromFieldOfView",(function(){return Fe})),n.d(r,"ortho",(function(){return Be})),n.d(r,"lookAt",(function(){return He})),n.d(r,"targetTo",(function(){return Ge})),n.d(r,"str",(function(){return _e})),n.d(r,"frob",(function(){return Ye})),n.d(r,"add",(function(){return ze})),n.d(r,"subtract",(function(){return Qe})),n.d(r,"multiplyScalar",(function(){return Xe})),n.d(r,"multiplyScalarAndAdd",(function(){return Ke})),n.d(r,"exactEquals",(function(){return Ze})),n.d(r,"equals",(function(){return Je})),n.d(r,"mul",(function(){return $e})),n.d(r,"sub",(function(){return et}));var a={};n.r(a),n.d(a,"create",(function(){return tt})),n.d(a,"clone",(function(){return nt})),n.d(a,"length",(function(){return rt})),n.d(a,"fromValues",(function(){return at})),n.d(a,"copy",(function(){return it})),n.d(a,"set",(function(){return ot})),n.d(a,"add",(function(){return st})),n.d(a,"subtract",(function(){return ct})),n.d(a,"multiply",(function(){return ut})),n.d(a,"divide",(function(){return dt})),n.d(a,"ceil",(function(){return lt})),n.d(a,"floor",(function(){return ht})),n.d(a,"min",(function(){return gt})),n.d(a,"max",(function(){return ft})),n.d(a,"round",(function(){return pt})),n.d(a,"scale",(function(){return vt})),n.d(a,"scaleAndAdd",(function(){return mt})),n.d(a,"distance",(function(){return wt})),n.d(a,"squaredDistance",(function(){return yt})),n.d(a,"squaredLength",(function(){return bt})),n.d(a,"negate",(function(){return Mt})),n.d(a,"inverse",(function(){return St})),n.d(a,"normalize",(function(){return kt})),n.d(a,"dot",(function(){return Ct})),n.d(a,"cross",(function(){return xt})),n.d(a,"lerp",(function(){return Wt})),n.d(a,"hermite",(function(){return It})),n.d(a,"bezier",(function(){return Rt})),n.d(a,"random",(function(){return Pt})),n.d(a,"transformMat4",(function(){return Tt})),n.d(a,"transformMat3",(function(){return Dt})),n.d(a,"transformQuat",(function(){return Et})),n.d(a,"rotateX",(function(){return Ot})),n.d(a,"rotateY",(function(){return jt})),n.d(a,"rotateZ",(function(){return At})),n.d(a,"angle",(function(){return Lt})),n.d(a,"zero",(function(){return Vt})),n.d(a,"str",(function(){return qt})),n.d(a,"exactEquals",(function(){return Nt})),n.d(a,"equals",(function(){return Ut})),n.d(a,"sub",(function(){return Bt})),n.d(a,"mul",(function(){return Ht})),n.d(a,"div",(function(){return Gt})),n.d(a,"dist",(function(){return _t})),n.d(a,"sqrDist",(function(){return Yt})),n.d(a,"len",(function(){return zt})),n.d(a,"sqrLen",(function(){return Qt})),n.d(a,"forEach",(function(){return Xt}));var i={};n.r(i),n.d(i,"create",(function(){return Jt})),n.d(i,"identity",(function(){return $t})),n.d(i,"setAxisAngle",(function(){return en})),n.d(i,"getAxisAngle",(function(){return tn})),n.d(i,"getAngle",(function(){return nn})),n.d(i,"multiply",(function(){return rn})),n.d(i,"rotateX",(function(){return an})),n.d(i,"rotateY",(function(){return on})),n.d(i,"rotateZ",(function(){return sn})),n.d(i,"calculateW",(function(){return cn})),n.d(i,"exp",(function(){return un})),n.d(i,"ln",(function(){return dn})),n.d(i,"pow",(function(){return ln})),n.d(i,"slerp",(function(){return hn})),n.d(i,"random",(function(){return gn})),n.d(i,"invert",(function(){return fn})),n.d(i,"conjugate",(function(){return pn})),n.d(i,"fromMat3",(function(){return vn})),n.d(i,"fromEuler",(function(){return mn})),n.d(i,"str",(function(){return wn})),n.d(i,"clone",(function(){return Wn})),n.d(i,"fromValues",(function(){return In})),n.d(i,"copy",(function(){return Rn})),n.d(i,"set",(function(){return Pn})),n.d(i,"add",(function(){return Tn})),n.d(i,"mul",(function(){return Dn})),n.d(i,"scale",(function(){return En})),n.d(i,"dot",(function(){return On})),n.d(i,"lerp",(function(){return jn})),n.d(i,"length",(function(){return An})),n.d(i,"len",(function(){return Ln})),n.d(i,"squaredLength",(function(){return Vn})),n.d(i,"sqrLen",(function(){return qn})),n.d(i,"normalize",(function(){return Nn})),n.d(i,"exactEquals",(function(){return Un})),n.d(i,"equals",(function(){return Fn})),n.d(i,"rotationTo",(function(){return Bn})),n.d(i,"sqlerp",(function(){return Hn})),n.d(i,"setAxes",(function(){return Gn}));var o={};n.r(o),n.d(o,"create",(function(){return _n})),n.d(o,"clone",(function(){return Yn})),n.d(o,"fromValues",(function(){return zn})),n.d(o,"copy",(function(){return Qn})),n.d(o,"set",(function(){return Xn})),n.d(o,"add",(function(){return Kn})),n.d(o,"subtract",(function(){return Zn})),n.d(o,"multiply",(function(){return Jn})),n.d(o,"divide",(function(){return $n})),n.d(o,"ceil",(function(){return er})),n.d(o,"floor",(function(){return tr})),n.d(o,"min",(function(){return nr})),n.d(o,"max",(function(){return rr})),n.d(o,"round",(function(){return ar})),n.d(o,"scale",(function(){return ir})),n.d(o,"scaleAndAdd",(function(){return or})),n.d(o,"distance",(function(){return sr})),n.d(o,"squaredDistance",(function(){return cr})),n.d(o,"length",(function(){return ur})),n.d(o,"squaredLength",(function(){return dr})),n.d(o,"negate",(function(){return lr})),n.d(o,"inverse",(function(){return hr})),n.d(o,"normalize",(function(){return gr})),n.d(o,"dot",(function(){return fr})),n.d(o,"cross",(function(){return pr})),n.d(o,"lerp",(function(){return vr})),n.d(o,"random",(function(){return mr})),n.d(o,"transformMat2",(function(){return wr})),n.d(o,"transformMat2d",(function(){return yr})),n.d(o,"transformMat3",(function(){return br})),n.d(o,"transformMat4",(function(){return Mr})),n.d(o,"rotate",(function(){return Sr})),n.d(o,"angle",(function(){return kr})),n.d(o,"zero",(function(){return Cr})),n.d(o,"str",(function(){return xr})),n.d(o,"exactEquals",(function(){return Wr})),n.d(o,"equals",(function(){return Ir})),n.d(o,"len",(function(){return Rr})),n.d(o,"sub",(function(){return Pr})),n.d(o,"mul",(function(){return Tr})),n.d(o,"div",(function(){return Dr})),n.d(o,"dist",(function(){return Er})),n.d(o,"sqrDist",(function(){return Or})),n.d(o,"sqrLen",(function(){return jr})),n.d(o,"forEach",(function(){return Ar}));var s=n(18),c=n.n(s),u=n(6),d=n.n(u),l=n(3),h=n.n(l),g=n(8),f=n.n(g),p=n(10),v=n.n(p),m=n(11),w=n.n(m),y=n(12),b=n.n(y),M=n(20),S=n.n(M),k=n(13),C=n.n(k),x=n(4),W=n.n(x),I=n(2),R=n.n(I),P=n(0),T=n.n(P),D=n(21),E=n.n(D),O=n(15),j=n.n(O),A=n(22),L=n.n(A),V=n(16),q=n.n(V),N=n(1),U=n.n(N),F=n(17),B=n.n(F),H=n(14),G=n.n(H),_=n(32),Y=n.n(_),z=n(33),Q=n.n(z),X=n(34),K=n.n(X),Z=n(35),J=n.n(Z),$=n(36),ee=n.n($),te=n(5),ne=n.n(te),re=n(7),ae=n.n(re),ie=1e-6,oe="undefined"!=typeof Float32Array?Float32Array:Array,se=Math.random;Math.PI;function ce(){var e=new oe(16);return oe!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e}function ue(e){var t=new oe(16);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function de(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function le(e,t,n,r,a,i,o,s,c,u,d,l,h,g,f,p){var v=new oe(16);return v[0]=e,v[1]=t,v[2]=n,v[3]=r,v[4]=a,v[5]=i,v[6]=o,v[7]=s,v[8]=c,v[9]=u,v[10]=d,v[11]=l,v[12]=h,v[13]=g,v[14]=f,v[15]=p,v}function he(e,t,n,r,a,i,o,s,c,u,d,l,h,g,f,p,v){return e[0]=t,e[1]=n,e[2]=r,e[3]=a,e[4]=i,e[5]=o,e[6]=s,e[7]=c,e[8]=u,e[9]=d,e[10]=l,e[11]=h,e[12]=g,e[13]=f,e[14]=p,e[15]=v,e}function ge(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function fe(e,t){if(e===t){var n=t[1],r=t[2],a=t[3],i=t[6],o=t[7],s=t[11];e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=n,e[6]=t[9],e[7]=t[13],e[8]=r,e[9]=i,e[11]=t[14],e[12]=a,e[13]=o,e[14]=s}else e[0]=t[0],e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[5]=t[5],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[10]=t[10],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11],e[15]=t[15];return e}function pe(e,t){var n=t[0],r=t[1],a=t[2],i=t[3],o=t[4],s=t[5],c=t[6],u=t[7],d=t[8],l=t[9],h=t[10],g=t[11],f=t[12],p=t[13],v=t[14],m=t[15],w=n*s-r*o,y=n*c-a*o,b=n*u-i*o,M=r*c-a*s,S=r*u-i*s,k=a*u-i*c,C=d*p-l*f,x=d*v-h*f,W=d*m-g*f,I=l*v-h*p,R=l*m-g*p,P=h*m-g*v,T=w*P-y*R+b*I+M*W-S*x+k*C;return T?(T=1/T,e[0]=(s*P-c*R+u*I)*T,e[1]=(a*R-r*P-i*I)*T,e[2]=(p*k-v*S+m*M)*T,e[3]=(h*S-l*k-g*M)*T,e[4]=(c*W-o*P-u*x)*T,e[5]=(n*P-a*W+i*x)*T,e[6]=(v*b-f*k-m*y)*T,e[7]=(d*k-h*b+g*y)*T,e[8]=(o*R-s*W+u*C)*T,e[9]=(r*W-n*R-i*C)*T,e[10]=(f*S-p*b+m*w)*T,e[11]=(l*b-d*S-g*w)*T,e[12]=(s*x-o*I-c*C)*T,e[13]=(n*I-r*x+a*C)*T,e[14]=(p*y-f*M-v*w)*T,e[15]=(d*M-l*y+h*w)*T,e):null}function ve(e,t){var n=t[0],r=t[1],a=t[2],i=t[3],o=t[4],s=t[5],c=t[6],u=t[7],d=t[8],l=t[9],h=t[10],g=t[11],f=t[12],p=t[13],v=t[14],m=t[15];return e[0]=s*(h*m-g*v)-l*(c*m-u*v)+p*(c*g-u*h),e[1]=-(r*(h*m-g*v)-l*(a*m-i*v)+p*(a*g-i*h)),e[2]=r*(c*m-u*v)-s*(a*m-i*v)+p*(a*u-i*c),e[3]=-(r*(c*g-u*h)-s*(a*g-i*h)+l*(a*u-i*c)),e[4]=-(o*(h*m-g*v)-d*(c*m-u*v)+f*(c*g-u*h)),e[5]=n*(h*m-g*v)-d*(a*m-i*v)+f*(a*g-i*h),e[6]=-(n*(c*m-u*v)-o*(a*m-i*v)+f*(a*u-i*c)),e[7]=n*(c*g-u*h)-o*(a*g-i*h)+d*(a*u-i*c),e[8]=o*(l*m-g*p)-d*(s*m-u*p)+f*(s*g-u*l),e[9]=-(n*(l*m-g*p)-d*(r*m-i*p)+f*(r*g-i*l)),e[10]=n*(s*m-u*p)-o*(r*m-i*p)+f*(r*u-i*s),e[11]=-(n*(s*g-u*l)-o*(r*g-i*l)+d*(r*u-i*s)),e[12]=-(o*(l*v-h*p)-d*(s*v-c*p)+f*(s*h-c*l)),e[13]=n*(l*v-h*p)-d*(r*v-a*p)+f*(r*h-a*l),e[14]=-(n*(s*v-c*p)-o*(r*v-a*p)+f*(r*c-a*s)),e[15]=n*(s*h-c*l)-o*(r*h-a*l)+d*(r*c-a*s),e}function me(e){var t=e[0],n=e[1],r=e[2],a=e[3],i=e[4],o=e[5],s=e[6],c=e[7],u=e[8],d=e[9],l=e[10],h=e[11],g=e[12],f=e[13],p=e[14],v=e[15];return(t*o-n*i)*(l*v-h*p)-(t*s-r*i)*(d*v-h*f)+(t*c-a*i)*(d*p-l*f)+(n*s-r*o)*(u*v-h*g)-(n*c-a*o)*(u*p-l*g)+(r*c-a*s)*(u*f-d*g)}function we(e,t,n){var r=t[0],a=t[1],i=t[2],o=t[3],s=t[4],c=t[5],u=t[6],d=t[7],l=t[8],h=t[9],g=t[10],f=t[11],p=t[12],v=t[13],m=t[14],w=t[15],y=n[0],b=n[1],M=n[2],S=n[3];return e[0]=y*r+b*s+M*l+S*p,e[1]=y*a+b*c+M*h+S*v,e[2]=y*i+b*u+M*g+S*m,e[3]=y*o+b*d+M*f+S*w,y=n[4],b=n[5],M=n[6],S=n[7],e[4]=y*r+b*s+M*l+S*p,e[5]=y*a+b*c+M*h+S*v,e[6]=y*i+b*u+M*g+S*m,e[7]=y*o+b*d+M*f+S*w,y=n[8],b=n[9],M=n[10],S=n[11],e[8]=y*r+b*s+M*l+S*p,e[9]=y*a+b*c+M*h+S*v,e[10]=y*i+b*u+M*g+S*m,e[11]=y*o+b*d+M*f+S*w,y=n[12],b=n[13],M=n[14],S=n[15],e[12]=y*r+b*s+M*l+S*p,e[13]=y*a+b*c+M*h+S*v,e[14]=y*i+b*u+M*g+S*m,e[15]=y*o+b*d+M*f+S*w,e}function ye(e,t,n){var r,a,i,o,s,c,u,d,l,h,g,f,p=n[0],v=n[1],m=n[2];return t===e?(e[12]=t[0]*p+t[4]*v+t[8]*m+t[12],e[13]=t[1]*p+t[5]*v+t[9]*m+t[13],e[14]=t[2]*p+t[6]*v+t[10]*m+t[14],e[15]=t[3]*p+t[7]*v+t[11]*m+t[15]):(r=t[0],a=t[1],i=t[2],o=t[3],s=t[4],c=t[5],u=t[6],d=t[7],l=t[8],h=t[9],g=t[10],f=t[11],e[0]=r,e[1]=a,e[2]=i,e[3]=o,e[4]=s,e[5]=c,e[6]=u,e[7]=d,e[8]=l,e[9]=h,e[10]=g,e[11]=f,e[12]=r*p+s*v+l*m+t[12],e[13]=a*p+c*v+h*m+t[13],e[14]=i*p+u*v+g*m+t[14],e[15]=o*p+d*v+f*m+t[15]),e}function be(e,t,n){var r=n[0],a=n[1],i=n[2];return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*a,e[5]=t[5]*a,e[6]=t[6]*a,e[7]=t[7]*a,e[8]=t[8]*i,e[9]=t[9]*i,e[10]=t[10]*i,e[11]=t[11]*i,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function Me(e,t,n,r){var a,i,o,s,c,u,d,l,h,g,f,p,v,m,w,y,b,M,S,k,C,x,W,I,R=r[0],P=r[1],T=r[2],D=Math.hypot(R,P,T);return D<ie?null:(R*=D=1/D,P*=D,T*=D,a=Math.sin(n),o=1-(i=Math.cos(n)),s=t[0],c=t[1],u=t[2],d=t[3],l=t[4],h=t[5],g=t[6],f=t[7],p=t[8],v=t[9],m=t[10],w=t[11],y=R*R*o+i,b=P*R*o+T*a,M=T*R*o-P*a,S=R*P*o-T*a,k=P*P*o+i,C=T*P*o+R*a,x=R*T*o+P*a,W=P*T*o-R*a,I=T*T*o+i,e[0]=s*y+l*b+p*M,e[1]=c*y+h*b+v*M,e[2]=u*y+g*b+m*M,e[3]=d*y+f*b+w*M,e[4]=s*S+l*k+p*C,e[5]=c*S+h*k+v*C,e[6]=u*S+g*k+m*C,e[7]=d*S+f*k+w*C,e[8]=s*x+l*W+p*I,e[9]=c*x+h*W+v*I,e[10]=u*x+g*W+m*I,e[11]=d*x+f*W+w*I,t!==e&&(e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e)}function Se(e,t,n){var r=Math.sin(n),a=Math.cos(n),i=t[4],o=t[5],s=t[6],c=t[7],u=t[8],d=t[9],l=t[10],h=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=i*a+u*r,e[5]=o*a+d*r,e[6]=s*a+l*r,e[7]=c*a+h*r,e[8]=u*a-i*r,e[9]=d*a-o*r,e[10]=l*a-s*r,e[11]=h*a-c*r,e}function ke(e,t,n){var r=Math.sin(n),a=Math.cos(n),i=t[0],o=t[1],s=t[2],c=t[3],u=t[8],d=t[9],l=t[10],h=t[11];return t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=i*a-u*r,e[1]=o*a-d*r,e[2]=s*a-l*r,e[3]=c*a-h*r,e[8]=i*r+u*a,e[9]=o*r+d*a,e[10]=s*r+l*a,e[11]=c*r+h*a,e}function Ce(e,t,n){var r=Math.sin(n),a=Math.cos(n),i=t[0],o=t[1],s=t[2],c=t[3],u=t[4],d=t[5],l=t[6],h=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=i*a+u*r,e[1]=o*a+d*r,e[2]=s*a+l*r,e[3]=c*a+h*r,e[4]=u*a-i*r,e[5]=d*a-o*r,e[6]=l*a-s*r,e[7]=h*a-c*r,e}function xe(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=t[0],e[13]=t[1],e[14]=t[2],e[15]=1,e}function We(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=t[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=t[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Ie(e,t,n){var r,a,i,o=n[0],s=n[1],c=n[2],u=Math.hypot(o,s,c);return u<ie?null:(o*=u=1/u,s*=u,c*=u,r=Math.sin(t),i=1-(a=Math.cos(t)),e[0]=o*o*i+a,e[1]=s*o*i+c*r,e[2]=c*o*i-s*r,e[3]=0,e[4]=o*s*i-c*r,e[5]=s*s*i+a,e[6]=c*s*i+o*r,e[7]=0,e[8]=o*c*i+s*r,e[9]=s*c*i-o*r,e[10]=c*c*i+a,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e)}function Re(e,t){var n=Math.sin(t),r=Math.cos(t);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=r,e[6]=n,e[7]=0,e[8]=0,e[9]=-n,e[10]=r,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Pe(e,t){var n=Math.sin(t),r=Math.cos(t);return e[0]=r,e[1]=0,e[2]=-n,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=n,e[9]=0,e[10]=r,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Te(e,t){var n=Math.sin(t),r=Math.cos(t);return e[0]=r,e[1]=n,e[2]=0,e[3]=0,e[4]=-n,e[5]=r,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function De(e,t,n){var r=t[0],a=t[1],i=t[2],o=t[3],s=r+r,c=a+a,u=i+i,d=r*s,l=r*c,h=r*u,g=a*c,f=a*u,p=i*u,v=o*s,m=o*c,w=o*u;return e[0]=1-(g+p),e[1]=l+w,e[2]=h-m,e[3]=0,e[4]=l-w,e[5]=1-(d+p),e[6]=f+v,e[7]=0,e[8]=h+m,e[9]=f-v,e[10]=1-(d+g),e[11]=0,e[12]=n[0],e[13]=n[1],e[14]=n[2],e[15]=1,e}function Ee(e,t){var n=new oe(3),r=-t[0],a=-t[1],i=-t[2],o=t[3],s=t[4],c=t[5],u=t[6],d=t[7],l=r*r+a*a+i*i+o*o;return l>0?(n[0]=2*(s*o+d*r+c*i-u*a)/l,n[1]=2*(c*o+d*a+u*r-s*i)/l,n[2]=2*(u*o+d*i+s*a-c*r)/l):(n[0]=2*(s*o+d*r+c*i-u*a),n[1]=2*(c*o+d*a+u*r-s*i),n[2]=2*(u*o+d*i+s*a-c*r)),De(e,t,n),e}function Oe(e,t){return e[0]=t[12],e[1]=t[13],e[2]=t[14],e}function je(e,t){var n=t[0],r=t[1],a=t[2],i=t[4],o=t[5],s=t[6],c=t[8],u=t[9],d=t[10];return e[0]=Math.hypot(n,r,a),e[1]=Math.hypot(i,o,s),e[2]=Math.hypot(c,u,d),e}function Ae(e,t){var n=new oe(3);je(n,t);var r=1/n[0],a=1/n[1],i=1/n[2],o=t[0]*r,s=t[1]*a,c=t[2]*i,u=t[4]*r,d=t[5]*a,l=t[6]*i,h=t[8]*r,g=t[9]*a,f=t[10]*i,p=o+d+f,v=0;return p>0?(v=2*Math.sqrt(p+1),e[3]=.25*v,e[0]=(l-g)/v,e[1]=(h-c)/v,e[2]=(s-u)/v):o>d&&o>f?(v=2*Math.sqrt(1+o-d-f),e[3]=(l-g)/v,e[0]=.25*v,e[1]=(s+u)/v,e[2]=(h+c)/v):d>f?(v=2*Math.sqrt(1+d-o-f),e[3]=(h-c)/v,e[0]=(s+u)/v,e[1]=.25*v,e[2]=(l+g)/v):(v=2*Math.sqrt(1+f-o-d),e[3]=(s-u)/v,e[0]=(h+c)/v,e[1]=(l+g)/v,e[2]=.25*v),e}function Le(e,t,n,r){var a=t[0],i=t[1],o=t[2],s=t[3],c=a+a,u=i+i,d=o+o,l=a*c,h=a*u,g=a*d,f=i*u,p=i*d,v=o*d,m=s*c,w=s*u,y=s*d,b=r[0],M=r[1],S=r[2];return e[0]=(1-(f+v))*b,e[1]=(h+y)*b,e[2]=(g-w)*b,e[3]=0,e[4]=(h-y)*M,e[5]=(1-(l+v))*M,e[6]=(p+m)*M,e[7]=0,e[8]=(g+w)*S,e[9]=(p-m)*S,e[10]=(1-(l+f))*S,e[11]=0,e[12]=n[0],e[13]=n[1],e[14]=n[2],e[15]=1,e}function Ve(e,t,n,r,a){var i=t[0],o=t[1],s=t[2],c=t[3],u=i+i,d=o+o,l=s+s,h=i*u,g=i*d,f=i*l,p=o*d,v=o*l,m=s*l,w=c*u,y=c*d,b=c*l,M=r[0],S=r[1],k=r[2],C=a[0],x=a[1],W=a[2],I=(1-(p+m))*M,R=(g+b)*M,P=(f-y)*M,T=(g-b)*S,D=(1-(h+m))*S,E=(v+w)*S,O=(f+y)*k,j=(v-w)*k,A=(1-(h+p))*k;return e[0]=I,e[1]=R,e[2]=P,e[3]=0,e[4]=T,e[5]=D,e[6]=E,e[7]=0,e[8]=O,e[9]=j,e[10]=A,e[11]=0,e[12]=n[0]+C-(I*C+T*x+O*W),e[13]=n[1]+x-(R*C+D*x+j*W),e[14]=n[2]+W-(P*C+E*x+A*W),e[15]=1,e}function qe(e,t){var n=t[0],r=t[1],a=t[2],i=t[3],o=n+n,s=r+r,c=a+a,u=n*o,d=r*o,l=r*s,h=a*o,g=a*s,f=a*c,p=i*o,v=i*s,m=i*c;return e[0]=1-l-f,e[1]=d+m,e[2]=h-v,e[3]=0,e[4]=d-m,e[5]=1-u-f,e[6]=g+p,e[7]=0,e[8]=h+v,e[9]=g-p,e[10]=1-u-l,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Ne(e,t,n,r,a,i,o){var s=1/(n-t),c=1/(a-r),u=1/(i-o);return e[0]=2*i*s,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=2*i*c,e[6]=0,e[7]=0,e[8]=(n+t)*s,e[9]=(a+r)*c,e[10]=(o+i)*u,e[11]=-1,e[12]=0,e[13]=0,e[14]=o*i*2*u,e[15]=0,e}function Ue(e,t,n,r,a){var i,o=1/Math.tan(t/2);return e[0]=o/n,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=o,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,null!=a&&a!==1/0?(i=1/(r-a),e[10]=(a+r)*i,e[14]=2*a*r*i):(e[10]=-1,e[14]=-2*r),e}function Fe(e,t,n,r){var a=Math.tan(t.upDegrees*Math.PI/180),i=Math.tan(t.downDegrees*Math.PI/180),o=Math.tan(t.leftDegrees*Math.PI/180),s=Math.tan(t.rightDegrees*Math.PI/180),c=2/(o+s),u=2/(a+i);return e[0]=c,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=u,e[6]=0,e[7]=0,e[8]=-(o-s)*c*.5,e[9]=(a-i)*u*.5,e[10]=r/(n-r),e[11]=-1,e[12]=0,e[13]=0,e[14]=r*n/(n-r),e[15]=0,e}function Be(e,t,n,r,a,i,o){var s=1/(t-n),c=1/(r-a),u=1/(i-o);return e[0]=-2*s,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*c,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*u,e[11]=0,e[12]=(t+n)*s,e[13]=(a+r)*c,e[14]=(o+i)*u,e[15]=1,e}function He(e,t,n,r){var a,i,o,s,c,u,d,l,h,g,f=t[0],p=t[1],v=t[2],m=r[0],w=r[1],y=r[2],b=n[0],M=n[1],S=n[2];return Math.abs(f-b)<ie&&Math.abs(p-M)<ie&&Math.abs(v-S)<ie?ge(e):(d=f-b,l=p-M,h=v-S,a=w*(h*=g=1/Math.hypot(d,l,h))-y*(l*=g),i=y*(d*=g)-m*h,o=m*l-w*d,(g=Math.hypot(a,i,o))?(a*=g=1/g,i*=g,o*=g):(a=0,i=0,o=0),s=l*o-h*i,c=h*a-d*o,u=d*i-l*a,(g=Math.hypot(s,c,u))?(s*=g=1/g,c*=g,u*=g):(s=0,c=0,u=0),e[0]=a,e[1]=s,e[2]=d,e[3]=0,e[4]=i,e[5]=c,e[6]=l,e[7]=0,e[8]=o,e[9]=u,e[10]=h,e[11]=0,e[12]=-(a*f+i*p+o*v),e[13]=-(s*f+c*p+u*v),e[14]=-(d*f+l*p+h*v),e[15]=1,e)}function Ge(e,t,n,r){var a=t[0],i=t[1],o=t[2],s=r[0],c=r[1],u=r[2],d=a-n[0],l=i-n[1],h=o-n[2],g=d*d+l*l+h*h;g>0&&(d*=g=1/Math.sqrt(g),l*=g,h*=g);var f=c*h-u*l,p=u*d-s*h,v=s*l-c*d;return(g=f*f+p*p+v*v)>0&&(f*=g=1/Math.sqrt(g),p*=g,v*=g),e[0]=f,e[1]=p,e[2]=v,e[3]=0,e[4]=l*v-h*p,e[5]=h*f-d*v,e[6]=d*p-l*f,e[7]=0,e[8]=d,e[9]=l,e[10]=h,e[11]=0,e[12]=a,e[13]=i,e[14]=o,e[15]=1,e}function _e(e){return"mat4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+", "+e[9]+", "+e[10]+", "+e[11]+", "+e[12]+", "+e[13]+", "+e[14]+", "+e[15]+")"}function Ye(e){return Math.hypot(e[0],e[1],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15])}function ze(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e[3]=t[3]+n[3],e[4]=t[4]+n[4],e[5]=t[5]+n[5],e[6]=t[6]+n[6],e[7]=t[7]+n[7],e[8]=t[8]+n[8],e[9]=t[9]+n[9],e[10]=t[10]+n[10],e[11]=t[11]+n[11],e[12]=t[12]+n[12],e[13]=t[13]+n[13],e[14]=t[14]+n[14],e[15]=t[15]+n[15],e}function Qe(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e[3]=t[3]-n[3],e[4]=t[4]-n[4],e[5]=t[5]-n[5],e[6]=t[6]-n[6],e[7]=t[7]-n[7],e[8]=t[8]-n[8],e[9]=t[9]-n[9],e[10]=t[10]-n[10],e[11]=t[11]-n[11],e[12]=t[12]-n[12],e[13]=t[13]-n[13],e[14]=t[14]-n[14],e[15]=t[15]-n[15],e}function Xe(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e[4]=t[4]*n,e[5]=t[5]*n,e[6]=t[6]*n,e[7]=t[7]*n,e[8]=t[8]*n,e[9]=t[9]*n,e[10]=t[10]*n,e[11]=t[11]*n,e[12]=t[12]*n,e[13]=t[13]*n,e[14]=t[14]*n,e[15]=t[15]*n,e}function Ke(e,t,n,r){return e[0]=t[0]+n[0]*r,e[1]=t[1]+n[1]*r,e[2]=t[2]+n[2]*r,e[3]=t[3]+n[3]*r,e[4]=t[4]+n[4]*r,e[5]=t[5]+n[5]*r,e[6]=t[6]+n[6]*r,e[7]=t[7]+n[7]*r,e[8]=t[8]+n[8]*r,e[9]=t[9]+n[9]*r,e[10]=t[10]+n[10]*r,e[11]=t[11]+n[11]*r,e[12]=t[12]+n[12]*r,e[13]=t[13]+n[13]*r,e[14]=t[14]+n[14]*r,e[15]=t[15]+n[15]*r,e}function Ze(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]&&e[9]===t[9]&&e[10]===t[10]&&e[11]===t[11]&&e[12]===t[12]&&e[13]===t[13]&&e[14]===t[14]&&e[15]===t[15]}function Je(e,t){var n=e[0],r=e[1],a=e[2],i=e[3],o=e[4],s=e[5],c=e[6],u=e[7],d=e[8],l=e[9],h=e[10],g=e[11],f=e[12],p=e[13],v=e[14],m=e[15],w=t[0],y=t[1],b=t[2],M=t[3],S=t[4],k=t[5],C=t[6],x=t[7],W=t[8],I=t[9],R=t[10],P=t[11],T=t[12],D=t[13],E=t[14],O=t[15];return Math.abs(n-w)<=ie*Math.max(1,Math.abs(n),Math.abs(w))&&Math.abs(r-y)<=ie*Math.max(1,Math.abs(r),Math.abs(y))&&Math.abs(a-b)<=ie*Math.max(1,Math.abs(a),Math.abs(b))&&Math.abs(i-M)<=ie*Math.max(1,Math.abs(i),Math.abs(M))&&Math.abs(o-S)<=ie*Math.max(1,Math.abs(o),Math.abs(S))&&Math.abs(s-k)<=ie*Math.max(1,Math.abs(s),Math.abs(k))&&Math.abs(c-C)<=ie*Math.max(1,Math.abs(c),Math.abs(C))&&Math.abs(u-x)<=ie*Math.max(1,Math.abs(u),Math.abs(x))&&Math.abs(d-W)<=ie*Math.max(1,Math.abs(d),Math.abs(W))&&Math.abs(l-I)<=ie*Math.max(1,Math.abs(l),Math.abs(I))&&Math.abs(h-R)<=ie*Math.max(1,Math.abs(h),Math.abs(R))&&Math.abs(g-P)<=ie*Math.max(1,Math.abs(g),Math.abs(P))&&Math.abs(f-T)<=ie*Math.max(1,Math.abs(f),Math.abs(T))&&Math.abs(p-D)<=ie*Math.max(1,Math.abs(p),Math.abs(D))&&Math.abs(v-E)<=ie*Math.max(1,Math.abs(v),Math.abs(E))&&Math.abs(m-O)<=ie*Math.max(1,Math.abs(m),Math.abs(O))}Math.hypot||(Math.hypot=function(){for(var e=0,t=arguments.length;t--;)e+=arguments[t]*arguments[t];return Math.sqrt(e)});var $e=we,et=Qe;function tt(){var e=new oe(3);return oe!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e}function nt(e){var t=new oe(3);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function rt(e){var t=e[0],n=e[1],r=e[2];return Math.hypot(t,n,r)}function at(e,t,n){var r=new oe(3);return r[0]=e,r[1]=t,r[2]=n,r}function it(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function ot(e,t,n,r){return e[0]=t,e[1]=n,e[2]=r,e}function st(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e}function ct(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e}function ut(e,t,n){return e[0]=t[0]*n[0],e[1]=t[1]*n[1],e[2]=t[2]*n[2],e}function dt(e,t,n){return e[0]=t[0]/n[0],e[1]=t[1]/n[1],e[2]=t[2]/n[2],e}function lt(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e}function ht(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e}function gt(e,t,n){return e[0]=Math.min(t[0],n[0]),e[1]=Math.min(t[1],n[1]),e[2]=Math.min(t[2],n[2]),e}function ft(e,t,n){return e[0]=Math.max(t[0],n[0]),e[1]=Math.max(t[1],n[1]),e[2]=Math.max(t[2],n[2]),e}function pt(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e}function vt(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e}function mt(e,t,n,r){return e[0]=t[0]+n[0]*r,e[1]=t[1]+n[1]*r,e[2]=t[2]+n[2]*r,e}function wt(e,t){var n=t[0]-e[0],r=t[1]-e[1],a=t[2]-e[2];return Math.hypot(n,r,a)}function yt(e,t){var n=t[0]-e[0],r=t[1]-e[1],a=t[2]-e[2];return n*n+r*r+a*a}function bt(e){var t=e[0],n=e[1],r=e[2];return t*t+n*n+r*r}function Mt(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e}function St(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e}function kt(e,t){var n=t[0],r=t[1],a=t[2],i=n*n+r*r+a*a;return i>0&&(i=1/Math.sqrt(i)),e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e}function Ct(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function xt(e,t,n){var r=t[0],a=t[1],i=t[2],o=n[0],s=n[1],c=n[2];return e[0]=a*c-i*s,e[1]=i*o-r*c,e[2]=r*s-a*o,e}function Wt(e,t,n,r){var a=t[0],i=t[1],o=t[2];return e[0]=a+r*(n[0]-a),e[1]=i+r*(n[1]-i),e[2]=o+r*(n[2]-o),e}function It(e,t,n,r,a,i){var o=i*i,s=o*(2*i-3)+1,c=o*(i-2)+i,u=o*(i-1),d=o*(3-2*i);return e[0]=t[0]*s+n[0]*c+r[0]*u+a[0]*d,e[1]=t[1]*s+n[1]*c+r[1]*u+a[1]*d,e[2]=t[2]*s+n[2]*c+r[2]*u+a[2]*d,e}function Rt(e,t,n,r,a,i){var o=1-i,s=o*o,c=i*i,u=s*o,d=3*i*s,l=3*c*o,h=c*i;return e[0]=t[0]*u+n[0]*d+r[0]*l+a[0]*h,e[1]=t[1]*u+n[1]*d+r[1]*l+a[1]*h,e[2]=t[2]*u+n[2]*d+r[2]*l+a[2]*h,e}function Pt(e,t){t=t||1;var n=2*se()*Math.PI,r=2*se()-1,a=Math.sqrt(1-r*r)*t;return e[0]=Math.cos(n)*a,e[1]=Math.sin(n)*a,e[2]=r*t,e}function Tt(e,t,n){var r=t[0],a=t[1],i=t[2],o=n[3]*r+n[7]*a+n[11]*i+n[15];return o=o||1,e[0]=(n[0]*r+n[4]*a+n[8]*i+n[12])/o,e[1]=(n[1]*r+n[5]*a+n[9]*i+n[13])/o,e[2]=(n[2]*r+n[6]*a+n[10]*i+n[14])/o,e}function Dt(e,t,n){var r=t[0],a=t[1],i=t[2];return e[0]=r*n[0]+a*n[3]+i*n[6],e[1]=r*n[1]+a*n[4]+i*n[7],e[2]=r*n[2]+a*n[5]+i*n[8],e}function Et(e,t,n){var r=n[0],a=n[1],i=n[2],o=n[3],s=t[0],c=t[1],u=t[2],d=a*u-i*c,l=i*s-r*u,h=r*c-a*s,g=a*h-i*l,f=i*d-r*h,p=r*l-a*d,v=2*o;return d*=v,l*=v,h*=v,g*=2,f*=2,p*=2,e[0]=s+d+g,e[1]=c+l+f,e[2]=u+h+p,e}function Ot(e,t,n,r){var a=[],i=[];return a[0]=t[0]-n[0],a[1]=t[1]-n[1],a[2]=t[2]-n[2],i[0]=a[0],i[1]=a[1]*Math.cos(r)-a[2]*Math.sin(r),i[2]=a[1]*Math.sin(r)+a[2]*Math.cos(r),e[0]=i[0]+n[0],e[1]=i[1]+n[1],e[2]=i[2]+n[2],e}function jt(e,t,n,r){var a=[],i=[];return a[0]=t[0]-n[0],a[1]=t[1]-n[1],a[2]=t[2]-n[2],i[0]=a[2]*Math.sin(r)+a[0]*Math.cos(r),i[1]=a[1],i[2]=a[2]*Math.cos(r)-a[0]*Math.sin(r),e[0]=i[0]+n[0],e[1]=i[1]+n[1],e[2]=i[2]+n[2],e}function At(e,t,n,r){var a=[],i=[];return a[0]=t[0]-n[0],a[1]=t[1]-n[1],a[2]=t[2]-n[2],i[0]=a[0]*Math.cos(r)-a[1]*Math.sin(r),i[1]=a[0]*Math.sin(r)+a[1]*Math.cos(r),i[2]=a[2],e[0]=i[0]+n[0],e[1]=i[1]+n[1],e[2]=i[2]+n[2],e}function Lt(e,t){var n=at(e[0],e[1],e[2]),r=at(t[0],t[1],t[2]);kt(n,n),kt(r,r);var a=Ct(n,r);return a>1?0:a<-1?Math.PI:Math.acos(a)}function Vt(e){return e[0]=0,e[1]=0,e[2]=0,e}function qt(e){return"vec3("+e[0]+", "+e[1]+", "+e[2]+")"}function Nt(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]}function Ut(e,t){var n=e[0],r=e[1],a=e[2],i=t[0],o=t[1],s=t[2];return Math.abs(n-i)<=ie*Math.max(1,Math.abs(n),Math.abs(i))&&Math.abs(r-o)<=ie*Math.max(1,Math.abs(r),Math.abs(o))&&Math.abs(a-s)<=ie*Math.max(1,Math.abs(a),Math.abs(s))}var Ft,Bt=ct,Ht=ut,Gt=dt,_t=wt,Yt=yt,zt=rt,Qt=bt,Xt=(Ft=tt(),function(e,t,n,r,a,i){var o,s;for(t||(t=3),n||(n=0),s=r?Math.min(r*t+n,e.length):e.length,o=n;o<s;o+=t)Ft[0]=e[o],Ft[1]=e[o+1],Ft[2]=e[o+2],a(Ft,Ft,i),e[o]=Ft[0],e[o+1]=Ft[1],e[o+2]=Ft[2];return e});function Kt(e){var t=e[0],n=e[1],r=e[2],a=e[3];return Math.hypot(t,n,r,a)}function Zt(e){var t=e[0],n=e[1],r=e[2],a=e[3];return t*t+n*n+r*r+a*a}!function(){var e,t=(e=new oe(4),oe!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0),e)}();function Jt(){var e=new oe(4);return oe!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e[3]=1,e}function $t(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e}function en(e,t,n){n*=.5;var r=Math.sin(n);return e[0]=r*t[0],e[1]=r*t[1],e[2]=r*t[2],e[3]=Math.cos(n),e}function tn(e,t){var n=2*Math.acos(t[3]),r=Math.sin(n/2);return r>ie?(e[0]=t[0]/r,e[1]=t[1]/r,e[2]=t[2]/r):(e[0]=1,e[1]=0,e[2]=0),n}function nn(e,t){var n=On(e,t);return Math.acos(2*n*n-1)}function rn(e,t,n){var r=t[0],a=t[1],i=t[2],o=t[3],s=n[0],c=n[1],u=n[2],d=n[3];return e[0]=r*d+o*s+a*u-i*c,e[1]=a*d+o*c+i*s-r*u,e[2]=i*d+o*u+r*c-a*s,e[3]=o*d-r*s-a*c-i*u,e}function an(e,t,n){n*=.5;var r=t[0],a=t[1],i=t[2],o=t[3],s=Math.sin(n),c=Math.cos(n);return e[0]=r*c+o*s,e[1]=a*c+i*s,e[2]=i*c-a*s,e[3]=o*c-r*s,e}function on(e,t,n){n*=.5;var r=t[0],a=t[1],i=t[2],o=t[3],s=Math.sin(n),c=Math.cos(n);return e[0]=r*c-i*s,e[1]=a*c+o*s,e[2]=i*c+r*s,e[3]=o*c-a*s,e}function sn(e,t,n){n*=.5;var r=t[0],a=t[1],i=t[2],o=t[3],s=Math.sin(n),c=Math.cos(n);return e[0]=r*c+a*s,e[1]=a*c-r*s,e[2]=i*c+o*s,e[3]=o*c-i*s,e}function cn(e,t){var n=t[0],r=t[1],a=t[2];return e[0]=n,e[1]=r,e[2]=a,e[3]=Math.sqrt(Math.abs(1-n*n-r*r-a*a)),e}function un(e,t){var n=t[0],r=t[1],a=t[2],i=t[3],o=Math.sqrt(n*n+r*r+a*a),s=Math.exp(i),c=o>0?s*Math.sin(o)/o:0;return e[0]=n*c,e[1]=r*c,e[2]=a*c,e[3]=s*Math.cos(o),e}function dn(e,t){var n=t[0],r=t[1],a=t[2],i=t[3],o=Math.sqrt(n*n+r*r+a*a),s=o>0?Math.atan2(o,i)/o:0;return e[0]=n*s,e[1]=r*s,e[2]=a*s,e[3]=.5*Math.log(n*n+r*r+a*a+i*i),e}function ln(e,t,n){return dn(e,t),En(e,e,n),un(e,e),e}function hn(e,t,n,r){var a,i,o,s,c,u=t[0],d=t[1],l=t[2],h=t[3],g=n[0],f=n[1],p=n[2],v=n[3];return(i=u*g+d*f+l*p+h*v)<0&&(i=-i,g=-g,f=-f,p=-p,v=-v),1-i>ie?(a=Math.acos(i),o=Math.sin(a),s=Math.sin((1-r)*a)/o,c=Math.sin(r*a)/o):(s=1-r,c=r),e[0]=s*u+c*g,e[1]=s*d+c*f,e[2]=s*l+c*p,e[3]=s*h+c*v,e}function gn(e){var t=se(),n=se(),r=se(),a=Math.sqrt(1-t),i=Math.sqrt(t);return e[0]=a*Math.sin(2*Math.PI*n),e[1]=a*Math.cos(2*Math.PI*n),e[2]=i*Math.sin(2*Math.PI*r),e[3]=i*Math.cos(2*Math.PI*r),e}function fn(e,t){var n=t[0],r=t[1],a=t[2],i=t[3],o=n*n+r*r+a*a+i*i,s=o?1/o:0;return e[0]=-n*s,e[1]=-r*s,e[2]=-a*s,e[3]=i*s,e}function pn(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3],e}function vn(e,t){var n,r=t[0]+t[4]+t[8];if(r>0)n=Math.sqrt(r+1),e[3]=.5*n,n=.5/n,e[0]=(t[5]-t[7])*n,e[1]=(t[6]-t[2])*n,e[2]=(t[1]-t[3])*n;else{var a=0;t[4]>t[0]&&(a=1),t[8]>t[3*a+a]&&(a=2);var i=(a+1)%3,o=(a+2)%3;n=Math.sqrt(t[3*a+a]-t[3*i+i]-t[3*o+o]+1),e[a]=.5*n,n=.5/n,e[3]=(t[3*i+o]-t[3*o+i])*n,e[i]=(t[3*i+a]+t[3*a+i])*n,e[o]=(t[3*o+a]+t[3*a+o])*n}return e}function mn(e,t,n,r){var a=.5*Math.PI/180;t*=a,n*=a,r*=a;var i=Math.sin(t),o=Math.cos(t),s=Math.sin(n),c=Math.cos(n),u=Math.sin(r),d=Math.cos(r);return e[0]=i*c*d-o*s*u,e[1]=o*s*d+i*c*u,e[2]=o*c*u-i*s*d,e[3]=o*c*d+i*s*u,e}function wn(e){return"quat("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"}var yn,bn,Mn,Sn,kn,Cn,xn,Wn=function(e){var t=new oe(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},In=function(e,t,n,r){var a=new oe(4);return a[0]=e,a[1]=t,a[2]=n,a[3]=r,a},Rn=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},Pn=function(e,t,n,r,a){return e[0]=t,e[1]=n,e[2]=r,e[3]=a,e},Tn=function(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e[3]=t[3]+n[3],e},Dn=rn,En=function(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e},On=function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]},jn=function(e,t,n,r){var a=t[0],i=t[1],o=t[2],s=t[3];return e[0]=a+r*(n[0]-a),e[1]=i+r*(n[1]-i),e[2]=o+r*(n[2]-o),e[3]=s+r*(n[3]-s),e},An=Kt,Ln=An,Vn=Zt,qn=Vn,Nn=function(e,t){var n=t[0],r=t[1],a=t[2],i=t[3],o=n*n+r*r+a*a+i*i;return o>0&&(o=1/Math.sqrt(o)),e[0]=n*o,e[1]=r*o,e[2]=a*o,e[3]=i*o,e},Un=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]},Fn=function(e,t){var n=e[0],r=e[1],a=e[2],i=e[3],o=t[0],s=t[1],c=t[2],u=t[3];return Math.abs(n-o)<=ie*Math.max(1,Math.abs(n),Math.abs(o))&&Math.abs(r-s)<=ie*Math.max(1,Math.abs(r),Math.abs(s))&&Math.abs(a-c)<=ie*Math.max(1,Math.abs(a),Math.abs(c))&&Math.abs(i-u)<=ie*Math.max(1,Math.abs(i),Math.abs(u))},Bn=(yn=tt(),bn=at(1,0,0),Mn=at(0,1,0),function(e,t,n){var r=Ct(t,n);return r<-.999999?(xt(yn,bn,t),zt(yn)<1e-6&&xt(yn,Mn,t),kt(yn,yn),en(e,yn,Math.PI),e):r>.999999?(e[0]=0,e[1]=0,e[2]=0,e[3]=1,e):(xt(yn,t,n),e[0]=yn[0],e[1]=yn[1],e[2]=yn[2],e[3]=1+r,Nn(e,e))}),Hn=(Sn=Jt(),kn=Jt(),function(e,t,n,r,a,i){return hn(Sn,t,a,i),hn(kn,n,r,i),hn(e,Sn,kn,2*i*(1-i)),e}),Gn=(Cn=new oe(9),oe!=Float32Array&&(Cn[1]=0,Cn[2]=0,Cn[3]=0,Cn[5]=0,Cn[6]=0,Cn[7]=0),Cn[0]=1,Cn[4]=1,Cn[8]=1,xn=Cn,function(e,t,n,r){return xn[0]=n[0],xn[3]=n[1],xn[6]=n[2],xn[1]=r[0],xn[4]=r[1],xn[7]=r[2],xn[2]=-t[0],xn[5]=-t[1],xn[8]=-t[2],Nn(e,vn(e,xn))});function _n(){var e=new oe(2);return oe!=Float32Array&&(e[0]=0,e[1]=0),e}function Yn(e){var t=new oe(2);return t[0]=e[0],t[1]=e[1],t}function zn(e,t){var n=new oe(2);return n[0]=e,n[1]=t,n}function Qn(e,t){return e[0]=t[0],e[1]=t[1],e}function Xn(e,t,n){return e[0]=t,e[1]=n,e}function Kn(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e}function Zn(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e}function Jn(e,t,n){return e[0]=t[0]*n[0],e[1]=t[1]*n[1],e}function $n(e,t,n){return e[0]=t[0]/n[0],e[1]=t[1]/n[1],e}function er(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e}function tr(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e}function nr(e,t,n){return e[0]=Math.min(t[0],n[0]),e[1]=Math.min(t[1],n[1]),e}function rr(e,t,n){return e[0]=Math.max(t[0],n[0]),e[1]=Math.max(t[1],n[1]),e}function ar(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e}function ir(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e}function or(e,t,n,r){return e[0]=t[0]+n[0]*r,e[1]=t[1]+n[1]*r,e}function sr(e,t){var n=t[0]-e[0],r=t[1]-e[1];return Math.hypot(n,r)}function cr(e,t){var n=t[0]-e[0],r=t[1]-e[1];return n*n+r*r}function ur(e){var t=e[0],n=e[1];return Math.hypot(t,n)}function dr(e){var t=e[0],n=e[1];return t*t+n*n}function lr(e,t){return e[0]=-t[0],e[1]=-t[1],e}function hr(e,t){return e[0]=1/t[0],e[1]=1/t[1],e}function gr(e,t){var n=t[0],r=t[1],a=n*n+r*r;return a>0&&(a=1/Math.sqrt(a)),e[0]=t[0]*a,e[1]=t[1]*a,e}function fr(e,t){return e[0]*t[0]+e[1]*t[1]}function pr(e,t,n){var r=t[0]*n[1]-t[1]*n[0];return e[0]=e[1]=0,e[2]=r,e}function vr(e,t,n,r){var a=t[0],i=t[1];return e[0]=a+r*(n[0]-a),e[1]=i+r*(n[1]-i),e}function mr(e,t){t=t||1;var n=2*se()*Math.PI;return e[0]=Math.cos(n)*t,e[1]=Math.sin(n)*t,e}function wr(e,t,n){var r=t[0],a=t[1];return e[0]=n[0]*r+n[2]*a,e[1]=n[1]*r+n[3]*a,e}function yr(e,t,n){var r=t[0],a=t[1];return e[0]=n[0]*r+n[2]*a+n[4],e[1]=n[1]*r+n[3]*a+n[5],e}function br(e,t,n){var r=t[0],a=t[1];return e[0]=n[0]*r+n[3]*a+n[6],e[1]=n[1]*r+n[4]*a+n[7],e}function Mr(e,t,n){var r=t[0],a=t[1];return e[0]=n[0]*r+n[4]*a+n[12],e[1]=n[1]*r+n[5]*a+n[13],e}function Sr(e,t,n,r){var a=t[0]-n[0],i=t[1]-n[1],o=Math.sin(r),s=Math.cos(r);return e[0]=a*s-i*o+n[0],e[1]=a*o+i*s+n[1],e}function kr(e,t){var n=e[0],r=e[1],a=t[0],i=t[1],o=n*n+r*r;o>0&&(o=1/Math.sqrt(o));var s=a*a+i*i;s>0&&(s=1/Math.sqrt(s));var c=(n*a+r*i)*o*s;return c>1?0:c<-1?Math.PI:Math.acos(c)}function Cr(e){return e[0]=0,e[1]=0,e}function xr(e){return"vec2("+e[0]+", "+e[1]+")"}function Wr(e,t){return e[0]===t[0]&&e[1]===t[1]}function Ir(e,t){var n=e[0],r=e[1],a=t[0],i=t[1];return Math.abs(n-a)<=ie*Math.max(1,Math.abs(n),Math.abs(a))&&Math.abs(r-i)<=ie*Math.max(1,Math.abs(r),Math.abs(i))}var Rr=ur,Pr=Zn,Tr=Jn,Dr=$n,Er=sr,Or=cr,jr=dr,Ar=function(){var e=_n();return function(t,n,r,a,i,o){var s,c;for(n||(n=2),r||(r=0),c=a?Math.min(a*n+r,t.length):t.length,s=r;s<c;s+=n)e[0]=t[s],e[1]=t[s+1],i(e,e,o),t[s]=e[0],t[s+1]=e[1];return t}}();function Lr(e){return e*Math.PI/180}var Vr={VIEWPORT_ROTATED:"viewportRotated"};function qr(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Nr(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?qr(Object(n),!0).forEach((function(t){W()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):qr(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Ur(e){if("number"!=typeof e||e!==Number(e)||!Number.isFinite(e))throw"Invalid number ".concat(e)}var Fr=function e(t){var n=this,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;f()(this,e),W()(this,"_state",null),W()(this,"eventWindow",void 0),W()(this,"getEventWindow",(function(){return n.eventWindow})),W()(this,"_rotate",(function(e,t,o,s){var c=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;Ur(o),Ur(s),Ur(c);var u=[];a.cross(u,e,t),a.normalize(u,u);var d=e,l=[],h=[],g=r.create();if(r.rotate(g,g,Lr(s),d),r.rotate(g,g,Lr(o),u),a.transformMat4(l,t,g),a.transformMat4(h,e,g),0!==c){var f=i.create();i.setAxisAngle(f,l,Lr(-c)),i.normalize(f,f),a.transformQuat(h,h,f)}n._state.cache.sliceNormal=l,n._state.cache.viewUp=h;var p=new CustomEvent(Vr.VIEWPORT_ROTATED,{detail:{sliceNormal:l,sliceViewUp:h,dThetaX:o,dThetaY:s,dThetaZ:c},bubbles:!0,cancelable:!0});n.eventWindow.dispatchEvent(p)})),W()(this,"rotateAbsolute",(function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;n._rotate(n._state.viewUp,n._state.sliceNormal,e,t,r)})),W()(this,"rotateRelative",(function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;n._rotate(n._state.cache.viewUp,n._state.cache.sliceNormal,e,t,r)})),W()(this,"setOrientation",(function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,1,0];n._state.sliceNormal=h()(e),n._state.viewUp=h()(t),n._state.cache.sliceNormal=h()(e),n._state.cache.viewUp=h()(t)})),W()(this,"getViewUp",(function(){return n._state.viewUp})),W()(this,"getSliceNormal",(function(){return n._state.sliceNormal})),W()(this,"getCurrentViewUp",(function(){return n._state.cache.viewUp})),W()(this,"getCurrentSliceNormal",(function(){return n._state.cache.sliceNormal})),W()(this,"getReadOnlyViewPort",(function(){var e=JSON.parse(JSON.stringify(n._state));return Object.freeze(e),e})),this.eventWindow=t,null===this._state?this._state={viewUp:[0,1,0],sliceNormal:[0,0,1]}:this._state=JSON.parse(JSON.stringify(o)),this._state.cache=Nr({},this._state)},Br=ae.a.States;function Hr(e,t,n){return e<t?t:e>n?n:e}function Gr(e,t){t.classHierarchy.push("vtkInteractorStyleMPRSlice"),t.trackballManipulator=Q.a.newInstance({button:1}),t.panManipulator=K.a.newInstance({button:2}),t.zoomManipulator=J.a.newInstance({button:3}),t.scrollManipulator=ee.a.newInstance({scrollEnabled:!0,dragEnabled:!1});var n={sliceNormal:[0,0,0],sliceRange:[0,0],sliceCenter:[]};function r(){var n=e.getSliceRange();t.scrollManipulator.removeScrollListener(),t.scrollManipulator.setScrollListener(n[0],n[1],1,e.getSlice,e.scrollToSlice)}function a(e){o(e.detail.sliceNormal),i(e.detail.sliceViewUp)}function i(e){var n=t.interactor.getCurrentRenderer().getActiveCamera();n.setViewUp.apply(n,h()(e))}function o(n){var r=t.interactor.getCurrentRenderer().getActiveCamera(),a=h()(n);if(t.volumeActor){B.a.normalize(a);var i=r.getFocalPoint(),o=r.getDistance(),s=r.getViewAngle();if(!function(e){var t=e.getDistance();return"number"==typeof t&&t===Number(t)&&Number.isFinite(t)}(r)){var c=t.volumeActor.getMapper().getBounds(),u=Math.sqrt(B.a.distance2BetweenPoints([c[0],c[2],c[4]],[c[1],c[3],c[5]]));i=[(c[0]+c[1])/2,(c[2]+c[3])/2,(c[4]+c[5])/2],s=90,o=u/(2*Math.tan(s/360*Math.PI))}var d=[i[0]-a[0]*o,i[1]-a[1]*o,i[2]-a[2]*o];r.setPosition.apply(r,d),r.setDistance(o),r.setDirectionOfProjection.apply(r,h()(a)),r.setViewAngle(s),r.setThicknessFromFocalPoint(t.slabThickness),e.setCenterOfRotation(i)}}e.setViewport=function(e){t.viewportData&&t.viewportData.getEventWindow().removeEventListener(Vr.VIEWPORT_ROTATED,a);t.viewportData=e,t.scrollManipulator.setViewportData&&t.scrollManipulator.setViewportData(e),e&&(o(e.getCurrentSliceNormal()),i(e.getCurrentViewUp()),e.getEventWindow().addEventListener(Vr.VIEWPORT_ROTATED,a))},e.getViewport=function(){return t.viewportData};var s=null,c=null,u=e.setInteractor;function d(){var n=t.apis,r=t.apiIndex;if(n&&n[r]&&"VIEW2D"===n[r].type){e.startPan();var a=n[r];a.svgWidgets.crosshairsWidget&&a.svgWidgets.crosshairsWidget.updateCrosshairForApi(a),a.svgWidgets.rotatableCrosshairsWidget&&a.svgWidgets.rotatableCrosshairsWidget.updateCrosshairForApi(a)}}e.setInteractor=function(n){if(u(n),s&&(s.unsubscribe(),s=null),c&&(c.unsubscribe(),c=null),n){var a=n.getCurrentRenderer().getActiveCamera();s=a.onModified((function(){r(),e.modified()})),c=n.onAnimation((function(){a.setThicknessFromFocalPoint(t.slabThickness)}));var i=t.interactor.getContainer();e.setViewport(new Fr(i))}else e.setViewport(null)},e.handleMiddleButtonPress=U.a.chain(e.handleMiddleButtonPress,d),e.handleRightButtonPress=U.a.chain(e.handleRightButtonPress,d);var l=e.handleMouseMove;function g(n){if(t.state===Br.IS_PAN){e.endPan();var r=t.apis[t.apiIndex];r.svgWidgets.crosshairsWidget&&r.svgWidgets.crosshairsWidget.updateCrosshairForApi(r),r.svgWidgets.rotatableCrosshairsWidget&&r.svgWidgets.rotatableCrosshairsWidget.updateCrosshairForApi(r)}n()}e.handleMouseMove=function(e){if(l&&l(e),t.state===Br.IS_PAN){var n=t.apis[t.apiIndex];n.svgWidgets.crosshairsWidget&&n.svgWidgets.crosshairsWidget.updateCrosshairForApi(n),n.svgWidgets.rotatableCrosshairsWidget&&n.svgWidgets.rotatableCrosshairsWidget.updateCrosshairForApi(n)}},e.superHandleMiddleButtonRelease=e.handleMiddleButtonRelease,e.handleMiddleButtonRelease=function(){g(e.superHandleMiddleButtonRelease)},e.superHandleRightButtonRelease=e.handleRightButtonRelease,e.handleRightButtonRelease=function(){g(e.superHandleRightButtonRelease)},e.setVolumeActor=function(n){t.volumeActor=n;var a=t.interactor.getCurrentRenderer().getActiveCamera();if(n){a.setFreezeFocalPoint(!0);var s=e.getViewport();s&&(o(s.getCurrentSliceNormal()),i(s.getCurrentViewUp())),r()}else a.setFreezeFocalPoint(!1)},e.getSlice=function(){var n=t.interactor.getCurrentRenderer().getActiveCamera(),r=e.getSliceNormal(),a=G.a.buildFromDegree().identity().rotateFromDirections(r,[1,0,0]),i=n.getFocalPoint();return a.apply(i),i[0]},e.scrollToSlice=function(t){var n=new CustomEvent("vtkscrollevent",{detail:{uid:e.getUid()}});window.dispatchEvent(n);var r=e.setSlice(t),a=e.getOnScroll();a&&a({slicePoint:r})},t.onScroll=function(){var e=t.apis,n=t.apiIndex;if(e&&e[n]&&"VIEW2D"===e[n].type){var r=e[n];if(!r.svgWidgets.crosshairsWidget&&!r.svgWidgets.rotatableCrosshairsWidget)return;var a=r.genericRenderWindow.getRenderer(),i=r.get("cachedCrosshairWorldPosition");if(void 0===i)return;var o=ne.a.newInstance();o.setCoordinateSystemToWorld(),o.setValue.apply(o,h()(i));var s=o.getComputedDoubleDisplayValue(a),c=ne.a.newInstance();c.setCoordinateSystemToDisplay(),c.setValue(s[0],s[1],0);for(var u=c.getComputedWorldValue(a),d=a.getActiveCamera().getDirectionOfProjection(),l=r.getSlabThickness()/2,g=0;g<u.length;g++)u[g]+=l*d[g];r.svgWidgets.crosshairsWidget&&r.svgWidgets.crosshairsWidget.moveCrosshairs(u,e,n),r.svgWidgets.rotatableCrosshairsWidget&&r.svgWidgets.rotatableCrosshairsWidget.moveCrosshairs(u,e,n)}},e.setSlice=function(r){var a=t.interactor.getCurrentRenderer().getActiveCamera();if(t.volumeActor){var i=e.getSliceRange(),o=t.volumeActor.getMapper().getBounds(),s=Hr.apply(void 0,[r].concat(h()(i))),c=[0,0,0];if(n.sliceCenter.length){var u=a.getFocalPoint();B.a.subtract(u,n.sliceCenter,c)}var d=[(o[0]+o[1])/2,(o[2]+o[3])/2,(o[4]+o[5])/2],l=a.getDistance(),g=a.getDirectionOfProjection();B.a.normalize(g);var f=(i[1]+i[0])/2,p=[d[0]-g[0]*f,d[1]-g[1]*f,d[2]-g[2]*f],v=[p[0]+g[0]*s,p[1]+g[1]*s,p[2]+g[2]*s];n.sliceCenter=[].concat(v);var m=[v[0]-g[0]*l,v[1]-g[1]*l,v[2]-g[2]*l];return B.a.add(v,c,v),B.a.add(m,c,m),a.setPosition.apply(a,m),a.setFocalPoint.apply(a,v),v}},e.getSliceRange=function(){if(t.volumeActor){var r=e.getSliceNormal();if(r[0]===n.sliceNormal[0]&&r[1]===n.sliceNormal[1]&&r[2]===n.sliceNormal[2])return n.sliceRange;var a=function(e){return[[e[0],e[2],e[4]],[e[0],e[2],e[5]],[e[0],e[3],e[4]],[e[0],e[3],e[5]],[e[1],e[2],e[4]],[e[1],e[2],e[5]],[e[1],e[3],e[4]],[e[1],e[3],e[5]]]}(t.volumeActor.getMapper().getBounds()),i=G.a.buildFromDegree().identity().rotateFromDirections(r,[1,0,0]);a.forEach((function(e){return i.apply(e)}));for(var o=1/0,s=-1/0,c=0;c<8;c++){var u=a[c][0];u>s&&(s=u),u<o&&(o=u)}return n.sliceNormal=r,n.sliceRange=[o,s],n.sliceRange}return[0,0]},e.getSliceNormal=function(){return t.volumeActor&&t.interactor?t.interactor.getCurrentRenderer().getActiveCamera().getDirectionOfProjection():[0,0,0]},e.setSliceNormal=function(){for(var t=e.getViewport(),n=arguments.length,r=new Array(n),a=0;a<n;a++)r[a]=arguments[a];t&&t.setOrientation(r,t.getCurrentViewUp()),o(r)},e.getViewUp=function(){return t.volumeActor&&t.interactor?t.interactor.getCurrentRenderer().getActiveCamera().getViewUp():[0,0,0]},e.setViewUp=function(){for(var t=e.getViewport(),n=arguments.length,r=new Array(n),a=0;a<n;a++)r[a]=arguments[a];t&&t.setOrientation(t.getSliceNormal(),r),i(r)},e.setSliceOrientation=function(t,n){var r=e.getViewport();r&&r.setOrientation(t,n),o(t),i(n)},e.setSlabThickness=function(e){t.slabThickness=e,t.interactor.getCurrentRenderer().getActiveCamera().setThicknessFromFocalPoint(e)},e.setUid=function(e){t.uid=e},e.getUid=function(){return t.uid},e.removeAllMouseManipulators(),e.addMouseManipulator(t.trackballManipulator),e.addMouseManipulator(t.panManipulator),e.addMouseManipulator(t.zoomManipulator),e.addMouseManipulator(t.scrollManipulator),r()}var _r={slabThickness:.1,uid:""};function Yr(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object.assign(t,_r,n),Y.a.extend(e,t,n),U.a.setGet(e,t,["onScroll"]),U.a.get(e,t,["slabThickness","volumeActor","apis","apiIndex"]),Gr(e,t)}var zr=U.a.newInstance(Yr,"vtkInteractorStyleMPRSlice"),Qr=Object.assign({newInstance:zr,extend:Yr});var Xr=n(23),Kr=n.n(Xr),Zr=n(24),Jr=n.n(Zr),$r=U.a.vtkErrorMacro,ea=1;function ta(e,t){var n,r;t.classHierarchy.push("vtkSVGWidgetManager"),t.widgetId="vtkSVGWidgetManager-".concat(ea++),t.svgRootNode=(n=t.widgetId,(r=document.createElement("svg")).setAttribute("id",n),r.setAttribute("style","position: absolute; top: 0; left: 0; width: 100%; height: 100%;"),r.setAttribute("version","1.1"),r.setAttribute("xmlns","http://www.w3.org/2000/svg"),r),t.widgets=[],e.setRenderer=function(n){var r=n.getRenderWindow().getInteractor();t.openGLRenderWindow=r.getView(),e.setContainer(t.openGLRenderWindow.getReferenceByName("el"))},e.setContainer=function(n){t.container&&t.container!==n&&(t.svgRootNode.parentNode===t.container?t.container.removeChild(t.svgRootNode):$r("Error: SVG parent node does not match container")),t.container!==n&&(t.container=n,t.container&&t.container.appendChild(t.svgRootNode),e.modified())},e.getSize=function(){return t.openGLRenderWindow.getSize()},e.addWidget=function(n){-1===t.widgets.indexOf(n)&&t.widgets.push(n),e.render()},e.removeWidget=function(n){var r=n.getWidgetId(),a=t.svgRootNode.querySelector("#".concat(r));t.svgRootNode.removeChild(a);var i=t.widgets.indexOf(n);-1!==i&&t.widgets.splice(i,1),e.render()},e.render=function(){t.svgRootNode&&requestAnimationFrame((function(){var n=t.scale,r=e.getSize(),a=d()(r,2),i=a[0],o=a[1];t.svgRootNode.setAttribute("viewBox","0 0 ".concat(i*n," ").concat(o*n)),t.svgRootNode.setAttribute("width","".concat(i*n)),t.svgRootNode.setAttribute("height","".concat(o*n));for(var s=0;s<t.widgets.length;s++)t.widgets[s].render(t.svgRootNode,t.scale)}))}}var na={scale:.5};function ra(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object.assign(t,na,n),U.a.obj(e,t),U.a.get(e,t,["container"]),U.a.setGet(e,t,["scale"]),ta(e,t)}var aa={newInstance:U.a.newInstance(ra,"vtkSVGWidgetManager"),extend:ra};var ia={lessThanXSeconds:{one:"less than a second",other:"less than {{count}} seconds"},xSeconds:{one:"1 second",other:"{{count}} seconds"},halfAMinute:"half a minute",lessThanXMinutes:{one:"less than a minute",other:"less than {{count}} minutes"},xMinutes:{one:"1 minute",other:"{{count}} minutes"},aboutXHours:{one:"about 1 hour",other:"about {{count}} hours"},xHours:{one:"1 hour",other:"{{count}} hours"},xDays:{one:"1 day",other:"{{count}} days"},aboutXMonths:{one:"about 1 month",other:"about {{count}} months"},xMonths:{one:"1 month",other:"{{count}} months"},aboutXYears:{one:"about 1 year",other:"about {{count}} years"},xYears:{one:"1 year",other:"{{count}} years"},overXYears:{one:"over 1 year",other:"over {{count}} years"},almostXYears:{one:"almost 1 year",other:"almost {{count}} years"}};function oa(e){return function(t){var n=t||{},r=n.width?String(n.width):e.defaultWidth;return e.formats[r]||e.formats[e.defaultWidth]}}var sa={date:oa({formats:{full:"EEEE, MMMM do, y",long:"MMMM do, y",medium:"MMM d, y",short:"MM/dd/yyyy"},defaultWidth:"full"}),time:oa({formats:{full:"h:mm:ss a zzzz",long:"h:mm:ss a z",medium:"h:mm:ss a",short:"h:mm a"},defaultWidth:"full"}),dateTime:oa({formats:{full:"{{date}} 'at' {{time}}",long:"{{date}} 'at' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},defaultWidth:"full"})},ca={lastWeek:"'last' eeee 'at' p",yesterday:"'yesterday at' p",today:"'today at' p",tomorrow:"'tomorrow at' p",nextWeek:"eeee 'at' p",other:"P"};function ua(e){return function(t,n){var r,a=n||{};if("formatting"===(a.context?String(a.context):"standalone")&&e.formattingValues){var i=e.defaultFormattingWidth||e.defaultWidth,o=a.width?String(a.width):i;r=e.formattingValues[o]||e.formattingValues[i]}else{var s=e.defaultWidth,c=a.width?String(a.width):e.defaultWidth;r=e.values[c]||e.values[s]}return r[e.argumentCallback?e.argumentCallback(t):t]}}function da(e){return function(t,n){var r=String(t),a=n||{},i=a.width,o=i&&e.matchPatterns[i]||e.matchPatterns[e.defaultMatchWidth],s=r.match(o);if(!s)return null;var c,u=s[0],d=i&&e.parsePatterns[i]||e.parsePatterns[e.defaultParseWidth];return c="[object Array]"===Object.prototype.toString.call(d)?function(e,t){for(var n=0;n<e.length;n++)if(t(e[n]))return n}(d,(function(e){return e.test(r)})):function(e,t){for(var n in e)if(e.hasOwnProperty(n)&&t(e[n]))return n}(d,(function(e){return e.test(r)})),c=e.valueCallback?e.valueCallback(c):c,{value:c=a.valueCallback?a.valueCallback(c):c,rest:r.slice(u.length)}}}var la,ha={code:"en-US",formatDistance:function(e,t,n){var r;return n=n||{},r="string"==typeof ia[e]?ia[e]:1===t?ia[e].one:ia[e].other.replace("{{count}}",t),n.addSuffix?n.comparison>0?"in "+r:r+" ago":r},formatLong:sa,formatRelative:function(e,t,n,r){return ca[e]},localize:{ordinalNumber:function(e,t){var n=Number(e),r=n%100;if(r>20||r<10)switch(r%10){case 1:return n+"st";case 2:return n+"nd";case 3:return n+"rd"}return n+"th"},era:ua({values:{narrow:["B","A"],abbreviated:["BC","AD"],wide:["Before Christ","Anno Domini"]},defaultWidth:"wide"}),quarter:ua({values:{narrow:["1","2","3","4"],abbreviated:["Q1","Q2","Q3","Q4"],wide:["1st quarter","2nd quarter","3rd quarter","4th quarter"]},defaultWidth:"wide",argumentCallback:function(e){return Number(e)-1}}),month:ua({values:{narrow:["J","F","M","A","M","J","J","A","S","O","N","D"],abbreviated:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],wide:["January","February","March","April","May","June","July","August","September","October","November","December"]},defaultWidth:"wide"}),day:ua({values:{narrow:["S","M","T","W","T","F","S"],short:["Su","Mo","Tu","We","Th","Fr","Sa"],abbreviated:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],wide:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},defaultWidth:"wide"}),dayPeriod:ua({values:{narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"}},defaultWidth:"wide",formattingValues:{narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"}},defaultFormattingWidth:"wide"})},match:{ordinalNumber:(la={matchPattern:/^(\d+)(th|st|nd|rd)?/i,parsePattern:/\d+/i,valueCallback:function(e){return parseInt(e,10)}},function(e,t){var n=String(e),r=t||{},a=n.match(la.matchPattern);if(!a)return null;var i=a[0],o=n.match(la.parsePattern);if(!o)return null;var s=la.valueCallback?la.valueCallback(o[0]):o[0];return{value:s=r.valueCallback?r.valueCallback(s):s,rest:n.slice(i.length)}}),era:da({matchPatterns:{narrow:/^(b|a)/i,abbreviated:/^(b\.?\s?c\.?|b\.?\s?c\.?\s?e\.?|a\.?\s?d\.?|c\.?\s?e\.?)/i,wide:/^(before christ|before common era|anno domini|common era)/i},defaultMatchWidth:"wide",parsePatterns:{any:[/^b/i,/^(a|c)/i]},defaultParseWidth:"any"}),quarter:da({matchPatterns:{narrow:/^[1234]/i,abbreviated:/^q[1234]/i,wide:/^[1234](th|st|nd|rd)? quarter/i},defaultMatchWidth:"wide",parsePatterns:{any:[/1/i,/2/i,/3/i,/4/i]},defaultParseWidth:"any",valueCallback:function(e){return e+1}}),month:da({matchPatterns:{narrow:/^[jfmasond]/i,abbreviated:/^(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)/i,wide:/^(january|february|march|april|may|june|july|august|september|october|november|december)/i},defaultMatchWidth:"wide",parsePatterns:{narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ja/i,/^f/i,/^mar/i,/^ap/i,/^may/i,/^jun/i,/^jul/i,/^au/i,/^s/i,/^o/i,/^n/i,/^d/i]},defaultParseWidth:"any"}),day:da({matchPatterns:{narrow:/^[smtwf]/i,short:/^(su|mo|tu|we|th|fr|sa)/i,abbreviated:/^(sun|mon|tue|wed|thu|fri|sat)/i,wide:/^(sunday|monday|tuesday|wednesday|thursday|friday|saturday)/i},defaultMatchWidth:"wide",parsePatterns:{narrow:[/^s/i,/^m/i,/^t/i,/^w/i,/^t/i,/^f/i,/^s/i],any:[/^su/i,/^m/i,/^tu/i,/^w/i,/^th/i,/^f/i,/^sa/i]},defaultParseWidth:"any"}),dayPeriod:da({matchPatterns:{narrow:/^(a|p|mi|n|(in the|at) (morning|afternoon|evening|night))/i,any:/^([ap]\.?\s?m\.?|midnight|noon|(in the|at) (morning|afternoon|evening|night))/i},defaultMatchWidth:"any",parsePatterns:{any:{am:/^a/i,pm:/^p/i,midnight:/^mi/i,noon:/^no/i,morning:/morning/i,afternoon:/afternoon/i,evening:/evening/i,night:/night/i}},defaultParseWidth:"any"})},options:{weekStartsOn:0,firstWeekContainsDate:1}};function ga(e){if(null===e||!0===e||!1===e)return NaN;var t=Number(e);return isNaN(t)?t:t<0?Math.ceil(t):Math.floor(t)}function fa(e){if(arguments.length<1)throw new TypeError("1 argument required, but only "+arguments.length+" present");var t=Object.prototype.toString.call(e);return e instanceof Date||"object"==typeof e&&"[object Date]"===t?new Date(e.getTime()):"number"==typeof e||"[object Number]"===t?new Date(e):("string"!=typeof e&&"[object String]"!==t||"undefined"==typeof console||(console.warn("Starting with v2.0.0-beta.1 date-fns doesn't accept strings as arguments. Please use `parseISO` to parse strings. See: https://git.io/fjule"),console.warn((new Error).stack)),new Date(NaN))}function pa(e,t){if(arguments.length<2)throw new TypeError("2 arguments required, but only "+arguments.length+" present");return function(e,t){if(arguments.length<2)throw new TypeError("2 arguments required, but only "+arguments.length+" present");var n=fa(e).getTime(),r=ga(t);return new Date(n+r)}(e,-ga(t))}function va(e,t){if(null==e)throw new TypeError("assign requires that input parameter not be null or undefined");for(var n in t=t||{})t.hasOwnProperty(n)&&(e[n]=t[n]);return e}function ma(e,t){switch(e){case"P":return t.date({width:"short"});case"PP":return t.date({width:"medium"});case"PPP":return t.date({width:"long"});case"PPPP":default:return t.date({width:"full"})}}function wa(e,t){switch(e){case"p":return t.time({width:"short"});case"pp":return t.time({width:"medium"});case"ppp":return t.time({width:"long"});case"pppp":default:return t.time({width:"full"})}}var ya={p:wa,P:function(e,t){var n,r=e.match(/(P+)(p+)?/),a=r[1],i=r[2];if(!i)return ma(e,t);switch(a){case"P":n=t.dateTime({width:"short"});break;case"PP":n=t.dateTime({width:"medium"});break;case"PPP":n=t.dateTime({width:"long"});break;case"PPPP":default:n=t.dateTime({width:"full"})}return n.replace("{{date}}",ma(a,t)).replace("{{time}}",wa(i,t))}},ba=6e4;function Ma(e){var t=new Date(e.getTime()),n=t.getTimezoneOffset();t.setSeconds(0,0);var r=t.getTime()%ba;return n*ba+r}var Sa=["D","DD"],ka=["YY","YYYY"];function Ca(e){return-1!==Sa.indexOf(e)}function xa(e){return-1!==ka.indexOf(e)}function Wa(e){if("YYYY"===e)throw new RangeError("Use `yyyy` instead of `YYYY` for formatting years; see: https://git.io/fxCyr");if("YY"===e)throw new RangeError("Use `yy` instead of `YY` for formatting years; see: https://git.io/fxCyr");if("D"===e)throw new RangeError("Use `d` instead of `D` for formatting days of the month; see: https://git.io/fxCyr");if("DD"===e)throw new RangeError("Use `dd` instead of `DD` for formatting days of the month; see: https://git.io/fxCyr")}function Ia(e,t){if(arguments.length<1)throw new TypeError("1 argument required, but only "+arguments.length+" present");var n=t||{},r=n.locale,a=r&&r.options&&r.options.weekStartsOn,i=null==a?0:ga(a),o=null==n.weekStartsOn?i:ga(n.weekStartsOn);if(!(o>=0&&o<=6))throw new RangeError("weekStartsOn must be between 0 and 6 inclusively");var s=fa(e),c=s.getUTCDay(),u=(c<o?7:0)+c-o;return s.setUTCDate(s.getUTCDate()-u),s.setUTCHours(0,0,0,0),s}function Ra(e,t){if(arguments.length<1)throw new TypeError("1 argument required, but only "+arguments.length+" present");var n=fa(e,t),r=n.getUTCFullYear(),a=t||{},i=a.locale,o=i&&i.options&&i.options.firstWeekContainsDate,s=null==o?1:ga(o),c=null==a.firstWeekContainsDate?s:ga(a.firstWeekContainsDate);if(!(c>=1&&c<=7))throw new RangeError("firstWeekContainsDate must be between 1 and 7 inclusively");var u=new Date(0);u.setUTCFullYear(r+1,0,c),u.setUTCHours(0,0,0,0);var d=Ia(u,t),l=new Date(0);l.setUTCFullYear(r,0,c),l.setUTCHours(0,0,0,0);var h=Ia(l,t);return n.getTime()>=d.getTime()?r+1:n.getTime()>=h.getTime()?r:r-1}function Pa(e,t,n){if(arguments.length<2)throw new TypeError("2 arguments required, but only "+arguments.length+" present");var r=n||{},a=r.locale,i=a&&a.options&&a.options.weekStartsOn,o=null==i?0:ga(i),s=null==r.weekStartsOn?o:ga(r.weekStartsOn);if(!(s>=0&&s<=6))throw new RangeError("weekStartsOn must be between 0 and 6 inclusively");var c=fa(e),u=ga(t),d=((u%7+7)%7<s?7:0)+u-c.getUTCDay();return c.setUTCDate(c.getUTCDate()+d),c}function Ta(e){if(arguments.length<1)throw new TypeError("1 argument required, but only "+arguments.length+" present");var t=fa(e),n=t.getUTCDay(),r=(n<1?7:0)+n-1;return t.setUTCDate(t.getUTCDate()-r),t.setUTCHours(0,0,0,0),t}function Da(e){if(arguments.length<1)throw new TypeError("1 argument required, but only "+arguments.length+" present");var t=fa(e),n=t.getUTCFullYear(),r=new Date(0);r.setUTCFullYear(n+1,0,4),r.setUTCHours(0,0,0,0);var a=Ta(r),i=new Date(0);i.setUTCFullYear(n,0,4),i.setUTCHours(0,0,0,0);var o=Ta(i);return t.getTime()>=a.getTime()?n+1:t.getTime()>=o.getTime()?n:n-1}var Ea=6048e5;function Oa(e){if(arguments.length<1)throw new TypeError("1 argument required, but only "+arguments.length+" present");var t=fa(e),n=Ta(t).getTime()-function(e){if(arguments.length<1)throw new TypeError("1 argument required, but only "+arguments.length+" present");var t=Da(e),n=new Date(0);return n.setUTCFullYear(t,0,4),n.setUTCHours(0,0,0,0),Ta(n)}(t).getTime();return Math.round(n/Ea)+1}var ja=6048e5;function Aa(e,t){if(arguments.length<1)throw new TypeError("1 argument required, but only "+arguments.length+" present");var n=fa(e),r=Ia(n,t).getTime()-function(e,t){if(arguments.length<1)throw new TypeError("1 argument required, but only "+arguments.length+" present");var n=t||{},r=n.locale,a=r&&r.options&&r.options.firstWeekContainsDate,i=null==a?1:ga(a),o=null==n.firstWeekContainsDate?i:ga(n.firstWeekContainsDate),s=Ra(e,t),c=new Date(0);return c.setUTCFullYear(s,0,o),c.setUTCHours(0,0,0,0),Ia(c,t)}(n,t).getTime();return Math.round(r/ja)+1}var La=36e5,Va=6e4,qa=1e3,Na={month:/^(1[0-2]|0?\d)/,date:/^(3[0-1]|[0-2]?\d)/,dayOfYear:/^(36[0-6]|3[0-5]\d|[0-2]?\d?\d)/,week:/^(5[0-3]|[0-4]?\d)/,hour23h:/^(2[0-3]|[0-1]?\d)/,hour24h:/^(2[0-4]|[0-1]?\d)/,hour11h:/^(1[0-1]|0?\d)/,hour12h:/^(1[0-2]|0?\d)/,minute:/^[0-5]?\d/,second:/^[0-5]?\d/,singleDigit:/^\d/,twoDigits:/^\d{1,2}/,threeDigits:/^\d{1,3}/,fourDigits:/^\d{1,4}/,anyDigitsSigned:/^-?\d+/,singleDigitSigned:/^-?\d/,twoDigitsSigned:/^-?\d{1,2}/,threeDigitsSigned:/^-?\d{1,3}/,fourDigitsSigned:/^-?\d{1,4}/},Ua=/^([+-])(\d{2})(\d{2})?|Z/,Fa=/^([+-])(\d{2})(\d{2})|Z/,Ba=/^([+-])(\d{2})(\d{2})((\d{2}))?|Z/,Ha=/^([+-])(\d{2}):(\d{2})|Z/,Ga=/^([+-])(\d{2}):(\d{2})(:(\d{2}))?|Z/;function _a(e,t,n){var r=t.match(e);if(!r)return null;var a=parseInt(r[0],10);return{value:n?n(a):a,rest:t.slice(r[0].length)}}function Ya(e,t){var n=t.match(e);if(!n)return null;if("Z"===n[0])return{value:0,rest:t.slice(1)};var r="+"===n[1]?1:-1,a=n[2]?parseInt(n[2],10):0,i=n[3]?parseInt(n[3],10):0,o=n[5]?parseInt(n[5],10):0;return{value:r*(a*La+i*Va+o*qa),rest:t.slice(n[0].length)}}function za(e,t){return _a(Na.anyDigitsSigned,e,t)}function Qa(e,t,n){switch(e){case 1:return _a(Na.singleDigit,t,n);case 2:return _a(Na.twoDigits,t,n);case 3:return _a(Na.threeDigits,t,n);case 4:return _a(Na.fourDigits,t,n);default:return _a(new RegExp("^\\d{1,"+e+"}"),t,n)}}function Xa(e,t,n){switch(e){case 1:return _a(Na.singleDigitSigned,t,n);case 2:return _a(Na.twoDigitsSigned,t,n);case 3:return _a(Na.threeDigitsSigned,t,n);case 4:return _a(Na.fourDigitsSigned,t,n);default:return _a(new RegExp("^-?\\d{1,"+e+"}"),t,n)}}function Ka(e){switch(e){case"morning":return 4;case"evening":return 17;case"pm":case"noon":case"afternoon":return 12;case"am":case"midnight":case"night":default:return 0}}function Za(e,t){var n,r=t>0,a=r?t:1-t;if(a<=50)n=e||100;else{var i=a+50;n=e+100*Math.floor(i/100)-(e>=i%100?100:0)}return r?n:1-n}var Ja=[31,28,31,30,31,30,31,31,30,31,30,31],$a=[31,29,31,30,31,30,31,31,30,31,30,31];function ei(e){return e%400==0||e%4==0&&e%100!=0}var ti={G:{priority:140,parse:function(e,t,n,r){switch(t){case"G":case"GG":case"GGG":return n.era(e,{width:"abbreviated"})||n.era(e,{width:"narrow"});case"GGGGG":return n.era(e,{width:"narrow"});case"GGGG":default:return n.era(e,{width:"wide"})||n.era(e,{width:"abbreviated"})||n.era(e,{width:"narrow"})}},set:function(e,t,n,r){return t.era=n,e.setUTCFullYear(n,0,1),e.setUTCHours(0,0,0,0),e},incompatibleTokens:["R","u","t","T"]},y:{priority:130,parse:function(e,t,n,r){var a=function(e){return{year:e,isTwoDigitYear:"yy"===t}};switch(t){case"y":return Qa(4,e,a);case"yo":return n.ordinalNumber(e,{unit:"year",valueCallback:a});default:return Qa(t.length,e,a)}},validate:function(e,t,n){return t.isTwoDigitYear||t.year>0},set:function(e,t,n,r){var a=e.getUTCFullYear();if(n.isTwoDigitYear){var i=Za(n.year,a);return e.setUTCFullYear(i,0,1),e.setUTCHours(0,0,0,0),e}var o="era"in t&&1!==t.era?1-n.year:n.year;return e.setUTCFullYear(o,0,1),e.setUTCHours(0,0,0,0),e},incompatibleTokens:["Y","R","u","w","I","i","e","c","t","T"]},Y:{priority:130,parse:function(e,t,n,r){var a=function(e){return{year:e,isTwoDigitYear:"YY"===t}};switch(t){case"Y":return Qa(4,e,a);case"Yo":return n.ordinalNumber(e,{unit:"year",valueCallback:a});default:return Qa(t.length,e,a)}},validate:function(e,t,n){return t.isTwoDigitYear||t.year>0},set:function(e,t,n,r){var a=Ra(e,r);if(n.isTwoDigitYear){var i=Za(n.year,a);return e.setUTCFullYear(i,0,r.firstWeekContainsDate),e.setUTCHours(0,0,0,0),Ia(e,r)}var o="era"in t&&1!==t.era?1-n.year:n.year;return e.setUTCFullYear(o,0,r.firstWeekContainsDate),e.setUTCHours(0,0,0,0),Ia(e,r)},incompatibleTokens:["y","R","u","Q","q","M","L","I","d","D","i","t","T"]},R:{priority:130,parse:function(e,t,n,r){return Xa("R"===t?4:t.length,e)},set:function(e,t,n,r){var a=new Date(0);return a.setUTCFullYear(n,0,4),a.setUTCHours(0,0,0,0),Ta(a)},incompatibleTokens:["G","y","Y","u","Q","q","M","L","w","d","D","e","c","t","T"]},u:{priority:130,parse:function(e,t,n,r){return Xa("u"===t?4:t.length,e)},set:function(e,t,n,r){return e.setUTCFullYear(n,0,1),e.setUTCHours(0,0,0,0),e},incompatibleTokens:["G","y","Y","R","w","I","i","e","c","t","T"]},Q:{priority:120,parse:function(e,t,n,r){switch(t){case"Q":case"QQ":return Qa(t.length,e);case"Qo":return n.ordinalNumber(e,{unit:"quarter"});case"QQQ":return n.quarter(e,{width:"abbreviated",context:"formatting"})||n.quarter(e,{width:"narrow",context:"formatting"});case"QQQQQ":return n.quarter(e,{width:"narrow",context:"formatting"});case"QQQQ":default:return n.quarter(e,{width:"wide",context:"formatting"})||n.quarter(e,{width:"abbreviated",context:"formatting"})||n.quarter(e,{width:"narrow",context:"formatting"})}},validate:function(e,t,n){return t>=1&&t<=4},set:function(e,t,n,r){return e.setUTCMonth(3*(n-1),1),e.setUTCHours(0,0,0,0),e},incompatibleTokens:["Y","R","q","M","L","w","I","d","D","i","e","c","t","T"]},q:{priority:120,parse:function(e,t,n,r){switch(t){case"q":case"qq":return Qa(t.length,e);case"qo":return n.ordinalNumber(e,{unit:"quarter"});case"qqq":return n.quarter(e,{width:"abbreviated",context:"standalone"})||n.quarter(e,{width:"narrow",context:"standalone"});case"qqqqq":return n.quarter(e,{width:"narrow",context:"standalone"});case"qqqq":default:return n.quarter(e,{width:"wide",context:"standalone"})||n.quarter(e,{width:"abbreviated",context:"standalone"})||n.quarter(e,{width:"narrow",context:"standalone"})}},validate:function(e,t,n){return t>=1&&t<=4},set:function(e,t,n,r){return e.setUTCMonth(3*(n-1),1),e.setUTCHours(0,0,0,0),e},incompatibleTokens:["Y","R","Q","M","L","w","I","d","D","i","e","c","t","T"]},M:{priority:110,parse:function(e,t,n,r){var a=function(e){return e-1};switch(t){case"M":return _a(Na.month,e,a);case"MM":return Qa(2,e,a);case"Mo":return n.ordinalNumber(e,{unit:"month",valueCallback:a});case"MMM":return n.month(e,{width:"abbreviated",context:"formatting"})||n.month(e,{width:"narrow",context:"formatting"});case"MMMMM":return n.month(e,{width:"narrow",context:"formatting"});case"MMMM":default:return n.month(e,{width:"wide",context:"formatting"})||n.month(e,{width:"abbreviated",context:"formatting"})||n.month(e,{width:"narrow",context:"formatting"})}},validate:function(e,t,n){return t>=0&&t<=11},set:function(e,t,n,r){return e.setUTCMonth(n,1),e.setUTCHours(0,0,0,0),e},incompatibleTokens:["Y","R","q","Q","L","w","I","D","i","e","c","t","T"]},L:{priority:110,parse:function(e,t,n,r){var a=function(e){return e-1};switch(t){case"L":return _a(Na.month,e,a);case"LL":return Qa(2,e,a);case"Lo":return n.ordinalNumber(e,{unit:"month",valueCallback:a});case"LLL":return n.month(e,{width:"abbreviated",context:"standalone"})||n.month(e,{width:"narrow",context:"standalone"});case"LLLLL":return n.month(e,{width:"narrow",context:"standalone"});case"LLLL":default:return n.month(e,{width:"wide",context:"standalone"})||n.month(e,{width:"abbreviated",context:"standalone"})||n.month(e,{width:"narrow",context:"standalone"})}},validate:function(e,t,n){return t>=0&&t<=11},set:function(e,t,n,r){return e.setUTCMonth(n,1),e.setUTCHours(0,0,0,0),e},incompatibleTokens:["Y","R","q","Q","M","w","I","D","i","e","c","t","T"]},w:{priority:100,parse:function(e,t,n,r){switch(t){case"w":return _a(Na.week,e);case"wo":return n.ordinalNumber(e,{unit:"week"});default:return Qa(t.length,e)}},validate:function(e,t,n){return t>=1&&t<=53},set:function(e,t,n,r){return Ia(function(e,t,n){if(arguments.length<2)throw new TypeError("2 arguments required, but only "+arguments.length+" present");var r=fa(e),a=ga(t),i=Aa(r,n)-a;return r.setUTCDate(r.getUTCDate()-7*i),r}(e,n,r),r)},incompatibleTokens:["y","R","u","q","Q","M","L","I","d","D","i","t","T"]},I:{priority:100,parse:function(e,t,n,r){switch(t){case"I":return _a(Na.week,e);case"Io":return n.ordinalNumber(e,{unit:"week"});default:return Qa(t.length,e)}},validate:function(e,t,n){return t>=1&&t<=53},set:function(e,t,n,r){return Ta(function(e,t){if(arguments.length<2)throw new TypeError("2 arguments required, but only "+arguments.length+" present");var n=fa(e),r=ga(t),a=Oa(n)-r;return n.setUTCDate(n.getUTCDate()-7*a),n}(e,n,r),r)},incompatibleTokens:["y","Y","u","q","Q","M","L","w","d","D","e","c","t","T"]},d:{priority:90,parse:function(e,t,n,r){switch(t){case"d":return _a(Na.date,e);case"do":return n.ordinalNumber(e,{unit:"date"});default:return Qa(t.length,e)}},validate:function(e,t,n){var r=ei(e.getUTCFullYear()),a=e.getUTCMonth();return r?t>=1&&t<=$a[a]:t>=1&&t<=Ja[a]},set:function(e,t,n,r){return e.setUTCDate(n),e.setUTCHours(0,0,0,0),e},incompatibleTokens:["Y","R","q","Q","w","I","D","i","e","c","t","T"]},D:{priority:90,parse:function(e,t,n,r){switch(t){case"D":case"DD":return _a(Na.dayOfYear,e);case"Do":return n.ordinalNumber(e,{unit:"date"});default:return Qa(t.length,e)}},validate:function(e,t,n){return ei(e.getUTCFullYear())?t>=1&&t<=366:t>=1&&t<=365},set:function(e,t,n,r){return e.setUTCMonth(0,n),e.setUTCHours(0,0,0,0),e},incompatibleTokens:["Y","R","q","Q","M","L","w","I","d","E","i","e","c","t","T"]},E:{priority:90,parse:function(e,t,n,r){switch(t){case"E":case"EE":case"EEE":return n.day(e,{width:"abbreviated",context:"formatting"})||n.day(e,{width:"short",context:"formatting"})||n.day(e,{width:"narrow",context:"formatting"});case"EEEEE":return n.day(e,{width:"narrow",context:"formatting"});case"EEEEEE":return n.day(e,{width:"short",context:"formatting"})||n.day(e,{width:"narrow",context:"formatting"});case"EEEE":default:return n.day(e,{width:"wide",context:"formatting"})||n.day(e,{width:"abbreviated",context:"formatting"})||n.day(e,{width:"short",context:"formatting"})||n.day(e,{width:"narrow",context:"formatting"})}},validate:function(e,t,n){return t>=0&&t<=6},set:function(e,t,n,r){return(e=Pa(e,n,r)).setUTCHours(0,0,0,0),e},incompatibleTokens:["D","i","e","c","t","T"]},e:{priority:90,parse:function(e,t,n,r){var a=function(e){var t=7*Math.floor((e-1)/7);return(e+r.weekStartsOn+6)%7+t};switch(t){case"e":case"ee":return Qa(t.length,e,a);case"eo":return n.ordinalNumber(e,{unit:"day",valueCallback:a});case"eee":return n.day(e,{width:"abbreviated",context:"formatting"})||n.day(e,{width:"short",context:"formatting"})||n.day(e,{width:"narrow",context:"formatting"});case"eeeee":return n.day(e,{width:"narrow",context:"formatting"});case"eeeeee":return n.day(e,{width:"short",context:"formatting"})||n.day(e,{width:"narrow",context:"formatting"});case"eeee":default:return n.day(e,{width:"wide",context:"formatting"})||n.day(e,{width:"abbreviated",context:"formatting"})||n.day(e,{width:"short",context:"formatting"})||n.day(e,{width:"narrow",context:"formatting"})}},validate:function(e,t,n){return t>=0&&t<=6},set:function(e,t,n,r){return(e=Pa(e,n,r)).setUTCHours(0,0,0,0),e},incompatibleTokens:["y","R","u","q","Q","M","L","I","d","D","E","i","c","t","T"]},c:{priority:90,parse:function(e,t,n,r){var a=function(e){var t=7*Math.floor((e-1)/7);return(e+r.weekStartsOn+6)%7+t};switch(t){case"c":case"cc":return Qa(t.length,e,a);case"co":return n.ordinalNumber(e,{unit:"day",valueCallback:a});case"ccc":return n.day(e,{width:"abbreviated",context:"standalone"})||n.day(e,{width:"short",context:"standalone"})||n.day(e,{width:"narrow",context:"standalone"});case"ccccc":return n.day(e,{width:"narrow",context:"standalone"});case"cccccc":return n.day(e,{width:"short",context:"standalone"})||n.day(e,{width:"narrow",context:"standalone"});case"cccc":default:return n.day(e,{width:"wide",context:"standalone"})||n.day(e,{width:"abbreviated",context:"standalone"})||n.day(e,{width:"short",context:"standalone"})||n.day(e,{width:"narrow",context:"standalone"})}},validate:function(e,t,n){return t>=0&&t<=6},set:function(e,t,n,r){return(e=Pa(e,n,r)).setUTCHours(0,0,0,0),e},incompatibleTokens:["y","R","u","q","Q","M","L","I","d","D","E","i","e","t","T"]},i:{priority:90,parse:function(e,t,n,r){var a=function(e){return 0===e?7:e};switch(t){case"i":case"ii":return Qa(t.length,e);case"io":return n.ordinalNumber(e,{unit:"day"});case"iii":return n.day(e,{width:"abbreviated",context:"formatting",valueCallback:a})||n.day(e,{width:"short",context:"formatting",valueCallback:a})||n.day(e,{width:"narrow",context:"formatting",valueCallback:a});case"iiiii":return n.day(e,{width:"narrow",context:"formatting",valueCallback:a});case"iiiiii":return n.day(e,{width:"short",context:"formatting",valueCallback:a})||n.day(e,{width:"narrow",context:"formatting",valueCallback:a});case"iiii":default:return n.day(e,{width:"wide",context:"formatting",valueCallback:a})||n.day(e,{width:"abbreviated",context:"formatting",valueCallback:a})||n.day(e,{width:"short",context:"formatting",valueCallback:a})||n.day(e,{width:"narrow",context:"formatting",valueCallback:a})}},validate:function(e,t,n){return t>=1&&t<=7},set:function(e,t,n,r){return(e=function(e,t){if(arguments.length<2)throw new TypeError("2 arguments required, but only "+arguments.length+" present");var n=ga(t);n%7==0&&(n-=7);var r=fa(e),a=((n%7+7)%7<1?7:0)+n-r.getUTCDay();return r.setUTCDate(r.getUTCDate()+a),r}(e,n,r)).setUTCHours(0,0,0,0),e},incompatibleTokens:["y","Y","u","q","Q","M","L","w","d","D","E","e","c","t","T"]},a:{priority:80,parse:function(e,t,n,r){switch(t){case"a":case"aa":case"aaa":return n.dayPeriod(e,{width:"abbreviated",context:"formatting"})||n.dayPeriod(e,{width:"narrow",context:"formatting"});case"aaaaa":return n.dayPeriod(e,{width:"narrow",context:"formatting"});case"aaaa":default:return n.dayPeriod(e,{width:"wide",context:"formatting"})||n.dayPeriod(e,{width:"abbreviated",context:"formatting"})||n.dayPeriod(e,{width:"narrow",context:"formatting"})}},set:function(e,t,n,r){return e.setUTCHours(Ka(n),0,0,0),e},incompatibleTokens:["b","B","H","K","k","t","T"]},b:{priority:80,parse:function(e,t,n,r){switch(t){case"b":case"bb":case"bbb":return n.dayPeriod(e,{width:"abbreviated",context:"formatting"})||n.dayPeriod(e,{width:"narrow",context:"formatting"});case"bbbbb":return n.dayPeriod(e,{width:"narrow",context:"formatting"});case"bbbb":default:return n.dayPeriod(e,{width:"wide",context:"formatting"})||n.dayPeriod(e,{width:"abbreviated",context:"formatting"})||n.dayPeriod(e,{width:"narrow",context:"formatting"})}},set:function(e,t,n,r){return e.setUTCHours(Ka(n),0,0,0),e},incompatibleTokens:["a","B","H","K","k","t","T"]},B:{priority:80,parse:function(e,t,n,r){switch(t){case"B":case"BB":case"BBB":return n.dayPeriod(e,{width:"abbreviated",context:"formatting"})||n.dayPeriod(e,{width:"narrow",context:"formatting"});case"BBBBB":return n.dayPeriod(e,{width:"narrow",context:"formatting"});case"BBBB":default:return n.dayPeriod(e,{width:"wide",context:"formatting"})||n.dayPeriod(e,{width:"abbreviated",context:"formatting"})||n.dayPeriod(e,{width:"narrow",context:"formatting"})}},set:function(e,t,n,r){return e.setUTCHours(Ka(n),0,0,0),e},incompatibleTokens:["a","b","t","T"]},h:{priority:70,parse:function(e,t,n,r){switch(t){case"h":return _a(Na.hour12h,e);case"ho":return n.ordinalNumber(e,{unit:"hour"});default:return Qa(t.length,e)}},validate:function(e,t,n){return t>=1&&t<=12},set:function(e,t,n,r){var a=e.getUTCHours()>=12;return a&&n<12?e.setUTCHours(n+12,0,0,0):a||12!==n?e.setUTCHours(n,0,0,0):e.setUTCHours(0,0,0,0),e},incompatibleTokens:["H","K","k","t","T"]},H:{priority:70,parse:function(e,t,n,r){switch(t){case"H":return _a(Na.hour23h,e);case"Ho":return n.ordinalNumber(e,{unit:"hour"});default:return Qa(t.length,e)}},validate:function(e,t,n){return t>=0&&t<=23},set:function(e,t,n,r){return e.setUTCHours(n,0,0,0),e},incompatibleTokens:["a","b","h","K","k","t","T"]},K:{priority:70,parse:function(e,t,n,r){switch(t){case"K":return _a(Na.hour11h,e);case"Ko":return n.ordinalNumber(e,{unit:"hour"});default:return Qa(t.length,e)}},validate:function(e,t,n){return t>=0&&t<=11},set:function(e,t,n,r){return e.getUTCHours()>=12&&n<12?e.setUTCHours(n+12,0,0,0):e.setUTCHours(n,0,0,0),e},incompatibleTokens:["a","b","h","H","k","t","T"]},k:{priority:70,parse:function(e,t,n,r){switch(t){case"k":return _a(Na.hour24h,e);case"ko":return n.ordinalNumber(e,{unit:"hour"});default:return Qa(t.length,e)}},validate:function(e,t,n){return t>=1&&t<=24},set:function(e,t,n,r){var a=n<=24?n%24:n;return e.setUTCHours(a,0,0,0),e},incompatibleTokens:["a","b","h","H","K","t","T"]},m:{priority:60,parse:function(e,t,n,r){switch(t){case"m":return _a(Na.minute,e);case"mo":return n.ordinalNumber(e,{unit:"minute"});default:return Qa(t.length,e)}},validate:function(e,t,n){return t>=0&&t<=59},set:function(e,t,n,r){return e.setUTCMinutes(n,0,0),e},incompatibleTokens:["t","T"]},s:{priority:50,parse:function(e,t,n,r){switch(t){case"s":return _a(Na.second,e);case"so":return n.ordinalNumber(e,{unit:"second"});default:return Qa(t.length,e)}},validate:function(e,t,n){return t>=0&&t<=59},set:function(e,t,n,r){return e.setUTCSeconds(n,0),e},incompatibleTokens:["t","T"]},S:{priority:30,parse:function(e,t,n,r){return Qa(t.length,e,(function(e){return Math.floor(e*Math.pow(10,3-t.length))}))},set:function(e,t,n,r){return e.setUTCMilliseconds(n),e},incompatibleTokens:["t","T"]},X:{priority:10,parse:function(e,t,n,r){switch(t){case"X":return Ya(Ua,e);case"XX":return Ya(Fa,e);case"XXXX":return Ya(Ba,e);case"XXXXX":return Ya(Ga,e);case"XXX":default:return Ya(Ha,e)}},set:function(e,t,n,r){return t.timestampIsSet?e:new Date(e.getTime()-n)},incompatibleTokens:["t","T","x"]},x:{priority:10,parse:function(e,t,n,r){switch(t){case"x":return Ya(Ua,e);case"xx":return Ya(Fa,e);case"xxxx":return Ya(Ba,e);case"xxxxx":return Ya(Ga,e);case"xxx":default:return Ya(Ha,e)}},set:function(e,t,n,r){return t.timestampIsSet?e:new Date(e.getTime()-n)},incompatibleTokens:["t","T","X"]},t:{priority:40,parse:function(e,t,n,r){return za(e)},set:function(e,t,n,r){return[new Date(1e3*n),{timestampIsSet:!0}]},incompatibleTokens:"*"},T:{priority:20,parse:function(e,t,n,r){return za(e)},set:function(e,t,n,r){return[new Date(n),{timestampIsSet:!0}]},incompatibleTokens:"*"}},ni=10,ri=/[yYQqMLwIdDecihHKkms]o|(\w)\1*|''|'(''|[^'])+('|$)|./g,ai=/P+p+|P+|p+|''|'(''|[^'])+('|$)|./g,ii=/^'([^]*?)'?$/,oi=/''/g,si=/\S/,ci=/[a-zA-Z]/;function ui(e,t,n,r){if(arguments.length<3)throw new TypeError("3 arguments required, but only "+arguments.length+" present");var a=String(e),i=String(t),o=r||{},s=o.locale||ha;if(!s.match)throw new RangeError("locale must contain match property");var c=s.options&&s.options.firstWeekContainsDate,u=null==c?1:ga(c),d=null==o.firstWeekContainsDate?u:ga(o.firstWeekContainsDate);if(!(d>=1&&d<=7))throw new RangeError("firstWeekContainsDate must be between 1 and 7 inclusively");var l=s.options&&s.options.weekStartsOn,h=null==l?0:ga(l),g=null==o.weekStartsOn?h:ga(o.weekStartsOn);if(!(g>=0&&g<=6))throw new RangeError("weekStartsOn must be between 0 and 6 inclusively");if(""===i)return""===a?fa(n):new Date(NaN);var f,p={firstWeekContainsDate:d,weekStartsOn:g,locale:s},v=[{priority:ni,set:di,index:0}],m=i.match(ai).map((function(e){var t=e[0];return"p"===t||"P"===t?(0,ya[t])(e,s.formatLong,p):e})).join("").match(ri),w=[];for(f=0;f<m.length;f++){var y=m[f];!o.useAdditionalWeekYearTokens&&xa(y)&&Wa(y),!o.useAdditionalDayOfYearTokens&&Ca(y)&&Wa(y);var b=y[0],M=ti[b];if(M){var S=M.incompatibleTokens;if(Array.isArray(S)){for(var k=void 0,C=0;C<w.length;C++){var x=w[C].token;if(-1!==S.indexOf(x)||x===b){k=w[C];break}}if(k)throw new RangeError("The format string mustn't contain `".concat(k.fullToken,"` and `").concat(y,"` at the same time"))}else if("*"===M.incompatibleTokens&&w.length)throw new RangeError("The format string mustn't contain `".concat(y,"` and any other token at the same time"));w.push({token:b,fullToken:y});var W=M.parse(a,y,s.match,p);if(!W)return new Date(NaN);v.push({priority:M.priority,set:M.set,validate:M.validate,value:W.value,index:v.length}),a=W.rest}else{if(b.match(ci))throw new RangeError("Format string contains an unescaped latin alphabet character `"+b+"`");if("''"===y?y="'":"'"===b&&(y=y.match(ii)[1].replace(oi,"'")),0!==a.indexOf(y))return new Date(NaN);a=a.slice(y.length)}}if(a.length>0&&si.test(a))return new Date(NaN);var I=v.map((function(e){return e.priority})).sort((function(e,t){return t-e})).filter((function(e,t,n){return n.indexOf(e)===t})).map((function(e){return v.filter((function(t){return t.priority===e})).reverse()})).map((function(e){return e[0]})),R=fa(n);if(isNaN(R))return new Date(NaN);var P=pa(R,Ma(R)),T={};for(f=0;f<I.length;f++){var D=I[f];if(D.validate&&!D.validate(P,D.value,p))return new Date(NaN);var E=D.set(P,T,D.value,p);E[0]?(P=E[0],va(T,E[1])):P=E}return P}function di(e,t){if(t.timestampIsSet)return e;var n=new Date(0);return n.setFullYear(e.getUTCFullYear(),e.getUTCMonth(),e.getUTCDate()),n.setHours(e.getUTCHours(),e.getUTCMinutes(),e.getUTCSeconds(),e.getUTCMilliseconds()),n}function li(e,t){for(var n=e<0?"-":"",r=Math.abs(e).toString();r.length<t;)r="0"+r;return n+r}var hi={y:function(e,t){var n=e.getUTCFullYear(),r=n>0?n:1-n;return li("yy"===t?r%100:r,t.length)},M:function(e,t){var n=e.getUTCMonth();return"M"===t?String(n+1):li(n+1,2)},d:function(e,t){return li(e.getUTCDate(),t.length)},a:function(e,t){var n=e.getUTCHours()/12>=1?"pm":"am";switch(t){case"a":case"aa":case"aaa":return n.toUpperCase();case"aaaaa":return n[0];case"aaaa":default:return"am"===n?"a.m.":"p.m."}},h:function(e,t){return li(e.getUTCHours()%12||12,t.length)},H:function(e,t){return li(e.getUTCHours(),t.length)},m:function(e,t){return li(e.getUTCMinutes(),t.length)},s:function(e,t){return li(e.getUTCSeconds(),t.length)},S:function(e,t){var n=t.length,r=e.getUTCMilliseconds();return li(Math.floor(r*Math.pow(10,n-3)),t.length)}},gi=864e5;var fi="midnight",pi="noon",vi="morning",mi="afternoon",wi="evening",yi="night";function bi(e,t){var n=e>0?"-":"+",r=Math.abs(e),a=Math.floor(r/60),i=r%60;if(0===i)return n+String(a);var o=t||"";return n+String(a)+o+li(i,2)}function Mi(e,t){return e%60==0?(e>0?"-":"+")+li(Math.abs(e)/60,2):Si(e,t)}function Si(e,t){var n=t||"",r=e>0?"-":"+",a=Math.abs(e);return r+li(Math.floor(a/60),2)+n+li(a%60,2)}var ki={G:function(e,t,n){var r=e.getUTCFullYear()>0?1:0;switch(t){case"G":case"GG":case"GGG":return n.era(r,{width:"abbreviated"});case"GGGGG":return n.era(r,{width:"narrow"});case"GGGG":default:return n.era(r,{width:"wide"})}},y:function(e,t,n){if("yo"===t){var r=e.getUTCFullYear(),a=r>0?r:1-r;return n.ordinalNumber(a,{unit:"year"})}return hi.y(e,t)},Y:function(e,t,n,r){var a=Ra(e,r),i=a>0?a:1-a;return"YY"===t?li(i%100,2):"Yo"===t?n.ordinalNumber(i,{unit:"year"}):li(i,t.length)},R:function(e,t){return li(Da(e),t.length)},u:function(e,t){return li(e.getUTCFullYear(),t.length)},Q:function(e,t,n){var r=Math.ceil((e.getUTCMonth()+1)/3);switch(t){case"Q":return String(r);case"QQ":return li(r,2);case"Qo":return n.ordinalNumber(r,{unit:"quarter"});case"QQQ":return n.quarter(r,{width:"abbreviated",context:"formatting"});case"QQQQQ":return n.quarter(r,{width:"narrow",context:"formatting"});case"QQQQ":default:return n.quarter(r,{width:"wide",context:"formatting"})}},q:function(e,t,n){var r=Math.ceil((e.getUTCMonth()+1)/3);switch(t){case"q":return String(r);case"qq":return li(r,2);case"qo":return n.ordinalNumber(r,{unit:"quarter"});case"qqq":return n.quarter(r,{width:"abbreviated",context:"standalone"});case"qqqqq":return n.quarter(r,{width:"narrow",context:"standalone"});case"qqqq":default:return n.quarter(r,{width:"wide",context:"standalone"})}},M:function(e,t,n){var r=e.getUTCMonth();switch(t){case"M":case"MM":return hi.M(e,t);case"Mo":return n.ordinalNumber(r+1,{unit:"month"});case"MMM":return n.month(r,{width:"abbreviated",context:"formatting"});case"MMMMM":return n.month(r,{width:"narrow",context:"formatting"});case"MMMM":default:return n.month(r,{width:"wide",context:"formatting"})}},L:function(e,t,n){var r=e.getUTCMonth();switch(t){case"L":return String(r+1);case"LL":return li(r+1,2);case"Lo":return n.ordinalNumber(r+1,{unit:"month"});case"LLL":return n.month(r,{width:"abbreviated",context:"standalone"});case"LLLLL":return n.month(r,{width:"narrow",context:"standalone"});case"LLLL":default:return n.month(r,{width:"wide",context:"standalone"})}},w:function(e,t,n,r){var a=Aa(e,r);return"wo"===t?n.ordinalNumber(a,{unit:"week"}):li(a,t.length)},I:function(e,t,n){var r=Oa(e);return"Io"===t?n.ordinalNumber(r,{unit:"week"}):li(r,t.length)},d:function(e,t,n){return"do"===t?n.ordinalNumber(e.getUTCDate(),{unit:"date"}):hi.d(e,t)},D:function(e,t,n){var r=function(e){if(arguments.length<1)throw new TypeError("1 argument required, but only "+arguments.length+" present");var t=fa(e),n=t.getTime();t.setUTCMonth(0,1),t.setUTCHours(0,0,0,0);var r=n-t.getTime();return Math.floor(r/gi)+1}(e);return"Do"===t?n.ordinalNumber(r,{unit:"dayOfYear"}):li(r,t.length)},E:function(e,t,n){var r=e.getUTCDay();switch(t){case"E":case"EE":case"EEE":return n.day(r,{width:"abbreviated",context:"formatting"});case"EEEEE":return n.day(r,{width:"narrow",context:"formatting"});case"EEEEEE":return n.day(r,{width:"short",context:"formatting"});case"EEEE":default:return n.day(r,{width:"wide",context:"formatting"})}},e:function(e,t,n,r){var a=e.getUTCDay(),i=(a-r.weekStartsOn+8)%7||7;switch(t){case"e":return String(i);case"ee":return li(i,2);case"eo":return n.ordinalNumber(i,{unit:"day"});case"eee":return n.day(a,{width:"abbreviated",context:"formatting"});case"eeeee":return n.day(a,{width:"narrow",context:"formatting"});case"eeeeee":return n.day(a,{width:"short",context:"formatting"});case"eeee":default:return n.day(a,{width:"wide",context:"formatting"})}},c:function(e,t,n,r){var a=e.getUTCDay(),i=(a-r.weekStartsOn+8)%7||7;switch(t){case"c":return String(i);case"cc":return li(i,t.length);case"co":return n.ordinalNumber(i,{unit:"day"});case"ccc":return n.day(a,{width:"abbreviated",context:"standalone"});case"ccccc":return n.day(a,{width:"narrow",context:"standalone"});case"cccccc":return n.day(a,{width:"short",context:"standalone"});case"cccc":default:return n.day(a,{width:"wide",context:"standalone"})}},i:function(e,t,n){var r=e.getUTCDay(),a=0===r?7:r;switch(t){case"i":return String(a);case"ii":return li(a,t.length);case"io":return n.ordinalNumber(a,{unit:"day"});case"iii":return n.day(r,{width:"abbreviated",context:"formatting"});case"iiiii":return n.day(r,{width:"narrow",context:"formatting"});case"iiiiii":return n.day(r,{width:"short",context:"formatting"});case"iiii":default:return n.day(r,{width:"wide",context:"formatting"})}},a:function(e,t,n){var r=e.getUTCHours()/12>=1?"pm":"am";switch(t){case"a":case"aa":case"aaa":return n.dayPeriod(r,{width:"abbreviated",context:"formatting"});case"aaaaa":return n.dayPeriod(r,{width:"narrow",context:"formatting"});case"aaaa":default:return n.dayPeriod(r,{width:"wide",context:"formatting"})}},b:function(e,t,n){var r,a=e.getUTCHours();switch(r=12===a?pi:0===a?fi:a/12>=1?"pm":"am",t){case"b":case"bb":case"bbb":return n.dayPeriod(r,{width:"abbreviated",context:"formatting"});case"bbbbb":return n.dayPeriod(r,{width:"narrow",context:"formatting"});case"bbbb":default:return n.dayPeriod(r,{width:"wide",context:"formatting"})}},B:function(e,t,n){var r,a=e.getUTCHours();switch(r=a>=17?wi:a>=12?mi:a>=4?vi:yi,t){case"B":case"BB":case"BBB":return n.dayPeriod(r,{width:"abbreviated",context:"formatting"});case"BBBBB":return n.dayPeriod(r,{width:"narrow",context:"formatting"});case"BBBB":default:return n.dayPeriod(r,{width:"wide",context:"formatting"})}},h:function(e,t,n){if("ho"===t){var r=e.getUTCHours()%12;return 0===r&&(r=12),n.ordinalNumber(r,{unit:"hour"})}return hi.h(e,t)},H:function(e,t,n){return"Ho"===t?n.ordinalNumber(e.getUTCHours(),{unit:"hour"}):hi.H(e,t)},K:function(e,t,n){var r=e.getUTCHours()%12;return"Ko"===t?n.ordinalNumber(r,{unit:"hour"}):li(r,t.length)},k:function(e,t,n){var r=e.getUTCHours();return 0===r&&(r=24),"ko"===t?n.ordinalNumber(r,{unit:"hour"}):li(r,t.length)},m:function(e,t,n){return"mo"===t?n.ordinalNumber(e.getUTCMinutes(),{unit:"minute"}):hi.m(e,t)},s:function(e,t,n){return"so"===t?n.ordinalNumber(e.getUTCSeconds(),{unit:"second"}):hi.s(e,t)},S:function(e,t){return hi.S(e,t)},X:function(e,t,n,r){var a=(r._originalDate||e).getTimezoneOffset();if(0===a)return"Z";switch(t){case"X":return Mi(a);case"XXXX":case"XX":return Si(a);case"XXXXX":case"XXX":default:return Si(a,":")}},x:function(e,t,n,r){var a=(r._originalDate||e).getTimezoneOffset();switch(t){case"x":return Mi(a);case"xxxx":case"xx":return Si(a);case"xxxxx":case"xxx":default:return Si(a,":")}},O:function(e,t,n,r){var a=(r._originalDate||e).getTimezoneOffset();switch(t){case"O":case"OO":case"OOO":return"GMT"+bi(a,":");case"OOOO":default:return"GMT"+Si(a,":")}},z:function(e,t,n,r){var a=(r._originalDate||e).getTimezoneOffset();switch(t){case"z":case"zz":case"zzz":return"GMT"+bi(a,":");case"zzzz":default:return"GMT"+Si(a,":")}},t:function(e,t,n,r){var a=r._originalDate||e;return li(Math.floor(a.getTime()/1e3),t.length)},T:function(e,t,n,r){return li((r._originalDate||e).getTime(),t.length)}},Ci=/[yYQqMLwIdDecihHKkms]o|(\w)\1*|''|'(''|[^'])+('|$)|./g,xi=/P+p+|P+|p+|''|'(''|[^'])+('|$)|./g,Wi=/^'([^]*?)'?$/,Ii=/''/g,Ri=/[a-zA-Z]/;function Pi(e,t,n){if(arguments.length<2)throw new TypeError("2 arguments required, but only "+arguments.length+" present");var r=String(t),a=n||{},i=a.locale||ha,o=i.options&&i.options.firstWeekContainsDate,s=null==o?1:ga(o),c=null==a.firstWeekContainsDate?s:ga(a.firstWeekContainsDate);if(!(c>=1&&c<=7))throw new RangeError("firstWeekContainsDate must be between 1 and 7 inclusively");var u=i.options&&i.options.weekStartsOn,d=null==u?0:ga(u),l=null==a.weekStartsOn?d:ga(a.weekStartsOn);if(!(l>=0&&l<=6))throw new RangeError("weekStartsOn must be between 0 and 6 inclusively");if(!i.localize)throw new RangeError("locale must contain localize property");if(!i.formatLong)throw new RangeError("locale must contain formatLong property");var h=fa(e);if(!function(e){if(arguments.length<1)throw new TypeError("1 argument required, but only "+arguments.length+" present");var t=fa(e);return!isNaN(t)}(h))throw new RangeError("Invalid time value");var g=pa(h,Ma(h)),f={firstWeekContainsDate:c,weekStartsOn:l,locale:i,_originalDate:h};return r.match(xi).map((function(e){var t=e[0];return"p"===t||"P"===t?(0,ya[t])(e,i.formatLong,f):e})).join("").match(Ci).map((function(e){if("''"===e)return"'";var t=e[0];if("'"===t)return e.match(Wi)[1].replace(Ii,"'");var n=ki[t];if(n)return!a.useAdditionalWeekYearTokens&&xa(e)&&Wa(e),!a.useAdditionalDayOfYearTokens&&Ca(e)&&Wa(e),n(g,e,i.localize,f);if(t.match(Ri))throw new RangeError("Format string contains an unescaped latin alphabet character `"+t+"`");return e})).join("")}function Ti(){return([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,(function(e){return(e^crypto.getRandomValues(new Uint8Array(1))[0]&15>>e/4).toString(16)}))}var Di=function(e){if(e)return e.replace("^",", ").replace(/\^/g," ").trim()},Ei=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"MMM D, YYYY";if(e)try{return Pi(ui(e,"yyyyMMdd",new Date),t)}catch(e){}},Oi=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"HH:mm:ss";if(e){try{return Pi(ui(e.toString().substring(0,"HHmmss.SSS".length),"HHmmss.SSS",new Date(0)),t)}catch(e){}return Pi(parsedDateTime,t)}},ji=(n(57),Di),Ai=Ei,Li=Oi,Vi=function(e){function t(){return f()(this,t),w()(this,b()(t).apply(this,arguments))}return C()(t,e),v()(t,[{key:"render",value:function(){var e=this.props,t=e.studyDate,n=e.studyTime,r=e.studyDescription,a=e.patientName,i=e.patientId,o=e.seriesNumber,s=e.seriesDescription,c=e.voi,u=e.orientation,d=e.rotation,l=e.neswMetadata,h=e.slice,g=c.windowWidth,f=c.windowCenter,p="W: ".concat(g.toFixed(0)," L: ").concat(f.toFixed(0)),v=d?"θ: ".concat(d.theta.toFixed(1)," ϕ: ").concat(d.phi.toFixed(1)):null,m="number"==typeof h?"Slice ".concat(h):"";return R.a.createElement("div",{className:"ViewportOverlay"},R.a.createElement("div",{className:"top-left overlay-element"},R.a.createElement("div",null,ji(a)),R.a.createElement("div",null,i)),R.a.createElement("div",{className:"top-center overlay-element"},R.a.createElement("div",null,l.n)),R.a.createElement("div",{className:"top-right overlay-element"},R.a.createElement("div",null,r),R.a.createElement("div",null,Ai(t)," ",Li(n))),R.a.createElement("div",{className:"center-left overlay-element"},R.a.createElement("div",null,l.w)),R.a.createElement("div",{className:"center-right overlay-element"},R.a.createElement("div",null,l.e)),R.a.createElement("div",{className:"bottom-right overlay-element"},R.a.createElement("div",null,p),R.a.createElement("div",null,v),R.a.createElement("div",null,u),R.a.createElement("div",null,m)),R.a.createElement("div",{className:"bottom-center overlay-element"},R.a.createElement("div",null,l.s)),R.a.createElement("div",{className:"bottom-left overlay-element"},R.a.createElement("div",null,o>=0?"Ser: ".concat(o):""),R.a.createElement("div",null,R.a.createElement("div",null,s))))}}]),t}(I.PureComponent);W()(Vi,"propTypes",{voi:T.a.object.isRequired,orientation:T.a.string,rotation:T.a.object,neswMetadata:T.a.object,slice:T.a.number,studyDate:T.a.string,studyTime:T.a.string,studyDescription:T.a.string,patientName:T.a.string,patientId:T.a.string,seriesNumber:T.a.string,seriesDescription:T.a.string}),W()(Vi,"defaultProps",{voi:{windowWidth:0,windowCenter:0},neswMetadata:{n:"",s:"",e:"",w:""}});var qi=Vi,Ni=n(25);function Ui(e){var t=e,n=function(){t&&(t.unsubscribe(),t=null)};return{sub:function(e){n(),t=e},unsubscribe:n}}var Fi=n(26),Bi=n.n(Fi),Hi=n(27),Gi=n.n(Hi),_i=n(37),Yi=n.n(_i),zi=n(38),Qi=n.n(zi),Xi=n(39),Ki=n.n(Xi),Zi=n(40),Ji=n.n(Zi),$i=function(e,t,n){if(t)for(var r=Math.min(256,t.length),a=0;a<r;a++){var i=t[a];e.cfun.addRGBPoint(a,i[0]/255,i[1]/255,i[2]/255);var o=i[3]/255*n;e.ofun.addPointLong(a,o,.5,1)}};function eo(e,t,n){var r,a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=n.colorLUT,o=n.globalOpacity,s=n.visible,c=n.renderOutline,u=n.outlineThickness;if(void 0===s&&(s=!1),void 0===o&&(o=1),void 0===u&&(u=3),t)r=t;else{(r=Bi.a.newInstance(e.get("spacing","origin","direction"))).setDimensions(e.getDimensions()),r.computeTransforms();var d=new Uint8Array(e.getNumberOfPoints()),l=Gi.a.newInstance({numberOfComponents:1,values:d});r.getPointData().setScalars(l)}var h=Qi.a.newInstance();if(a){var g=.7*Math.sqrt(r.getSpacing().map((function(e){return e*e})).reduce((function(e,t){return e+t}),0));h.setSampleDistance(g)}var f={actor:Yi.a.newInstance(),mapper:h,cfun:Ki.a.newInstance(),ofun:Ji.a.newInstance()};return f.actor.setMapper(f.mapper),f.actor.setVisibility(s),f.ofun.addPointLong(0,0,.5,1),f.ofun.addPointLong(1,1,.5,1),i?$i(f,i,o):(f.cfun.addRGBPoint(1,1,0,0),f.cfun.addRGBPoint(2,0,1,0),f.cfun.addRGBPoint(3,0,1,1),f.ofun.addPointLong(1,.5,.5,1)),f.actor.getProperty().setRGBTransferFunction(0,f.cfun),f.actor.getProperty().setScalarOpacity(0,f.ofun),f.actor.getProperty().setInterpolationTypeToNearest(),c&&(f.actor.getProperty().setUseLabelOutline(!0),f.actor.getProperty().setLabelOutlineThickness(u)),f.ofun.setClamping(!1),f.actor.getProperty().setScalarOpacityUnitDistance(0,.1),f.actor.getProperty().setUseGradientOpacity(0,!1),f}var to=E.a.importInternal("util/throttle"),no=360/(2*Math.PI),ro=function(e){function t(e){var n;return f()(this,t),n=w()(this,b()(t).call(this,e)),W()(S()(n),"getVOI",(function(e){var t=e.getProperty().getRGBTransferFunction(0).getMappingRange(),n=Math.abs(t[1]-t[0]);return{windowCenter:t[0]+n/2,windowWidth:n}})),n.genericRenderWindow=null,n.widgetManager=q.a.newInstance(),n.container=R.a.createRef(),n.subs={interactor:Ui(),data:Ui(),labelmap:Ui(),paint:Ui(),paintStart:Ui(),paintEnd:Ui()},n.interactorStyleSubs=[],n.state={voi:n.getVOI(e.volumes[0]),rotation:{theta:0,phi:0}},n.apiProperties={},n}return C()(t,e),v()(t,[{key:"updatePaintbrush",value:function(){var e=this.paintWidget.getManipulator(),t=this.paintWidget.getWidgetState().getHandle(),n=this.paintRenderer.getActiveCamera(),r=n.getDirectionOfProjection();e.setNormal.apply(e,h()(r)),e.setOrigin.apply(e,h()(n.getFocalPoint())),t.rotateFromDirections(t.getDirection(),r)}},{key:"componentDidMount",value:function(){var e=this,t=Ti();this.genericRenderWindow=j.a.newInstance({background:[0,0,0]}),this.genericRenderWindow.setContainer(this.container.current);var n,r,a=[],i=[];this.renderer=this.genericRenderWindow.getRenderer(),this.renderWindow=this.genericRenderWindow.getRenderWindow();var o=this.genericRenderWindow.getOpenGLRenderWindow();this.paintRenderer=L.a.newInstance(),this.renderWindow.addRenderer(this.paintRenderer),this.renderWindow.setNumberOfLayers(2),this.paintRenderer.setLayer(1),this.paintRenderer.setInteractive(!1),o.buildPass(!0);var s=Qr.newInstance();this.renderWindow.getInteractor().setInteractorStyle(s);var c=function(){var t=e.renderer.getActiveCamera(),n=e.paintRenderer.getActiveCamera(),r=t.getReferenceByName("position"),a=t.getReferenceByName("focalPoint"),i=t.getReferenceByName("viewUp"),o=t.getReferenceByName("viewAngle");n.set({position:r,focalPoint:a,viewUp:i,viewAngle:o})};if(this.renderWindow.getInteractor().onAnimation(c),c(),this.widgetManager.disablePicking(),this.widgetManager.setRenderer(this.paintRenderer),this.paintWidget=Jr.a.newInstance(),this.paintWidget.setRadius(5),this.paintFilter=Kr.a.newInstance(),this.paintFilter.setLabel(1),this.paintFilter.setRadius(5),this.componentDidUpdate({}),this.labelmap&&this.labelmap.actor&&this.renderer.addVolume(this.labelmap.actor),this.props.actors&&(a=a.concat(this.props.actors)),this.labelmap&&this.labelmap.actor&&(a=a.concat(this.labelmap.actor)),this.props.volumes&&(i=i.concat(this.props.volumes)),r=[this.paintFilter],n=[this.paintWidget],this.throttledUpdateRotationOverlay=to(this.updateRotationOverlay,16,{trailing:!0}),this.props.orientation){var u=this.props.orientation;this.setOrientation(u.sliceNormal,u.viewUp)}else s.setSliceNormal(0,0,1);this.renderer.getActiveCamera().setParallelProjection(!0),this.renderer.resetCamera(),s.setVolumeActor(this.props.volumes[0]);var d=s.getSliceRange();s.setSlice((d[0]+d[1])/2),s.onModified((function(){e.updatePaintbrush()})),this.updatePaintbrush();var l=aa.newInstance();l.setRenderer(this.renderer),l.setScale(1),this.svgWidgetManager=l,this.genericRenderWindow.resize();var h=this.updateVOI.bind(this),g=this.getOrientation.bind(this),f=this.setOrientation.bind(this),p=this.getViewUp.bind(this),v=this.getSliceNormal.bind(this),m=this.setInteractorStyle.bind(this),w=this.getSlabThickness.bind(this),y=this.setSlabThickness.bind(this),b=this.addSVGWidget.bind(this),M=this.getApiProperty.bind(this),S=this.setApiProperty.bind(this),k=this.setSegmentRGB.bind(this),C=this.setSegmentRGBA.bind(this),x=this.setSegmentAlpha.bind(this),W=this.updateImage.bind(this),I=this.setSegmentVisibility.bind(this),R=this.setGlobalOpacity.bind(this),P=this.setVisibility.bind(this),T=this.setOutlineThickness.bind(this),D=this.setOutlineRendering.bind(this),E=this.requestNewSegmentation.bind(this);if(this.svgWidgets={},this.props.onCreated){var O={uid:t,genericRenderWindow:this.genericRenderWindow,widgetManager:this.widgetManager,svgWidgetManager:this.svgWidgetManager,addSVGWidget:b,container:this.container.current,widgets:n,svgWidgets:this.svgWidgets,filters:r,actors:a,volumes:i,_component:this,updateImage:W,updateVOI:h,getOrientation:g,setOrientation:f,getViewUp:p,getSliceNormal:v,setInteractorStyle:m,getSlabThickness:w,setSlabThickness:y,setSegmentRGB:k,setSegmentRGBA:C,setSegmentAlpha:x,setSegmentVisibility:I,setGlobalOpacity:R,setVisibility:P,setOutlineThickness:T,setOutlineRendering:D,requestNewSegmentation:E,get:M,set:S,type:"VIEW2D"};this.props.onCreated(O)}}},{key:"getViewUp",value:function(){return this.genericRenderWindow.getRenderWindow().getInteractor().getInteractorStyle().getViewUp()}},{key:"getSliceNormal",value:function(){return this.genericRenderWindow.getRenderWindow().getInteractor().getInteractorStyle().getSliceNormal()}},{key:"setOrientation",value:function(e,t){var n=this.genericRenderWindow.getRenderWindow().getInteractor().getInteractorStyle();this.updateRotationRelativeToOrientation(e),n.setSliceOrientation(e,t)}},{key:"getApiProperty",value:function(e){return this.apiProperties[e]}},{key:"setApiProperty",value:function(e,t){this.apiProperties[e]=t}},{key:"addSVGWidget",value:function(e,t){var n=this.svgWidgetManager;n.addWidget(e),n.render(),this.svgWidgets[t]=e}},{key:"getSlabThickness",value:function(){var e=this.genericRenderWindow.getRenderWindow().getInteractor().getInteractorStyle();if(e.getSlabThickness)return e.getSlabThickness()}},{key:"setSlabThickness",value:function(e){var t=this.genericRenderWindow.getRenderWindow(),n=t.getInteractor().getInteractorStyle();if(n.setSlabThickness&&(n.setSlabThickness(e),this.props.paintFilterLabelMapImageData)){var r=this.labelmap.actor;!function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e-5;return Math.abs(e-t)<n}(e,.1)?r.setVisibility(!1):r.getVisibility()!==this.props.labelmapRenderingOptions.visible&&r.setVisibility(this.props.labelmapRenderingOptions.visible)}t.render()}},{key:"updateImage",value:function(){this.genericRenderWindow.getRenderWindow().render()}},{key:"setInteractorStyle",value:function(e){for(var t,n=this,r=e.istyle,a=e.callbacks,i=void 0===a?{}:a,o=e.configuration,s=void 0===o?{}:o,c=this.props.volumes,u=this.genericRenderWindow.getRenderWindow(),d=u.getInteractor().getInteractorStyle();this.interactorStyleSubs.length;)this.interactorStyleSubs.pop().unsubscribe();d.getViewport&&r.getViewport&&(t=d.getViewport());var l=this.getSlabThickness(),h=u.getInteractor();h.setInteractorStyle(r),r.setInteractor(h),t&&r.setViewport(t),r.getVolumeActor()!==c[0]&&(l&&r.setSlabThickness&&r.setSlabThickness(l),r.setVolumeActor(c[0])),Object.keys(i).forEach((function(e){if("function"==typeof r[e]){var t=r[e](i[e]);t&&"function"==typeof t.unsubscribe&&n.interactorStyleSubs.push(t)}})),s&&r.set(s),u.render()}},{key:"updateVOI",value:function(e,t){this.setState({voi:{windowWidth:e,windowCenter:t}})}},{key:"updateRotationOverlay",value:function(e,t){this.setState({rotation:{theta:e,phi:t}})}},{key:"updateRotationRelativeToOrientation",value:function(e){var t=this.props.orientation.sliceNormal,n=[Math.acos(t[2]),Math.atan2(t[1],t[0])],r=n[0],a=n[1],i=[Math.acos(e[2]),Math.atan2(e[1],e[0])],o=i[0],s=i[1],c=(o*=no)-(r*=no),u=(s*=no)-(a*=no);c>180?c-=180:c<0&&(c=180-Math.abs(c)),u>=360?u-=360:u<0&&(u=360-Math.abs(u)),this.throttledUpdateRotationOverlay(c,u)}},{key:"getOrientation",value:function(){return this.props.orientation}},{key:"setSegmentRGBA",value:function(e,t){var n=d()(t,4),r=n[0],a=n[1],i=n[2],o=n[3];this.setSegmentRGB(e,[r,a,i]),this.setSegmentAlpha(e,o)}},{key:"setGlobalOpacity",value:function(e){var t=this.labelmap,n=this.props.labelmapRenderingOptions.colorLUT;$i(t,n,e)}},{key:"setVisibility",value:function(e){this.labelmap.actor.setVisibility(e)}},{key:"setOutlineThickness",value:function(e){this.labelmap.actor.getProperty().setLabelOutlineThickness(e)}},{key:"setOutlineRendering",value:function(e){this.labelmap.actor.getProperty().setUseLabelOutline(e)}},{key:"requestNewSegmentation",value:function(){this.props.labelmapRenderingOptions.onNewSegmentationRequested()}},{key:"setSegmentRGB",value:function(e,t){var n=d()(t,3),r=n[0],a=n[1],i=n[2];this.labelmap.cfun.addRGBPoint(e,r/255,a/255,i/255)}},{key:"setSegmentVisibility",value:function(e,t){this.setSegmentAlpha(e,t?255:0)}},{key:"setSegmentAlpha",value:function(e,t){var n=this.labelmap,r=this.props.labelmapRenderingOptions.globalOpacity;void 0===r&&(r=1);var a=t/255*r;n.ofun.addPointLong(e,a,.5,1)}},{key:"componentDidUpdate",value:function(e){var t=this;if(e.volumes!==this.props.volumes&&(this.props.volumes.forEach((function(e){e.isA("vtkVolume")||console.warn("Data to <Vtk2D> is not vtkVolume data")})),this.props.volumes.length&&this.props.volumes.forEach(this.renderer.addVolume),this.renderWindow.render()),!e.paintFilterBackgroundImageData&&this.props.paintFilterBackgroundImageData?(this.subs.data.sub(this.props.paintFilterBackgroundImageData.onModified((function(){t.genericRenderWindow.resize(),t.renderWindow.render()}))),this.paintFilter.setBackgroundImage(this.props.paintFilterBackgroundImageData)):e.paintFilterBackgroundImageData&&!this.props.paintFilterBackgroundImageData&&(this.paintFilter.setBackgroundImage(null),this.subs.data.unsubscribe()),e.paintFilterLabelMapImageData!==this.props.paintFilterLabelMapImageData&&this.props.paintFilterLabelMapImageData){if(this.subs.labelmap.unsubscribe(),this.labelmap&&this.labelmap.actor&&(this.renderer.removeVolume(this.labelmap.actor),this.api)){var n=this.api.actors,r=n.findIndex((function(e){return e===t.labelmap.actor}));-1!==r&&n.splice(r,1)}var a=this.props.paintFilterLabelMapImageData,i=eo(this.props.paintFilterBackgroundImageData,a,this.props.labelmapRenderingOptions);this.labelmap=i,this.props.labelmapRenderingOptions.segmentsDefaultProperties.forEach((function(e,n){e&&t.setSegmentVisibility(n,e.visible)})),this.labelmap&&this.labelmap.actor&&(this.renderer.addVolume(this.labelmap.actor),this.api&&(this.api.actors=this.api.actors.concat(this.labelmap.actor))),i.mapper.setInputConnection(this.paintFilter.getOutputPort()),this.paintFilter.setLabelMap(a),this.subs.labelmap.sub(a.onModified((function(){i.mapper.modified(),t.renderWindow.render()}))),this.genericRenderWindow.resize()}e.labelmapRenderingOptions&&e.labelmapRenderingOptions.visible!==this.props.labelmapRenderingOptions.visible&&this.labelmap.actor.setVisibility(e.labelmapRenderingOptions.visible),e.painting!==this.props.painting&&(this.props.painting?(this.viewWidget=this.widgetManager.addWidget(this.paintWidget,Ni.ViewTypes.SLICE),this.subs.paintStart.sub(this.viewWidget.onStartInteractionEvent((function(){t.paintFilter.startStroke(),t.paintFilter.addPoint(t.paintWidget.getWidgetState().getTrueOrigin()),t.props.onPaintStart&&t.props.onPaintStart()}))),this.subs.paint.sub(this.viewWidget.onInteractionEvent((function(){t.viewWidget.getPainting()&&(t.paintFilter.addPoint(t.paintWidget.getWidgetState().getTrueOrigin()),t.props.onPaint&&t.props.onPaint())}))),this.subs.paintEnd.sub(this.viewWidget.onEndInteractionEvent((function(){var e=t.paintFilter.endStroke();t.props.onPaintEnd&&e.then((function(e){t.props.onPaintEnd(e)}))}))),this.widgetManager.grabFocus(this.paintWidget),this.widgetManager.enablePicking(),this.genericRenderWindow.resize()):this.viewWidget&&(this.widgetManager.releaseFocus(),this.widgetManager.removeWidget(this.paintWidget),this.widgetManager.disablePicking(),this.subs.paintStart.unsubscribe(),this.subs.paint.unsubscribe(),this.subs.paintEnd.unsubscribe(),this.viewWidget=null,this.genericRenderWindow.resize()))}},{key:"componentWillUnmount",value:function(){var e=this;Object.keys(this.subs).forEach((function(t){e.subs[t].unsubscribe()})),this.props.onDestroyed&&this.props.onDestroyed(),this.genericRenderWindow.delete()}},{key:"render",value:function(){if(!this.props.volumes||!this.props.volumes.length)return null;var e={width:"100%",height:"100%",position:"relative"},t=this.state.voi,n=this.props.showRotation?this.state.rotation:null;return R.a.createElement("div",{style:e},R.a.createElement("div",{ref:this.container,style:e}),R.a.createElement(qi,c()({},this.props.dataDetails,{voi:t,rotation:n})))}}]),t}(I.Component);W()(ro,"propTypes",{volumes:T.a.array.isRequired,actors:T.a.array,painting:T.a.bool.isRequired,paintFilterBackgroundImageData:T.a.object,paintFilterLabelMapImageData:T.a.object,onPaint:T.a.func,onPaintStart:T.a.func,onPaintEnd:T.a.func,dataDetails:T.a.object,onCreated:T.a.func,onDestroyed:T.a.func,orientation:T.a.object,labelmapRenderingOptions:T.a.object,showRotation:T.a.bool}),W()(ro,"defaultProps",{painting:!1,labelmapRenderingOptions:{visible:!0,renderOutline:!0,segmentsDefaultProperties:[],onNewSegmentationRequested:function(){}},showRotation:!1});var ao=n(30),io=n.n(ao),oo=n(19),so=n.n(oo),co=function(e){function t(e){var n;return f()(this,t),n=w()(this,b()(t).call(this,e)),W()(S()(n),"getVOI",(function(e){return{windowCenter:e.getProperty().getColorLevel(),windowWidth:e.getProperty().getColorWindow()}})),n.genericRenderWindow=null,n.widgetManager=q.a.newInstance(),n.container=R.a.createRef(),n.subs={interactor:Ui(),data:Ui(),labelmap:Ui()},n.interactorStyleSubs=[],n.state={voi:n.getVOI(e.actors[0]),freezeSlice:!1},n.apiProperties={},n}return C()(t,e),v()(t,[{key:"componentDidMount",value:function(){var e=this,t=Ti();this.genericRenderWindow=j.a.newInstance({background:[0,0,0]}),this.genericRenderWindow.setContainer(this.container.current),this.renderWindow=this.genericRenderWindow.getRenderWindow();var n=this.props.actors,r=this.props.labelmapActors,a=this.genericRenderWindow.getRenderer();this.renderer=a,this.renderWindow=this.genericRenderWindow.getRenderWindow();var i=this.genericRenderWindow.getOpenGLRenderWindow();this.labelmapRenderer=L.a.newInstance();var o=this.labelmapRenderer;this.renderWindow.addRenderer(this.labelmapRenderer),this.renderWindow.setNumberOfLayers(2),o.setLayer(1),o.setInteractive(!1),i.buildPass(!0);var s=so.a.newInstance();s.setInteractionMode("IMAGE_SLICING"),this.renderWindow.getInteractor().setInteractorStyle(s);var c=this.renderWindow.getInteractor(),u=function(){var e=this.renderer.getActiveCamera(),t=this.labelmapRenderer.getActiveCamera(),n=e.getReferenceByName("position"),r=e.getReferenceByName("focalPoint"),a=e.getReferenceByName("viewUp"),i=e.getReferenceByName("viewAngle"),o=e.getParallelScale();t.set({position:n,focalPoint:r,viewUp:a,viewAngle:i,parallelScale:o}),this.state.freezeSlice||this.props.actors.forEach((function(t){t.getMapper().setSliceFromCamera(e)}))}.bind(this);c.onAnimation(u),this.widgetManager.disablePicking(),this.widgetManager.setRenderer(this.labelmapRenderer),n.forEach((function(e){a.addViewProp(e)})),r&&r.forEach((function(e){o.addViewProp(e)}));var d,l=n[0].getMapper(),h=l.getInputData(),g=h.getDimensions(),f=this.props,p=f.orientation,v=f.planeMap;switch(v[p].plane){case 0:d=io.a.SlicingMode.I;break;case 1:d=io.a.SlicingMode.J;break;case 2:d=io.a.SlicingMode.K}var m,w=g[v[p].plane],y=Math.floor(w/2),b=v[p].flip;switch(p){case"Sagittal":m=[0,0,1],this.setState({slice:y,neswMetadata:{n:"S",s:"I",e:"P",w:"A"}});break;case"Coronal":m=[0,0,1],this.setState({slice:y,neswMetadata:{n:"S",s:"I",e:"R",w:"L"}});break;case"Axial":m=[0,-1,0],this.setState({slice:y,neswMetadata:{n:"A",s:"P",e:"R",w:"L"}})}n.forEach((function(e){e.getMapper().setSlicingMode(d),e.getMapper().setSlice(y)})),r&&r.forEach((function(e){e.getMapper().setSlicingMode(d),e.getMapper().setSlice(y)})),l.onModified((function(){var t=l.getSlice();e.setState({slice:t}),r&&r.forEach((function(e){e.getMapper().setSlice(t)}))})),this.renderer.getActiveCamera().setParallelProjection(!0),o.getActiveCamera().setParallelProjection(!0),this.setCamera(d,b,m,a,h);var M=aa.newInstance();M.setRenderer(this.renderer),M.setScale(1),this.svgWidgetManager=M,this.renderer.resetCamera(),this.labelmapRenderer.resetCamera(),this.genericRenderWindow.resize(),u(),this.renderWindow.render();var S=this.updateVOI.bind(this),k=this.getOrientation.bind(this),C=this.setInteractorStyle.bind(this),x=this.addSVGWidget.bind(this),W=this.getApiProperty.bind(this),I=this.setApiProperty.bind(this),R=this.setCamera.bind(this),P=this.updateImage.bind(this),T=this.getSliceNormal.bind(this),D=this.requestNewSegmentation.bind(this),E=this.setFreezeSlice.bind(this);if(this.svgWidgets={},this.props.onCreated){var O={uid:t,genericRenderWindow:this.genericRenderWindow,widgetManager:this.widgetManager,svgWidgetManager:this.svgWidgetManager,addSVGWidget:x,container:this.container.current,widgets:[],svgWidgets:this.svgWidgets,filters:[],actors:n,sliceMode:d,_component:this,updateImage:P,updateVOI:S,getOrientation:k,setInteractorStyle:C,getSliceNormal:T,requestNewSegmentation:D,setCamera:R,get:W,set:I,setFreezeSlice:E,type:"VIEW2D"};this.props.onCreated(O)}}},{key:"getApiProperty",value:function(e){return this.apiProperties[e]}},{key:"setApiProperty",value:function(e,t){this.apiProperties[e]=t}},{key:"addSVGWidget",value:function(e,t){var n=this.svgWidgetManager;n.addWidget(e),n.render(),this.svgWidgets[t]=e}},{key:"updateImage",value:function(){this.genericRenderWindow.getRenderWindow().render()}},{key:"requestNewSegmentation",value:function(){this.props.labelmapRenderingOptions.onNewSegmentationRequested()}},{key:"setInteractorStyle",value:function(e){for(var t,n=this,r=e.istyle,a=e.callbacks,i=void 0===a?{}:a,o=e.configuration,s=void 0===o?{}:o,c=this.props.actors,u=this.genericRenderWindow.getRenderWindow(),d=u.getInteractor().getInteractorStyle();this.interactorStyleSubs.length;)this.interactorStyleSubs.pop().unsubscribe();d.getViewport&&r.getViewport&&(t=d.getViewport());var l=u.getInteractor();l.setInteractorStyle(r),r.setInteractor(l),t&&r.setViewport(t),r.getImageActor&&r.getImageActor()!==c[0]&&r.setImageActor(c[0]),u.render(),Object.keys(i).forEach((function(e){if("function"==typeof r[e]){var t=r[e](i[e]);t&&"function"==typeof t.unsubscribe&&n.interactorStyleSubs.push(t)}})),s&&r.set(s),u.render()}},{key:"updateVOI",value:function(e,t){this.setState({voi:{windowWidth:e,windowCenter:t}})}},{key:"getOrientation",value:function(){return this.props.orientation}},{key:"setCamera",value:function(e,t,n,r,a){var i=[0,0,0],o=[0,0,0],s=[0,0,0];a.indexToWorldVec3(i,s),i[e]=t?-1:1,a.indexToWorldVec3(i,o),r.getActiveCamera().set({focalPoint:s,position:o,viewUp:n}),r.resetCamera()}},{key:"getSliceNormal",value:function(){return this.genericRenderWindow.getRenderWindow().getInteractor().getInteractorStyle().getSliceNormal()}},{key:"setFreezeSlice",value:function(e){this.setState({freezeSlice:e})}},{key:"componentWillUnmount",value:function(){var e=this;Object.keys(this.subs).forEach((function(t){e.subs[t].unsubscribe()})),this.props.onDestroyed&&this.props.onDestroyed(),this.genericRenderWindow.delete()}},{key:"render",value:function(){if(!this.props.actors||!this.props.actors.length)return null;var e={width:"100%",height:"100%",position:"relative"},t=this.state.voi;return R.a.createElement("div",{style:e},R.a.createElement("div",{ref:this.container,style:e}),R.a.createElement(qi,c()({},this.props.dataDetails,{voi:t,orientation:this.props.orientation,neswMetadata:this.state.neswMetadata,slice:this.state.slice})))}}]),t}(I.Component);W()(co,"propTypes",{actors:T.a.array,labelmapActors:T.a.array,dataDetails:T.a.object,onCreated:T.a.func,onDestroyed:T.a.func,orientation:T.a.string.isRequired,orientationName:T.a.string,labelmapRenderingOptions:T.a.object,planeMap:T.a.object});var uo=function(e){function t(e){var n;return f()(this,t),(n=w()(this,b()(t).call(this,e))).genericRenderWindow=null,n.widgetManager=q.a.newInstance(),n.container=R.a.createRef(),n.subs={interactor:Ui(),data:Ui(),labelmap:Ui(),paint:Ui(),paintStart:Ui(),paintEnd:Ui()},n}return C()(t,e),v()(t,[{key:"componentDidMount",value:function(){this.genericRenderWindow=j.a.newInstance({background:[0,0,0]}),this.genericRenderWindow.setContainer(this.container.current);var e,t,n=[],r=[];if(this.renderer=this.genericRenderWindow.getRenderer(),this.renderWindow=this.genericRenderWindow.getRenderWindow(),this.widgetManager.disablePicking(),this.widgetManager.setRenderer(this.renderer),this.paintWidget=Jr.a.newInstance(),this.paintWidget.setRadius(5),this.paintFilter=Kr.a.newInstance(),this.paintFilter.setLabel(1),this.paintFilter.setRadius(5),this.componentDidUpdate({}),this.props.actors&&(n=n.concat(this.props.actors)),this.labelmap&&this.labelmap.actor&&(n=n.concat(this.labelmap.actor)),this.props.volumes&&(r=r.concat(this.props.volumes)),t=[this.paintFilter],e=[this.paintWidget],this.labelmap&&this.labelmap.actor&&this.renderer.addVolume(this.labelmap.actor),this.renderer.resetCamera(),this.renderer.updateLightsGeometryToFollowCamera(),this.genericRenderWindow.resize(),this.props.onCreated){var a={genericRenderWindow:this.genericRenderWindow,widgetManager:this.widgetManager,container:this.container.current,widgets:e,filters:t,actors:n,volumes:r,type:"VIEW3D",_component:this};this.props.onCreated(a)}}},{key:"componentDidUpdate",value:function(e){var t=this;if(console.time("View3D componentDidUpdate"),e.volumes!==this.props.volumes&&(this.props.volumes.forEach((function(e){e.isA("vtkVolume")||console.warn("Data to <Vtk2D> is not vtkVolume data")})),this.props.volumes.length&&this.props.volumes.forEach(this.renderer.addVolume),this.renderWindow.render()),e.actors!==this.props.actors&&this.props.actors&&(this.props.actors.forEach((function(e){e.isA("vtkActor")||console.warn("Data to <Vtk2D> is not vtkActor data")})),this.props.actors.length&&this.props.actors.forEach(this.renderer.addActor),this.renderWindow.render()),!e.paintFilterBackgroundImageData&&this.props.paintFilterBackgroundImageData?(this.subs.data.sub(this.props.paintFilterBackgroundImageData.onModified((function(){return t.renderWindow.render()}))),this.paintFilter.setBackgroundImage(this.props.paintFilterBackgroundImageData)):e.paintFilterBackgroundImageData&&!this.props.paintFilterBackgroundImageData&&(this.paintFilter.setBackgroundImage(null),this.subs.data.unsubscribe()),e.paintFilterLabelMapImageData!==this.props.paintFilterLabelMapImageData&&this.props.paintFilterLabelMapImageData){this.subs.labelmap.unsubscribe();var n=this.props.paintFilterLabelMapImageData,r=eo(this.props.paintFilterBackgroundImageData,n,this.props.labelmapRenderingOptions,!1);this.labelmap=r,r.mapper.setInputConnection(this.paintFilter.getOutputPort()),this.paintFilter.setLabelMap(n),this.subs.labelmap.sub(n.onModified((function(){r.mapper.modified(),t.renderWindow.render()})))}e.painting!==this.props.painting&&(this.props.painting?(console.time("turnOnPainting"),this.viewWidget=this.widgetManager.addWidget(this.paintWidget,Ni.ViewTypes.VOLUME),this.subs.paintStart.sub(this.viewWidget.onStartInteractionEvent((function(){t.paintFilter.startStroke(),t.paintFilter.addPoint(t.paintWidget.getWidgetState().getTrueOrigin()),t.props.onPaintStart&&t.props.onPaintStart()}))),this.subs.paint.sub(this.viewWidget.onInteractionEvent((function(){t.viewWidget.getPainting()&&(t.paintFilter.addPoint(t.paintWidget.getWidgetState().getTrueOrigin()),t.props.onPaint&&t.props.onPaint())}))),this.subs.paintEnd.sub(this.viewWidget.onEndInteractionEvent((function(){var e=t.paintFilter.endStroke();t.props.onPaintEnd&&e.then((function(e){t.props.onPaintEnd(e)}))}))),this.widgetManager.grabFocus(this.paintWidget),this.widgetManager.enablePicking(),console.timeEnd("turnOnPainting")):this.viewWidget&&(console.time("turnOffPainting"),this.widgetManager.releaseFocus(),this.widgetManager.removeWidget(this.paintWidget),this.widgetManager.disablePicking(),this.subs.paintStart.unsubscribe(),this.subs.paint.unsubscribe(),this.subs.paintEnd.unsubscribe(),this.viewWidget=null,console.timeEnd("turnOffPainting"))),console.timeEnd("View3D componentDidUpdate")}},{key:"componentWillUnmount",value:function(){var e=this;Object.keys(this.subs).forEach((function(t){e.subs[t].unsubscribe()})),this.props.onDestroyed&&this.props.onDestroyed(),this.genericRenderWindow.delete()}},{key:"render",value:function(){if(!this.props.volumes&&!this.props.actors)return null;var e={width:"100%",height:"100%",position:"relative"},t={windowCenter:0,windowWidth:0};if(this.pipeline){var n=this.props.volumes[0].getProperty().getRGBTransferFunction(0).getMappingRange(),r=n[0]+n[1];t={windowCenter:n[0]+r/2,windowWidth:r}}return R.a.createElement("div",{style:e},R.a.createElement("div",{ref:this.container,style:e}),R.a.createElement(qi,c()({},this.props.dataDetails,{voi:t})))}}]),t}(I.Component);W()(uo,"propTypes",{volumes:T.a.array,actors:T.a.array,painting:T.a.bool.isRequired,paintFilterBackgroundImageData:T.a.object,paintFilterLabelMapImageData:T.a.object,onPaint:T.a.func,onPaintStart:T.a.func,onPaintEnd:T.a.func,sliceNormal:T.a.array.isRequired,dataDetails:T.a.object,onCreated:T.a.func,onDestroyed:T.a.func,labelmapRenderingOptions:T.a.object}),W()(uo,"defaultProps",{painting:!1,sliceNormal:[0,0,1],labelmapRenderingOptions:{visible:!0,renderOutline:!1}});var lo=n(31),ho=n.n(lo),go=n(41),fo=n.n(go),po=function(e){function t(e){var n;return f()(this,t),(n=w()(this,b()(t).call(this,e))).genericRenderWindow=null,n.widgetManager=q.a.newInstance(),n.container=R.a.createRef(),n.subs={interactor:Ui()},n.interactorStyleSubs=[],n.apiProperties={},n}return C()(t,e),v()(t,[{key:"componentDidMount",value:function(){this.genericRenderWindow=j.a.newInstance({background:[0,0,0]}),this.genericRenderWindow.setContainer(this.container.current);var e=[];this.renderer=this.genericRenderWindow.getRenderer(),this.renderWindow=this.genericRenderWindow.getRenderWindow();var t=this.renderWindow.getInteractor();this.widgetManager.disablePicking(),this.widgetManager.setRenderer(this.renderer),this.axes=fo.a.newInstance(),this.orientationWidget=ho.a.newInstance({actor:this.axes,interactor:t}),this.orientationWidget.setEnabled(!0),this.orientationWidget.setViewportCorner(ho.a.Corners.BOTTOM_RIGHT),this.orientationWidget.setMinPixelSize(50),this.orientationWidget.setMaxPixelSize(500);var n=this.props.planeMap,r=function(e){var t,r,a,i,o,s,c=n[e],u=c.flip;switch(e){case"Sagittal":u?(r="L",t="R"):(r="R",t="L"),i=-90,a=90;break;case"Coronal":u?(r="P",t="A"):(r="A",t="P"),i=0,a=180;break;case"Axial":u?(r="S",t="I"):(r="I",t="S"),i=180,a=0}switch(c.plane){case 0:s=this.axes.setXMinusFaceProperty,o=this.axes.setXPlusFaceProperty;break;case 1:s=this.axes.setYMinusFaceProperty,o=this.axes.setYPlusFaceProperty;break;case 2:s=this.axes.setZMinusFaceProperty,o=this.axes.setZPlusFaceProperty}o({text:t,faceRotation:a}),s({text:r,faceRotation:i})}.bind(this);Object.keys(n).forEach(r),window.addEventListener("resize",this.genericRenderWindow.resize),window.addEventListener("resize",this.orientationWidget.updateViewport),this.componentDidUpdate({}),this.props.actors&&(e=e.concat(this.props.actors)),this.renderer.resetCamera(),this.renderer.updateLightsGeometryToFollowCamera();var a=aa.newInstance();a.setRenderer(this.renderer),a.setScale(1),this.svgWidgetManager=a,this.genericRenderWindow.resize();var i=this.addSVGWidget.bind(this),o=this.setInteractorStyle.bind(this),s=this.getApiProperty.bind(this),c=this.setApiProperty.bind(this);if(this.svgWidgets={},this.props.onCreated){var u={genericRenderWindow:this.genericRenderWindow,widgetManager:this.widgetManager,svgWidgetManager:this.svgWidgetManager,addSVGWidget:i,setInteractorStyle:o,container:this.container.current,actors:e,svgWidgets:this.svgWidgets,get:s,set:c,type:"VIEW3D",_component:this};this.props.onCreated(u)}}},{key:"componentDidUpdate",value:function(e){if(console.time("View3DMarchingCubes componentDidUpdate"),e.actors!==this.props.actors){this.props.actors.length&&this.props.actors.forEach(this.renderer.addActor);var t=this.props.planeMap,n=[0,0,0];n[t.Sagittal.plane]=t.Sagittal.flip?-1:1;var r=[0,0,0];r[t.Axial.plane]=t.Axial.flip?-1:1;var a=this.renderer.getActiveCamera();a.setDirectionOfProjection(-n[0],-n[1],-n[2]),a.setViewUp.apply(a,r),this.renderer.resetCamera(),this.orientationWidget.updateMarkerOrientation()}console.timeEnd("View3DMarchingCubes componentDidUpdate")}},{key:"componentWillUnmount",value:function(){var e=this;Object.keys(this.subs).forEach((function(t){e.subs[t].unsubscribe()})),this.props.onDestroyed&&this.props.onDestroyed(),this.genericRenderWindow.delete()}},{key:"addSVGWidget",value:function(e,t){var n=this.svgWidgetManager;n.addWidget(e),n.render(),this.svgWidgets[t]=e}},{key:"setInteractorStyle",value:function(e){for(var t,n=this,r=e.istyle,a=e.callbacks,i=void 0===a?{}:a,o=e.configuration,s=void 0===o?{}:o,c=this.props.actors,u=this.genericRenderWindow.getRenderWindow(),d=u.getInteractor().getInteractorStyle();this.interactorStyleSubs.length;)this.interactorStyleSubs.pop().unsubscribe();d.getViewport&&r.getViewport&&(t=d.getViewport());var l=u.getInteractor();l.setInteractorStyle(r),r.setInteractor(l),t&&r.setViewport(t),r.getActor&&r.getActor()!==c[0]&&r.setActor(c[0]),Object.keys(i).forEach((function(e){if("function"==typeof r[e]){var t=r[e](i[e]);t&&"function"==typeof t.unsubscribe&&n.interactorStyleSubs.push(t)}})),s&&r.set(s),u.render()}},{key:"getApiProperty",value:function(e){return this.apiProperties[e]}},{key:"setApiProperty",value:function(e,t){this.apiProperties[e]=t}},{key:"render",value:function(){if(!this.props.actors)return null;var e={width:"100%",height:"100%",position:"relative"};return R.a.createElement("div",{style:e},R.a.createElement("div",{ref:this.container,style:e}))}}]),t}(I.Component);function vo(e,t){var n=Math.abs(e-t);return{windowWidth:n,windowCenter:e+n/2}}W()(po,"propTypes",{actors:T.a.array,sourceDataDirection:T.a.object,onCreated:T.a.func,onDestroyed:T.a.func,dataDetails:T.a.object,planeMap:T.a.object});var mo=ae.a.States;var wo={wlStartPos:[0,0],levelScale:1};function yo(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object.assign(t,wo,n),Qr.extend(e,t,n),U.a.setGet(e,t,["onLevelsChanged","levelScale"]),function(e,t){t.classHierarchy.push("vtkInteractorStyleMPRWindowLevel");var n=e.handleMouseMove;e.handleMouseMove=function(r){var a=[r.position.x,r.position.y];t.state===mo.IS_WINDOW_LEVEL&&(e.windowLevelFromMouse(a),e.invokeInteractionEvent({type:"InteractionEvent"})),n&&n(r)},e.windowLevelFromMouse=function(n){var r=t.volumeActor.getMapper().getInputData().getPointData().getScalars().getRange(),a=r[1]-r[0],i=Math.round(a/1024)*e.getLevelScale(),o=Math.round((n[0]-t.wlStartPos[0])*i),s=Math.round((n[1]-t.wlStartPos[1])*i),c=t.levels.windowWidth+o,u=t.levels.windowCenter-s;if(c=Math.max(.01,c),t.windowWidth!==c||t.windowCenter!==u){e.setWindowLevel(c,u),t.wlStartPos[0]=Math.round(n[0]),t.wlStartPos[1]=Math.round(n[1]);var d=e.getOnLevelsChanged();d&&d({windowCenter:u,windowWidth:c})}},e.getWindowLevel=function(){var e=t.volumeActor.getProperty().getRGBTransferFunction(0).getMappingRange().slice();return vo.apply(void 0,h()(e))},e.setWindowLevel=function(e,n){var r=function(e,t){return{lower:t-e/2,upper:t+e/2}}(e,n);t.levels.windowWidth=e,t.levels.windowCenter=n,t.volumeActor.getProperty().getRGBTransferFunction(0).setMappingRange(r.lower,r.upper)};var r=e.handleLeftButtonPress;e.handleLeftButtonPress=function(n){if(t.wlStartPos[0]=n.position.x,t.wlStartPos[1]=n.position.y,n.shiftKey||n.controlKey)r&&r(n);else{var a=t.volumeActor.getProperty();a&&(t.initialMRange=a.getRGBTransferFunction(0).getMappingRange().slice(),t.levels=vo(t.initialMRange[0],t.initialMRange[1]),e.startWindowLevel())}},e.superHandleLeftButtonRelease=e.handleLeftButtonRelease,e.handleLeftButtonRelease=function(){switch(t.state){case mo.IS_WINDOW_LEVEL:e.endWindowLevel();break;default:e.superHandleLeftButtonRelease()}}}(e,t)}var bo=U.a.newInstance(yo,"vtkInteractorStyleMPRWindowLevel"),Mo=Object.assign({newInstance:bo,extend:yo}),So=ae.a.States;var ko={};function Co(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object.assign(t,ko,n),Qr.extend(e,t,n),U.a.setGet(e,t,["callback","apis","apiIndex","onScroll"]),function(e,t){function n(n){var r=t.apis,a=t.apiIndex,i=r[a],o=n.position,s=n.pokedRenderer,c=ne.a.newInstance();c.setCoordinateSystemToDisplay(),c.setValue(o.x,o.y,0);for(var u=c.getComputedWorldValue(s),d=s.getActiveCamera().getDirectionOfProjection(),l=i.getSlabThickness()/2,h=0;h<u.length;h++)u[h]+=l*d[h];i.svgWidgets.crosshairsWidget.moveCrosshairs(u,r,a),e.invokeInteractionEvent({type:"InteractionEvent"})}t.classHierarchy.push("vtkInteractorStyleMPRCrosshairs");var r=e.handleMouseMove;e.handleMouseMove=function(e){t.state===So.IS_WINDOW_LEVEL&&n(e),r&&r(e)};var a=e.handleLeftButtonPress;e.handleLeftButtonPress=function(r){r.shiftKey||r.controlKey?a&&a(r):t.volumeActor&&(n(r),e.startWindowLevel())},e.superHandleLeftButtonRelease=e.handleLeftButtonRelease,e.handleLeftButtonRelease=function(){switch(t.state){case So.IS_WINDOW_LEVEL:e.endWindowLevel();break;default:e.superHandleLeftButtonRelease()}}}(e,t)}var xo=U.a.newInstance(Co,"vtkInteractorStyleMPRCrosshairs"),Wo=Object.assign({newInstance:xo,extend:Co}),Io=ae.a.States,Ro={ROTATE_CROSSHAIRS:0,MOVE_CROSSHAIRS:1,MOVE_REFERENCE_LINE:2,PAN:3};function Po(e,t){function n(e,t){var n=d()(e.points,2),r=n[0],a=n[1],i=t;return 2*Math.abs((r.x*(a.y-i.y)+a.x*(i.y-r.y)+i.x*(r.y-a.y))/2)/o.distance([r.x,r.y],[a.x,a.y])}function r(n){switch(t.operation.type){case Ro.MOVE_CROSSHAIRS:case Ro.MOVE_REFERENCE_LINE:!function(n){var r,a=t.apis,i=t.apiIndex,s=a[i],c=t.operation.snapToLineIndex;r=void 0!==c?function(e,n){var r=t.apis,a=t.apiIndex,i=r[a],s=i.svgWidgetManager,c=s.getSize(),u=s.getScale(),d=c[1],l={x:e.x*u,y:d-e.y*u},h=i.svgWidgets.rotatableCrosshairsWidget.getReferenceLines()[n].points,g=[],f=[];o.sub(g,[l.x,l.y],[h[0].x,h[0].y]),o.sub(f,[h[1].x,h[1].y],[h[0].x,h[0].y]);var p=o.distance([h[0].x,h[0].y],[h[1].x,h[1].y]),v=[f[0]/p,f[1]/p],m=o.dot(g,f)/p,w=[h[0].x+v[0]*m,h[0].y+v[1]*m];return{x:w[0]/u,y:(d-w[1])/u}}(n.position,c):n.position;var u=n.pokedRenderer,d=ne.a.newInstance();d.setCoordinateSystemToDisplay(),d.setValue(r.x,r.y,0);for(var l=d.getComputedWorldValue(u),h=u.getActiveCamera().getDirectionOfProjection(),g=s.getSlabThickness()/2,f=0;f<l.length;f++)l[f]+=g*h[f];s.svgWidgets.rotatableCrosshairsWidget.moveCrosshairs(l,a,i),e.invokeInteractionEvent({type:"InteractionEvent"})}(n);break;case Ro.ROTATE_CROSSHAIRS:!function(e){var n=t.operation,r=n.prevPosition,s=e.position;if(s.x===r.x&&s.y===r.y)return;var c=t.apis,u=t.apiIndex,d=c[u],l=d.svgWidgets.rotatableCrosshairsWidget.getPoint(),h=[],g=[];o.subtract(h,[r.x,r.y],l),o.subtract(g,[s.x,s.y],l);var f=o.angle(h,g);g[0]*h[1]-g[1]*h[0]<0&&(f*=-1);var p=d.getSliceNormal(),v=[-p[0],-p[1],-p[2]],m=G.a.buildFromRadian().rotate(f,v).matrix;c.forEach((function(e,t){if(t!==u){var n=e.getSliceNormal(),r=e.getViewUp(),i=[],o=[];a.transformMat4(i,n,m),a.transformMat4(o,r,m),e.setOrientation(i,o)}})),i(e),n.prevPosition=s}(n);break;case Ro.PAN:pan(n)}}function i(e){var n=t.apis,r=t.apiIndex,a=n[r],i=a.svgWidgets.rotatableCrosshairsWidget.getPoint(),o=e.pokedRenderer,s=ne.a.newInstance();s.setCoordinateSystemToDisplay(),s.setValue(i[0],i[1],0);for(var c=s.getComputedWorldValue(o),u=o.getActiveCamera().getDirectionOfProjection(),d=a.getSlabThickness()/2,l=0;l<c.length;l++)c[l]+=d*u[l];a.svgWidgets.rotatableCrosshairsWidget.moveCrosshairs(c,n,r)}t.classHierarchy.push("vtkInteractorStyleRotatableMPRCrosshairs");var s=e.handleMouseMove;e.handleMouseMove=function(e){t.state===Io.IS_WINDOW_LEVEL?r(e):function(e){var r,a=t.apis,s=t.apiIndex,c=t.lineGrabDistance,u=a[s],d=e.position,l=[!1,!1],h=[!1,!1],g=u.svgWidgets.rotatableCrosshairsWidget;if(!g)throw new Error("Must use rotatable crosshair svg widget with this istyle.");var f=g.getReferenceLines(),p=g.getPoint(),v=g.getCenterRadius();if(o.distance(p,[d.x,d.y])>v){for(var m=u.svgWidgetManager,w=m.getSize(),y=m.getScale(),b=w[1],M={x:d.x*y,y:b-d.y*y},S=!1,k=0;k<f.length;k++)for(var C=f[k].rotateHandles.points,x=0;x<C.length;x++){if(o.distance([C[x].x,C[x].y],[M.x,M.y])<c){l[k]=!0,S=!0;break}}if(!S){var W=n(f[0],M),I=n(f[1],M);if(W<=c||I<=c)h[W<I?0:1]=!0}}else h[0]=!0,h[1]=!0;f.forEach((function(e,t){var n=h[t],a=l[t],i=e.rotateHandles;e.selected!==n&&(e.selected=n,r=!0),i.selected!==a&&(i.selected=a,r=!0)})),r&&i(e)}(e),s&&s(e)};var c=e.handleLeftButtonPress;e.handleLeftButtonPress=function(a){a.shiftKey||a.controlKey?c&&c(a):t.volumeActor&&(!function(e){var r=t.apis,a=t.apiIndex,i=t.lineGrabDistance,s=r[a],c=e.position,u=s.svgWidgets.rotatableCrosshairsWidget;if(!u)throw new Error("Must use rotatable crosshair svg widget with this istyle.");var d=u.getReferenceLines(),l=u.getPoint(),h=u.getCenterRadius();if(o.distance(l,[c.x,c.y])<h)return t.operation={type:Ro.MOVE_CROSSHAIRS},void d.forEach((function(e){e.selected=!0}));for(var g=s.svgWidgetManager,f=g.getSize(),p=g.getScale(),v=f[1],m={x:c.x*p,y:v-c.y*p},w=0;w<d.length;w++)for(var y=d[w].rotateHandles,b=y.points,M=0;M<b.length;M++){if(o.distance([b[M].x,b[M].y],[m.x,m.y])<i)return t.operation={type:Ro.ROTATE_CROSSHAIRS,prevPosition:c},void(y.selected=!0)}var S=n(d[0],m),k=n(d[1],m);if(S<=i||k<=i){var C=S<k?0:1;d[C].selected=!0;var x=0===C?1:0;t.operation={type:Ro.MOVE_REFERENCE_LINE,snapToLineIndex:x}}else t.operation={type:null}}(a),r(a),e.startWindowLevel())},e.superHandleLeftButtonRelease=e.handleLeftButtonRelease,e.handleLeftButtonRelease=function(n){switch(t.state){case Io.IS_WINDOW_LEVEL:!function(n){t.operation={type:null};var r=t.apis,a=t.apiIndex,o=r[a].svgWidgets.rotatableCrosshairsWidget;if(!o)throw new Error("Must use rotatable crosshair svg widget with this istyle.");o.getReferenceLines().forEach((function(e){e.selected=!1,e.rotateHandles.selected=!1})),i(n),e.endWindowLevel()}(n);break;default:e.superHandleLeftButtonRelease()}}}var To={operation:{type:null},lineGrabDistance:20};function Do(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object.assign(t,To,n),Qr.extend(e,t,n),U.a.setGet(e,t,["callback","apis","apiIndex","onScroll","operation","lineGrabDistance"]),Po(e,t)}var Eo=U.a.newInstance(Do,"vtkInteractorStyleRotatableMPRCrosshairs"),Oo=Object.assign({newInstance:Eo,extend:Do}),jo=n(28),Ao=n.n(jo),Lo=n(42),Vo=n.n(Lo),qo=ae.a.States;var No={};function Uo(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object.assign(t,No,n),so.a.extend(e,t,n),U.a.setGet(e,t,["callback","apis","apiIndex","imageActor"]),function(e,t){t.classHierarchy.push("vtkInteractorStyleCrosshairsImageMapper"),t.planeManipulator=Ao.a.newInstance(),e.resetCrosshairs=function(){var n=t.apis,r=t.apiIndex;n[r].svgWidgets.crosshairsWidget.moveCrosshairs(e.getSliceCenter(),n,r),e.invokeInteractionEvent({type:"InteractionEvent"})},e.moveCrosshairs=function(n){var r=t.apis,a=t.apiIndex,i=r[a];t.planeManipulator.setNormal(e.getSliceNormal()),t.planeManipulator.setOrigin(e.getSliceCenter());var o=t.planeManipulator.handleEvent(n,i.genericRenderWindow.getOpenGLRenderWindow());i.svgWidgets.crosshairsWidget.moveCrosshairs(o,r,a),e.invokeInteractionEvent({type:"InteractionEvent"})},e.updateCrosshairsAfterScroll=function(){var n=t.apis,r=t.apiIndex,a=n[r],i=a.genericRenderWindow.getRenderer().getActiveCamera();a.actors.forEach((function(e){e.getMapper().setSliceFromCamera(i)}));var o=a.get("cachedCrosshairWorldPosition"),s=e.getSliceNormal().findIndex((function(e){return 1==Math.abs(Math.round(e))}));o[s]=i.getFocalPoint()[s],a.svgWidgets.crosshairsWidget.moveCrosshairs(o,n,r),e.invokeInteractionEvent({type:"InteractionEvent"})};var n=e.handleMouseMove;e.handleMouseMove=function(r){t.state===qo.IS_ROTATE?e.moveCrosshairs(r):n&&n(r)};var r=e.handleLeftButtonPress;e.handleLeftButtonPress=function(n){!t.imageActor||n.shiftKey||n.controlKey?r&&r(n):(e.moveCrosshairs(n),e.startRotate())},e.superHandleLeftButtonRelease=e.handleLeftButtonRelease,e.handleLeftButtonRelease=function(){switch(t.state){case qo.IS_ROTATE:e.endRotate();break;default:e.superHandleLeftButtonRelease()}},e.superHandleMouseWheel=e.handleMouseWheel,e.handleMouseWheel=function(t){e.superHandleMouseWheel(t),e.updateCrosshairsAfterScroll()},e.getSliceNormal=function(){return t.interactor.getCurrentRenderer().getActiveCamera().getDirectionOfProjection()},e.getSliceCenter=function(){return Vo.a.getCenter(t.imageActor.getBoundsForSlice())},e.setImageActor=function(e){t.imageActor=e;var n=t.interactor.getCurrentRenderer().getActiveCamera();e?n.setFreezeFocalPoint(!0):n.setFreezeFocalPoint(!1)}}(e,t)}var Fo=U.a.newInstance(Uo,"vtkInteractorStyleCrosshairsImageMapper"),Bo=Object.assign({newInstance:Fo,extend:Uo}),Ho=n(29),Go=n.n(Ho),_o=ae.a.States;var Yo={};function zo(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object.assign(t,Yo,n),Go.a.extend(e,t,n),U.a.setGet(e,t,["callback","apis","apiIndex","actor"]),function(e,t){t.classHierarchy.push("vtkInteractorStyleCrosshairsMarchingCubes"),t.planeManipulator=Ao.a.newInstance(),e.resetCrosshairs=function(){var n=t.apis,r=t.apiIndex;n[r].svgWidgets.crosshairsWidget.moveCrosshairs(e.getCenter(),n,r),e.invokeInteractionEvent({type:"InteractionEvent"})},e.moveCrosshairs=function(n){var r=t.apis,a=t.apiIndex,i=r[a],o=n.position,s=n.pokedRenderer,c=ne.a.newInstance();c.setCoordinateSystemToDisplay(),c.setValue(o.x,o.y,0);var u=c.getComputedWorldValue(s);i.svgWidgets.crosshairsWidget.moveCrosshairs(u,r,a),e.invokeInteractionEvent({type:"InteractionEvent"})};var n=e.handleMouseMove;e.handleMouseMove=function(r){t.state===_o.IS_WINDOW_LEVEL?e.moveCrosshairs(r):n&&n(r)},e.superHandleLeftButtonPress=e.handleLeftButtonPress,e.handleLeftButtonPress=function(n){n.shiftKey||n.controlKey?e.superHandleLeftButtonPress&&e.superHandleLeftButtonPress(n):t.actor&&(e.moveCrosshairs(n),e.startWindowLevel())},e.handleRightButtonPress=function(t){e.superHandleLeftButtonPress(t)},e.superHandleLeftButtonRelease=e.handleLeftButtonRelease,e.handleRightButtonRelease=function(t){e.superHandleLeftButtonRelease(t)},e.superHandleLeftButtonRelease=e.handleLeftButtonRelease,e.handleLeftButtonRelease=function(){switch(t.state){case _o.IS_WINDOW_LEVEL:e.endWindowLevel();break;default:e.superHandleLeftButtonRelease()}},e.getSliceNormal=function(){return t.actor&&t.interactor?t.interactor.getCurrentRenderer().getActiveCamera().getDirectionOfProjection():[0,0,0]},e.setActor=function(e){t.actor=e;var n=t.interactor.getCurrentRenderer().getActiveCamera();e?n.setFreezeFocalPoint(!0):n.setFreezeFocalPoint(!1)},e.getCemter=function(){var e=t.interactor.getCurrentRenderer(),n=e.getRenderWindow().getViews()[0].getViewportSize(e),r=ne.a.newInstance();return r.setCoordinateSystemToDisplay(),r.setValue(.5*n[0],.5*n[1],0),r.getComputedWorldValue(e)}}(e,t)}var Qo=U.a.newInstance(zo,"vtkInteractorStyleCrosshairsMarchingCubes"),Xo=Object.assign({newInstance:Qo,extend:zo}),Ko=ae.a.States;var Zo={rotateStartPos:[0,0]};function Jo(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object.assign(t,Zo,n),Qr.extend(e,t,n),U.a.setGet(e,t,["onInteractiveRotateChanged"]),function(e,t){t.classHierarchy.push("vtkInteractorStyleMPRRotate"),t.wlStartPos=[0,0];var n=e.handleMouseMove;e.handleMouseMove=function(r){var a=[Math.round(r.position.x),Math.round(r.position.y)],i=r.pokedRenderer;t.state===Ko.IS_ROTATE&&(e.rotateFromMouse(a,i),e.invokeInteractionEvent({type:"InteractionEvent"})),n&&n(r)},e.rotateFromMouse=function(n,r){var a=t.interactor.getView().getViewportSize(r),i=100/a[0],o=100/a[1],s=-(n[1]-t.rotateStartPos[1])*o,c=-(n[0]-t.rotateStartPos[0])*i;e.getViewport().rotateRelative(s,c),t.rotateStartPos[0]=Math.round(n[0]),t.rotateStartPos[1]=Math.round(n[1]);var u=t.apis,d=t.apiIndex,l=u[d];if(l.svgWidgets.crosshairsWidget||l.svgWidgets.rotatableCrosshairsWidget){var g=l.get("cachedCrosshairWorldPosition");if(void 0!==g){var f=ne.a.newInstance();f.setCoordinateSystemToWorld(),f.setValue.apply(f,h()(g));var p=f.getComputedDoubleDisplayValue(r),v=ne.a.newInstance();v.setCoordinateSystemToDisplay(),v.setValue(p[0],p[1],0);for(var m=v.getComputedWorldValue(r),w=r.getActiveCamera().getDirectionOfProjection(),y=l.getSlabThickness()/2,b=0;b<m.length;b++)m[b]+=y*w[b];l.svgWidgets.crosshairsWidget&&l.svgWidgets.crosshairsWidget.moveCrosshairs(m,u,d),l.svgWidgets.rotatableCrosshairsWidget&&l.svgWidgets.rotatableCrosshairsWidget.moveCrosshairs(m,u,d)}}};var r=e.handleLeftButtonPress;e.handleLeftButtonPress=function(n){(t.rotateStartPos[0]=Math.round(n.position.x),t.rotateStartPos[1]=Math.round(n.position.y),n.shiftKey||n.controlKey)?r&&r(n):t.volumeActor.getProperty()&&e.startRotate()},e.superHandleLeftButtonRelease=e.handleLeftButtonRelease,e.handleLeftButtonRelease=function(){switch(t.state){case Ko.IS_ROTATE:e.endRotate();break;default:e.superHandleLeftButtonRelease()}}}(e,t)}var $o=U.a.newInstance(Jo,"vtkInteractorStyleMPRRotate"),es=Object.assign({newInstance:$o,extend:Jo});var ts={};function ns(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object.assign(t,ts,n),so.a.extend(e,t,n),U.a.setGet(e,t,["onLevelsChanged","levelScale"]),function(e,t){t.classHierarchy.push("vtkInteractorStyleImageWindowLevel");var n=e.windowLevel;e.windowLevel=function(r,a){n(r,a);var i=t.currentImageProperty.getColorWindow(),o=t.currentImageProperty.getColorLevel(),s=e.getOnLevelsChanged();s&&s({windowCenter:o,windowWidth:i})}}(e,t)}var rs=U.a.newInstance(ns,"vtkInteractorStyleImageWindowLevel"),as=Object.assign({newInstance:rs,extend:ns});var is={};function os(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object.assign(t,is,n),Go.a.extend(e,t,n),U.a.setGet(e,t,["apis","apiIndex"]),function(e,t){t.classHierarchy.push("vtkInteractorStyleImagePanZoom"),e.superStartPan=e.startPan,e.startPan=function(){t.apis[t.apiIndex].setFreezeSlice(!0),e.superStartPan()},e.superEndPan=e.endPan,e.endPan=function(){t.apis[t.apiIndex].setFreezeSlice(!1),e.superEndPan()},e.handleLeftButtonPress=function(n){n.shiftKey||n.controlKey?(t.previousTranslation=n.translation,e.startPan()):(t.previousPosition=n.position,e.startDolly())},e.handleLeftButtonRelease=function(t){t.shiftKey||t.controlKey?e.endPan():e.endDolly()},e.handleRightButtonPress=function(n){t.previousTranslation=n.translation,e.startPan()},e.handleRightButtonRelease=function(t){e.endPan()},e.handleStartMouseWheel=function(t){e.startSlice(),e.handleMouseWheel(t)},e.handleEndMouseWheel=function(){e.endSlice()},e.handleMouseWheel=function(e){var t=e.pokedRenderer.getActiveCamera(),n=t.getDistance();n+=e.spinY;var r=t.getClippingRange();n<r[0]&&(n=r[0]),n>r[1]&&(n=r[1]),t.setDistance(n)}}(e,t)}var ss=U.a.newInstance(os,"vtkInteractorStyleImagePanZoom"),cs=Object.assign({newInstance:ss,extend:os}),us=1;function ds(e,t){t.classHierarchy.push("vtkSVGCrosshairsWidget"),t.widgetId="vtkSVGCrosshairsWidget-".concat(us++),e.render=function(e,n){var r=function(e,t){var n=e.querySelector("#".concat(t));return n||((n=document.createElement("g")).setAttribute("id",t),e.appendChild(n)),n}(e,t.widgetId),a=t.point,i=t.strokeColor,o=t.strokeWidth,s=t.strokeDashArray,c=t.padding;if(null!==a[0]&&null!==a[1]){var u=parseInt(e.getAttribute("width"),10),d=parseInt(e.getAttribute("height"),10),l=a.slice();l[0]=a[0]*n,l[1]=d-a[1]*n;var h=[0,d/n/2],g=[u/n/2,0],f=[u/n,d/n/2],p=[u/n/2,d/n];t.display?r.innerHTML='\n      <g id="container" fill-opacity="1" stroke-dasharray="none" stroke="none" stroke-opacity="1" fill="none">\n       <g>\n       \x3c!-- TODO: Why is this <svg> necessary?? </svg> If I don\'t include it, nothing renders !--\x3e\n       <svg version="1.1" viewBox="0 0 '.concat(u," ").concat(d,'" width=').concat(u," height=").concat(d,' style="width: 100%; height: 100%">\n       \x3c!-- Top !--\x3e\n        <line\n          x1="').concat(l[0],'"\n          y1="').concat(g[1],'"\n          x2="').concat(l[0],'"\n          y2="').concat(l[1]-c,'"\n          stroke="').concat(i,'"\n          stroke-dasharray="').concat(s,'"\n          stroke-linecap="round"\n          stroke-linejoin="round"\n          stroke-width="').concat(o,'"\n        ></line>\n        \x3c!-- Right !--\x3e\n        <line\n          x1="').concat(f[0],'"\n          y1="').concat(l[1],'"\n          x2="').concat(l[0]+c,'"\n          y2="').concat(l[1],'"\n          stroke-dasharray="').concat(s,'"\n          stroke="').concat(i,'"\n          stroke-linecap="round"\n          stroke-linejoin="round"\n          stroke-width=').concat(o,'\n        ></line>\n        \x3c!-- Bottom !--\x3e\n        <line\n          x1="').concat(l[0],'"\n          y1="').concat(p[1],'"\n          x2="').concat(l[0],'"\n          y2="').concat(l[1]+c,'"\n          stroke-dasharray="').concat(s,'"\n          stroke="').concat(i,'"\n          stroke-linecap="round"\n          stroke-linejoin="round"\n          stroke-width=').concat(o,'\n        ></line>\n        \x3c!-- Left !--\x3e\n        <line\n          x1="').concat(h[0],'"\n          y1="').concat(l[1],'"\n          x2="').concat(l[0]-c,'"\n          y2="').concat(l[1],'"\n          stroke-dasharray="').concat(s,'"\n          stroke="').concat(i,'"\n          stroke-linecap="round"\n          stroke-linejoin="round"\n          stroke-width=').concat(o,"\n        ></line>\n       </g>\n      </g>\n            "):r.innerHTML=""}},e.resetCrosshairs=function(t,n){var r=t[n];if(r.svgWidgets.crosshairsWidget){var a=r.genericRenderWindow.getRenderer(),i=a.getRenderWindow().getViews()[0].getViewportSize(a),o=ne.a.newInstance();o.setCoordinateSystemToDisplay(),o.setValue(.5*i[0],.5*i[1],0);for(var s=o.getComputedWorldValue(a),c=a.getActiveCamera().getDirectionOfProjection(),u=r.getSlabThickness()/2,d=0;d<s.length;d++)s[d]+=u*c[d];e.moveCrosshairs(s,t)}},e.moveCrosshairs=function(e,t){void 0!==e&&void 0!==t||console.error("worldPos, apis must be defined in order to update crosshairs."),t.forEach((function(t,n){t.set("cachedCrosshairWorldPosition",e);var r=t.genericRenderWindow.getRenderWindow(),a=r.getInteractor().getInteractorStyle(),i=a.getSliceNormal(),o=G.a.buildFromDegree().identity().rotateFromDirections(i,[1,0,0]),s=e.slice();o.apply(s);var c=s[0];a.setSlice(c),r.render();var u=t.genericRenderWindow.getRenderer(),d=ne.a.newInstance();d.setCoordinateSystemToWorld(),d.setValue.apply(d,h()(e));var l=d.getComputedDisplayValue(u),g=t.svgWidgetManager;t.svgWidgets.crosshairsWidget.setPoint(l[0],l[1]),g.render()}))},e.updateCrosshairForApi=function(t){if(t.svgWidgets.crosshairsWidget){var n=t.genericRenderWindow.getRenderer(),r=t.get("cachedCrosshairWorldPosition"),a=ne.a.newInstance();a.setCoordinateSystemToWorld(),a.setValue.apply(a,h()(r));var i=a.getComputedDoubleDisplayValue(n),o=ne.a.newInstance();o.setCoordinateSystemToDisplay(),o.setValue(i[0],i[1],0);for(var s=o.getComputedWorldValue(n),c=n.getActiveCamera().getDirectionOfProjection(),u=t.getSlabThickness()/2,d=0;d<s.length;d++)s[d]+=u*c[d];e.moveCrosshairs(s,[t])}}}var ls={point:[null,null],strokeColor:"#00ff00",strokeWidth:1,strokeDashArray:"",padding:20,display:!0};function hs(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object.assign(t,ls,n),U.a.obj(e,t),U.a.get(e,t,["widgetId"]),U.a.setGet(e,t,["strokeColor","strokeWidth","strokeDashArray","display"]),U.a.setGetArray(e,t,["point","padding"],2),ds(e,t)}var gs={newInstance:U.a.newInstance(hs,"vtkSVGCrosshairsWidget"),extend:hs},fs=1;function ps(e,t){t.classHierarchy.push("vtkSVGCrosshairsWidgetImageMapper"),t.widgetId="vtkSVGCrosshairsWidgetImageMapper-".concat(fs++),e.render=function(e,n){var r=function(e,t){var n=e.querySelector("#".concat(t));return n||((n=document.createElement("g")).setAttribute("id",t),e.appendChild(n)),n}(e,t.widgetId),a=t.point,i=t.strokeColor,o=t.strokeWidth,s=t.strokeDashArray,c=t.padding;if(null!==a[0]&&null!==a[1]){var u=parseInt(e.getAttribute("width"),10),d=parseInt(e.getAttribute("height"),10),l=a.slice();l[0]=a[0]*n,l[1]=d-a[1]*n;var h=[0,d/n/2],g=[u/n/2,0],f=[u/n,d/n/2],p=[u/n/2,d/n];t.display?r.innerHTML='\n      <g id="container" fill-opacity="1" stroke-dasharray="none" stroke="none" stroke-opacity="1" fill="none">\n       <g>\n       \x3c!-- TODO: Why is this <svg> necessary?? </svg> If I don\'t include it, nothing renders !--\x3e\n       <svg version="1.1" viewBox="0 0 '.concat(u," ").concat(d,'" width=').concat(u," height=").concat(d,' style="width: 100%; height: 100%">\n       \x3c!-- Top !--\x3e\n        <line\n          x1="').concat(l[0],'"\n          y1="').concat(g[1],'"\n          x2="').concat(l[0],'"\n          y2="').concat(l[1]-c,'"\n          stroke="').concat(i,'"\n          stroke-dasharray="').concat(s,'"\n          stroke-linecap="round"\n          stroke-linejoin="round"\n          stroke-width="').concat(o,'"\n        ></line>\n        \x3c!-- Right !--\x3e\n        <line\n          x1="').concat(f[0],'"\n          y1="').concat(l[1],'"\n          x2="').concat(l[0]+c,'"\n          y2="').concat(l[1],'"\n          stroke-dasharray="').concat(s,'"\n          stroke="').concat(i,'"\n          stroke-linecap="round"\n          stroke-linejoin="round"\n          stroke-width=').concat(o,'\n        ></line>\n        \x3c!-- Bottom !--\x3e\n        <line\n          x1="').concat(l[0],'"\n          y1="').concat(p[1],'"\n          x2="').concat(l[0],'"\n          y2="').concat(l[1]+c,'"\n          stroke-dasharray="').concat(s,'"\n          stroke="').concat(i,'"\n          stroke-linecap="round"\n          stroke-linejoin="round"\n          stroke-width=').concat(o,'\n        ></line>\n        \x3c!-- Left !--\x3e\n        <line\n          x1="').concat(h[0],'"\n          y1="').concat(l[1],'"\n          x2="').concat(l[0]-c,'"\n          y2="').concat(l[1],'"\n          stroke-dasharray="').concat(s,'"\n          stroke="').concat(i,'"\n          stroke-linecap="round"\n          stroke-linejoin="round"\n          stroke-width=').concat(o,"\n        ></line>\n       </g>\n      </g>\n            "):r.innerHTML=""}},e.moveCrosshairs=function(e,t,n){void 0!==e&&void 0!==t||console.error("worldPos, apis must be defined in order to update crosshairs."),t.forEach((function(t,r){if(t.svgWidgets&&t.svgWidgets.crosshairsWidget){t.set("cachedCrosshairWorldPosition",e);var a=t.genericRenderWindow.getRenderWindow(),i=t.genericRenderWindow.getRenderer(),o=ne.a.newInstance();o.setCoordinateSystemToWorld(),o.setValue.apply(o,h()(e));var s=o.getComputedDisplayValue(i),c=t.svgWidgetManager;if(t.svgWidgets.crosshairsWidget.setPoint(s[0],s[1]),c.render(),"VIEW2D"===t.type)if(r==n){var u=a.getInteractor().getInteractorStyle(),d=i.getActiveCamera();d.setFocalPoint.apply(d,h()(u.getSliceCenter()))}else{var l=t.actors[0].getMapper(),g=l.getSliceAtPosition(e);l.setSlice(g)}a.render()}}))}}var vs={point:[null,null],strokeColor:"#00ff00",strokeWidth:1,strokeDashArray:"",padding:20,display:!0};function ms(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object.assign(t,vs,n),U.a.obj(e,t),U.a.get(e,t,["widgetId"]),U.a.setGet(e,t,["strokeColor","strokeWidth","strokeDashArray","display"]),U.a.setGetArray(e,t,["point","padding"],2),ps(e,t)}var ws={newInstance:U.a.newInstance(ms,"vtkSVGCrosshairsWidgetImageMapper"),extend:ms},ys=1e-6,bs=1;function Ms(e,t,n){var r=d()(n,2),a=r[0],i=r[1];if(Math.abs(t)<ys)return e<0;var o=e/t;if(t>0){if(o>i)return 0;o>a&&(n[0]=o)}else{if(o<a)return 0;o<i&&(n[1]=o)}return 1}var Ss=1;function ks(e,t){t.classHierarchy.push("vtkSVGRotatableCrosshairsWidget"),t.widgetId="vtkSVGRotatableCrosshairsWidget-".concat(Ss++),t.calculateReferenceLines=function(e,n){var r=t.strokeColors,i=t.apis;if(null!==n[0]&&null!==n[1]){var s=i[e],c=s.svgWidgetManager,u=c.getSize(),l=d()(u,2),h=l[0],g=l[1],f=c.getScale(),p=n.slice();p[0]=n[0]*f,p[1]=g-n[1]*f;for(var v=h/f,m=g/f,w=Math.min(h,g)/4,y=Math.sqrt(m*m+v*v),b=[],M=i[e].get("cachedCrosshairWorldPosition"),S=s.svgWidgets.rotatableCrosshairsWidget,k=S.getReferenceLines(),C=function(t){if(t!==e){var n=i[t],c=n.getViewUp(),u=n.getSliceNormal(),l=[];a.cross(l,c,u),a.normalize(l,l);var h=[M[0]+1e6*(c[0]+l[0]),M[1]+1e6*(c[1]+l[1]),M[2]+1e6*(c[2]+l[2])],g=s.genericRenderWindow.getRenderer(),f=ne.a.newInstance();f.setCoordinateSystemToWorld(),f.setValue.apply(f,h);var S=f.getComputedDoubleDisplayValue(g),C=[];o.subtract(C,p,S),o.normalize(C,C);var x=[p[0]+C[0]*y,p[1]+C[1]*y],W=[p[0]-C[0]*y,p[1]-C[1]*y];!function(e,t,n,r,a){var i=d()(e,2),o=i[0],s=i[1],c=d()(t,2),u=c[0]-o,l=c[1]-s;if(void 0===r||void 0===a?(r=e,a=t):(r[0]=e[0],r[1]=e[1],a[0]=t[0],a[1]=t[1]),Math.abs(u)<ys&&Math.abs(l)<ys&&o>=n[0]&&o<=n[2]&&s>=n[1]&&s<=n[3])return bs;var h=[0,1];if(Ms(n[0]-o,u,h)&&Ms(o-n[2],-u,h)&&Ms(n[1]-s,l,h)&&Ms(s-n[3],-l,h)){var g=h[0],f=h[1];return f<1&&(a[0]=o+f*u,a[1]=s+f*l),g>0&&(r[0]+=g*u,r[1]+=g*l),bs}}(W,x,[0,0,v,m]);var I=k.find((function(e){return e&&e.apiIndex===t})),R=!1,P=!1;I&&(R=I.selected,P=I.rotateHandles.selected);var T={x:p[0]+w*C[0],y:p[1]+w*C[1]},D={x:p[0]-w*C[0],y:p[1]-w*C[1]},E={points:[{x:W[0],y:W[1]},{x:x[0],y:x[1]}],rotateHandles:{selected:P,points:[T,D]},color:r[t],apiIndex:t,selected:R};b.push(E)}},x=0;x<i.length;x++)C(x);S.setReferenceLines(b[0],b[1])}},e.render=function(e,n){var r=function(e,t){var n=e.querySelector("#".concat(t));return n||((n=document.createElement("g")).setAttribute("id",t),e.appendChild(n)),n}(e,t.widgetId),a=t.point,i=t.strokeColors,o=t.strokeWidth,s=t.strokeDashArray,c=t.apis,u=t.apiIndex,l=t.selectedStrokeWidth;if(null!==a[0]&&null!==a[1]){var h=c[u].svgWidgets.rotatableCrosshairsWidget.getReferenceLines(),g=parseInt(e.getAttribute("width"),10),f=parseInt(e.getAttribute("height"),10),p=f/n,v=a.slice();v[0]=a[0]*n,v[1]=f-a[1]*n;var m=d()(h,2),w=m[0],y=m[1],b=w.rotateHandles,M=b.points,S=b.selected,k=y.rotateHandles,C=k.points,x=k.selected,W=t.getSplitReferenceLine(w,v),I=d()(W,2),R=I[0],P=I[1],T=t.getSplitReferenceLine(y,v),D=d()(T,2),E=D[0],O=D[1],j=w.selected?l:o,A=y.selected?l:o,L=S?l:o,V=x?l:o;t.display?r.innerHTML='\n      <g id="container" fill-opacity="1" stroke-dasharray="none" stroke="none" stroke-opacity="1" fill="none">\n       <g>\n       <svg version="1.1" viewBox="0 0 '.concat(g," ").concat(f,'" width=').concat(g," height=").concat(f,' style="width: 100%; height: 100%">\n        <g\n\n          stroke="').concat(h[0].color,'"\n          stroke-dasharray="').concat(s,'"\n          stroke-linecap="round"\n          stroke-linejoin="round"\n          stroke-width="').concat(j,'"\n        >\n        \x3c!-- First Line part 1!--\x3e\n          <line\n            x1="').concat(R[0].x,'"\n            y1="').concat(R[0].y,'"\n            x2="').concat(R[1].x,'"\n            y2="').concat(R[1].y,'"\n          ></line>\n          \x3c!-- First Line part 2!--\x3e\n          <line\n            x1="').concat(P[0].x,'"\n            y1="').concat(P[0].y,'"\n            x2="').concat(P[1].x,'"\n            y2="').concat(P[1].y,'"\n          ></line>\n        </g>\n        <g\n          stroke="').concat(h[0].color,'"\n          stroke-dasharray="').concat(s,'"\n          stroke-linecap="round"\n          stroke-linejoin="round"\n          stroke-width="').concat(L,'"\n        >\n            \x3c!--First line rotateHandle 0 --\x3e\n            <circle cx="').concat(M[0].x,'" cy="').concat(M[0].y,'" r="10" fill="none" />\n            \x3c!--First line rotateHandle 1 --\x3e\n            <circle cx="').concat(M[1].x,'" cy="').concat(M[1].y,'" r="10" fill="none" />\n        </g>\n        <g\n          stroke-dasharray="').concat(s,'"\n          stroke="').concat(h[1].color,'"\n          stroke-linecap="round"\n          stroke-linejoin="round"\n          stroke-width=').concat(A,'\n        >\n          \x3c!-- Second Line part 1 !--\x3e\n          <line\n            x1="').concat(E[0].x,'"\n            y1="').concat(E[0].y,'"\n            x2="').concat(E[1].x,'"\n            y2="').concat(E[1].y,'"\n          ></line>\n          \x3c!-- Second Line part 2 !--\x3e\n          <line\n            x1="').concat(O[0].x,'"\n            y1="').concat(O[0].y,'"\n            x2="').concat(O[1].x,'"\n            y2="').concat(O[1].y,'"\n          ></line>\n      </g>\n      <g\n        stroke-dasharray="').concat(s,'"\n        stroke="').concat(h[1].color,'"\n        stroke-linecap="round"\n        stroke-linejoin="round"\n        stroke-width=').concat(V,'\n      >\n        \x3c!--Second line rotateHandle 0 --\x3e\n        <circle cx="').concat(C[0].x,'" cy="').concat(C[0].y,'" r="10" fill="none" />\n        \x3c!--Second line rotateHandle 1 --\x3e\n        <circle cx="').concat(C[1].x,'" cy="').concat(C[1].y,'" r="10" fill="none" />\n      </g>\n      <circle cx="').concat(p-20,'" cy="').concat(20,'" r="10" fill="').concat(i[u],'" />\n      </g>\n\n      '):r.innerHTML=""}},t.getSplitReferenceLine=function(e,n){var r=t.centerRadius,a=[];return o.subtract(a,[e.points[1].x,e.points[1].y],[e.points[0].x,e.points[0].y]),o.normalize(a,a),[[{x:n[0]+a[0]*r,y:n[1]+a[1]*r},e.points[1]],[{x:n[0]-a[0]*r,y:n[1]-a[1]*r},e.points[0]]]},e.resetCrosshairs=function(t,n){var r=t[n];if(r.svgWidgets.rotatableCrosshairsWidget){var a=r.genericRenderWindow.getRenderer(),i=a.getRenderWindow().getViews()[0].getViewportSize(a),o=ne.a.newInstance();o.setCoordinateSystemToDisplay(),o.setValue(.5*i[0],.5*i[1],0);for(var s=o.getComputedWorldValue(a),c=a.getActiveCamera().getDirectionOfProjection(),u=r.getSlabThickness()/2,d=0;d<s.length;d++)s[d]+=u*c[d];e.moveCrosshairs(s,t)}},e.moveCrosshairs=function(e,n){void 0!==e&&void 0!==n||console.error("worldPos, apis must be defined in order to update crosshairs."),n.forEach((function(n,r){n.set("cachedCrosshairWorldPosition",e);var a=n.genericRenderWindow.getRenderWindow(),i=a.getInteractor().getInteractorStyle(),o=i.getSliceNormal(),s=G.a.buildFromDegree().identity().rotateFromDirections(o,[1,0,0]),c=e.slice();s.apply(c);var u=c[0];i.setSlice(u),a.render();var d=n.genericRenderWindow.getRenderer(),l=ne.a.newInstance();l.setCoordinateSystemToWorld(),l.setValue.apply(l,h()(e));var g=l.getComputedDoubleDisplayValue(d),f=n.svgWidgetManager;n.svgWidgets.rotatableCrosshairsWidget.setPoint(g[0],g[1]),t.calculateReferenceLines(r,g),f.render()}))},e.updateCrosshairForApi=function(t){if(t.svgWidgets.rotatableCrosshairsWidget){var n=t.genericRenderWindow.getRenderer(),r=t.get("cachedCrosshairWorldPosition"),a=ne.a.newInstance();a.setCoordinateSystemToWorld(),a.setValue.apply(a,h()(r));var i=a.getComputedDoubleDisplayValue(n),o=ne.a.newInstance();o.setCoordinateSystemToDisplay(),o.setValue(i[0],i[1],0);for(var s=o.getComputedWorldValue(n),c=n.getActiveCamera().getDirectionOfProjection(),u=t.getSlabThickness()/2,d=0;d<s.length;d++)s[d]+=u*c[d];e.moveCrosshairs(s,[t])}}}var Cs={point:[null,null],apis:[null,null,null],referenceLines:[null,null],strokeColors:["#e83a0e","#ede90c","#07e345"],strokeWidth:2,selectedStrokeWidth:5,centerRadius:20,strokeDashArray:"",display:!0};function xs(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object.assign(t,Cs,n),U.a.obj(e,t),U.a.get(e,t,["widgetId"]),U.a.setGet(e,t,["strokeWidth","selectedStrokeWidth","strokeDashArray","display","apiIndex","referenceLines","centerRadius"]),U.a.setGetArray(e,t,["point","referenceLines"],2),U.a.setGetArray(e,t,["apis","strokeColors"],3),ks(e,t)}var Ws={newInstance:U.a.newInstance(xs,"vtkSVGRotatableCrosshairsWidget"),extend:xs},Is=n(9),Rs=n.n(Is);var Ps=new Map;function Ts(e,t){var n=Ps.get(t);if(n)return n;var r,i=function(e){var t=e[0],n=Rs.a.metaData.get("imagePixelModule",t),r=n.pixelRepresentation,a=n.bitsAllocated,i=n.bitsStored,o=n.highBit,s=n.photometricInterpretation,c=n.samplesPerPixel,u=Rs.a.metaData.get("voiLutModule",t),d=u.windowWidth,l=u.windowCenter;Array.isArray(d)&&(d=d[0]),Array.isArray(l)&&(l=l[0]);var h=Rs.a.metaData.get("generalSeriesModule",t).modality,g=new Map;return e.forEach((function(e){var t=Rs.a.metaData.get("imagePlaneModule",e);g.set(e,t)})),{metaData0:g.values().next().value,metaDataMap:g,imageIds:e,imageMetaData0:{bitsAllocated:a,bitsStored:i,samplesPerPixel:c,highBit:o,photometricInterpretation:s,pixelRepresentation:r,windowWidth:d,windowCenter:l,modality:h}}}(e),o=i.metaData0,s=i.metaDataMap,c=i.imageMetaData0,u=o.rowCosines,d=o.columnCosines,l=a.fromValues.apply(a,h()(u)),g=a.fromValues.apply(a,h()(d)),f=a.cross([],l,g),p=function(e,t){var n=Array.from(t.values()),r=n[0],i=n.map((function(t){var n=a.sub([],r.imagePositionPatient,t.imagePositionPatient);return{distance:a.dot(n,e),dataset:t}}));i.sort((function(e,t){return t.distance-e.distance}));var o=i.map((function(e){return e.dataset})),s=i.map((function(e){return e.distance}));return{spacing:Math.abs(s[1]-s[0]),origin:i[0].dataset.imagePositionPatient,sortedDatasets:o}}(f,s),v=p.spacing,m=p.origin,w=p.sortedDatasets,y=o.columnPixelSpacing,b=o.rowPixelSpacing,M=v,S=o.columns,k=o.rows,C=s.size,x=1===c.pixelRepresentation;if(o.numberOfComponents>1)throw new Error("Multi component image not supported by this plugin.");switch(c.bitsAllocated){case 8:throw x?new Error("8 Bit signed images are not yet supported by this plugin."):new Error("8 Bit unsigned images are not yet supported by this plugin.");case 16:r=new Float32Array(S*k*C)}var W=Gi.a.newInstance({name:"Pixels",numberOfComponents:1,values:r}),I=Bi.a.newInstance(),R=[].concat(h()(l),h()(g),h()(f));I.setDimensions(S,k,C),I.setSpacing(y,b,M),I.setDirection(R),I.setOrigin.apply(I,h()(m)),I.getPointData().setScalars(W);var P={imageIds:e,metaData0:o,imageMetaData0:c,dimensions:[S,k,C],spacing:[y,b,M],origin:m,direction:R,vtkImageData:I,metaDataMap:s,sortedDatasets:w,loaded:!1,subscriptions:{onPixelDataInserted:[],onPixelDataInsertedError:[],onAllPixelDataInserted:[]},onPixelDataInserted:function(e){P.subscriptions.onPixelDataInserted.push(e)},onPixelDataInsertedError:function(e){P.subscriptions.onPixelDataInsertedError.push(e)},onAllPixelDataInserted:function(e){P.subscriptions.onAllPixelDataInserted.push(e)},_publishPixelDataInserted:function(e){P.subscriptions.onPixelDataInserted.forEach((function(t){t(e)}))},_publishAllPixelDataInserted:function(){P.subscriptions.onAllPixelDataInserted.forEach((function(e){e()})),P.isLoading=!1,P.loaded=!0,P.vtkImageData.modified(),P.subscriptions={onPixelDataInserted:[],onPixelDataInsertedError:[],onAllPixelDataInserted:[]}},_publishPixelDataInsertedError:function(e){P.subscriptions.onPixelDataInsertedError.forEach((function(t){t(e)}))}};return Ps.set(t,P),P}function Ds(e){return parseFloat(".".concat(e))}function Es(e){if(!e.loaded&&!e.isLoading){var t,n=e.imageIds,r=e.vtkImageData,a=e.metaDataMap,i=e.sortedDatasets,o=n[0],s=Rs.a.metaData.get("generalSeriesModule",o),c=s&&s.modality;"PT"===c&&(t=function(e){var t=Rs.a.metaData.get("generalSeriesModule",e),n=Rs.a.metaData.get("patientStudyModule",e);if(!n)throw new Error("patientStudyModule metadata is required");var r=n.patientWeight;if(!r)throw new Error("patientWeight must be present in patientStudyModule for modality PT");var a=Rs.a.metaData.get("petIsotopeModule",e);if(!a)throw new Error("petSequenceModule metadata is required");var i=a.radiopharmaceuticalInfo,o=i.radiopharmaceuticalStartTime,s=i.radionuclideTotalDose,c=i.radionuclideHalfLife,u=t.seriesTime;if(!(o&&s&&c&&u))throw new Error("The required radiopharmaceutical information was not present.");var d=Ds(u.fractionalSeconds||0)+u.seconds+60*u.minutes+60*u.hours*60-(Ds(o.fractionalSeconds)+o.seconds+60*o.minutes+60*o.hours*60);return{patientWeight:r,correctedDose:s*Math.exp(-d*Math.log(2)/c)}}(o)),e.isLoading=!0,r.getPointData().getScalars().getData()[0]=1;var u={max:Number.NEGATIVE_INFINITY,min:Number.POSITIVE_INFINITY},d=n.length,l=0,h=d/5,g=h;!function(e,t,n){e.forEach((function(e){D.requestPoolManager.addRequest({},e,Os,js,t,n)})),D.requestPoolManager.startGrabbing()}(n,(function(n){var o=a.get(n.imageId).imagePositionPatient,s=i.findIndex((function(e){return e.imagePositionPatient===o})),f=function(e,t,n,r,a){for(var i=e.getPointData().getScalars().getData(),o=function(e,t,n){var r=t.slope,a=t.intercept;if("PT"===e){var i=n.patientWeight,o=n.correctedDose;return function(e){return 1e3*(e*r+a)*i/o}}return function(e){return e*r+a}}(r,n,a),s=n.getPixelData(),c=s.length,u=o(s[0]),d=u,l=0;l<s.length;l++){var h=l+t*c,g=o(s[l]);g>u?u=g:g<d&&(d=g),i[h]=g}return{min:d,max:u}}(r,s,n,c,t),p=f.max,v=f.min;p>u.max&&(u.max=p),v<u.min&&(u.min=v),r.getPointData().getScalars().setRange(u,1),++l>g&&(g+=h,r.modified()),e._publishPixelDataInserted(l),l===d&&e._publishAllPixelDataInserted()}),(function(t){l++,e._publishPixelDataInsertedError(t),l===d&&e._publishAllPixelDataInserted()}))}}var Os="prefetch",js=!1;var As=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(e){for(var n=e.getProperty().getRGBTransferFunction(0),r=n.getSize(),a=0;a<r;a++){var i=[];n.getNodeValue(a,i),i[1]=1-i[1],i[2]=1-i[2],i[3]=1-i[3],n.setNodeValue(a,i)}t instanceof Function?t():t&&t.render&&t.render()}};n.d(t,"View2D",(function(){return ro})),n.d(t,"View2DImageMapper",(function(){return co})),n.d(t,"View3D",(function(){return uo})),n.d(t,"View3DMarchingCubes",(function(){return po})),n.d(t,"ViewportOverlay",(function(){return qi})),n.d(t,"ViewportData",(function(){return Fr})),n.d(t,"getImageData",(function(){return Ts})),n.d(t,"loadImageData",(function(){return Es})),n.d(t,"vtkInteractorStyleMPRWindowLevel",(function(){return Mo})),n.d(t,"vtkInteractorStyleMPRCrosshairs",(function(){return Wo})),n.d(t,"vtkInteractorStyleRotatableMPRCrosshairs",(function(){return Oo})),n.d(t,"vtkInteractorStyleCrosshairsImageMapper",(function(){return Bo})),n.d(t,"vtkInteractorStyleCrosshairsMarchingCubes",(function(){return Xo})),n.d(t,"vtkInteractorStyleMPRRotate",(function(){return es})),n.d(t,"vtkInteractorStyleMPRSlice",(function(){return Qr})),n.d(t,"vtkInteractorStyleImageWindowLevel",(function(){return as})),n.d(t,"vtkInteractorStyleImagePanZoom",(function(){return cs})),n.d(t,"vtkSVGWidgetManager",(function(){return aa})),n.d(t,"vtkSVGCrosshairsWidget",(function(){return gs})),n.d(t,"vtkSVGRotatableCrosshairsWidget",(function(){return Ws})),n.d(t,"vtkSVGCrosshairsWidgetImageMapper",(function(){return ws})),n.d(t,"invertVolume",(function(){return As})),n.d(t,"EVENTS",(function(){return Vr}));t.default=ro}])}));
//# sourceMappingURL=index.umd.min.js.map